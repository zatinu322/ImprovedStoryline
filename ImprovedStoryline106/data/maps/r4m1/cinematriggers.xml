<?xml version="1.0" encoding="windows-1251" standalone="yes" ?>
<triggers>

<!-- Первый приезд на карту. Лиса нервничает -->
	<trigger	Name="cinPriezdFirst"	active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>
			EnableGodMode()

			RuleConsole("cinematic_spring_coeff 6.0")

			SaveAllToleranceStatus(RS_NEUTRAL)

			FlyLinked("FirstPriezd", GetPlayerVehicleId(), 65, 1, 1, GetPlayerVehicleId())
			StartCinematic()
			UpdateCinematic( 1 )

			TActivate("cinPriezd_FadeIn")
			TActivate("cinPriezd_End")
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinPriezd_FadeIn"	active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>

			local Plf = GetPlayerVehicle()
			if Plf then
				Plf:SetGamePositionOnGround(CVector(3129.591, 273.090, 7477.917))
				Plf:SetRotation(Quaternion(0.032, 0.925, -0.002, 0.378))
				Plf:SetExternalPathByName("PriezdToR4M1")
				Plf:LimitMaxSpeed(7)
			end

			AddCinematicMessage( 1, 0.25 )
			AddCinematicMessage( 18, 0.25 )
			AddCinematicMessage( 19, 0.25 )
			AddCinematicMessage( 20, 0.25 )
			AddCinematicMessage( 21, 0.25 )
			AddCinematicMessage( 22, 0.25 )
			AddCinematicMessage( 2, 0.25 )

			trigger:Deactivate()
		</script>
	</trigger>


	<trigger	Name="cinPriezd_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			local Plf = GetPlayerVehicle()
			if Plf then
				Plf:SetExternalPathByName("PriezdToR4M1")
				Plf:PlaceToEndOfPath("PriezdToR4M1")
				Plf:UnlimitMaxSpeed()
				Plf:AddModifier("hp", "= 500")
				Plf:AddModifier("fuel", "= 10")
			end

			RestoreAllToleranceStatus()

			DisableGodMode()

			SetCameraBehindPlayerVehicle()

			RuleConsole("cinematic_spring_coeff 0.7")

			trigger:Deactivate()
		</script>
	</trigger>

<!-- Смена авто игрока на Молоковоз -->
	<trigger	Name="cinMolokovozFirst"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			TActivate("cinMolokovoz_End")
			TActivate("cinMolokovoz_FadeIn")

			local veh=getObj("PlayerMolokovoz")
			if veh then
				veh:SetExternalPathByName("molokovozStartPath")
				veh:SetCruisingSpeed(20)
			end

			Fly("molokovozChange", CINEMATIC_AIM_TO_ID, getObj("PlayerMolokovoz"):GetId(), 10, 1,1)
			StartCinematic()
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinMolokovoz_FadeIn"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			local Plf = GetPlayerVehicle()
			if Plf then
				Plf:SetThrottle( 0 )
				Plf:SetCustomLinearVelocity( 0 )
				Plf:SetGamePositionOnGround(CVector(getPos("PlayerCar_loc")))
				Plf:SetRotation(Quaternion(0.021, 0.994, -0.008, 0.106))
			end

			CreateHuman( "Human", 1001, CVector(getPos("AddHumanSpawn2_loc")), "AddWalkerHuman2")
			CreateHuman( "Human", 1001, CVector(getPos("AddHumanSpawn3_loc")), "AddWalkerHuman3")
			
			AddCinematicMessage( 10, 1 )
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinMolokovoz_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			local veh = getObj("PlayerMolokovoz")
			if veh then
				veh:SetExternalPathByName("molokovozStartPath")
				veh:PlaceToEndOfPath("molokovozStartPath")
			end

			SaveWeaponGroups()

			local Plf = GetPlayerVehicle()
			if Plf then
				Plf:SetNameFromScript( "PlayerCarVahat" )
				Plf:setGodMode(true)
				Plf:setImmortalMode(1)
			end

			CapturePlayerVehicle(0, "OilPlayer")

			AddCinematicMessage( 10, 0.5 )

			local veh=getObj("PlayerMolokovoz")
			if veh then
	   		   g_Player:AddChild(veh)
			end

			TActivate("trOiler")

			SetCameraBehindPlayerVehicle()
			RestoreAllToleranceStatus()

			CompleteQuest("r4m1_KNO_TakeCar")

			local town1 = GetEntityByName("TheKef")
			if town1 then town1:SetOpenGateToPlayer( false ) end

			local town2 = GetEntityByName("TheGadad")
			if town2 then town2:SetOpenGateToPlayer( false ) end

			local town3 = GetEntityByName("TheKazif")
			if town3 then town3:SetOpenGateToPlayer( false ) end

			local a = GetEntityByName("StartGonka_loc")
			if a then a:SetProperty("Active",0) end

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Игрок доехал на Молоковозе до нефтевышки -->
	<trigger	Name="cinOilFirst"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			GetPlayerVehicle():SetCustomLinearVelocity( 0 )
			GetPlayerVehicle():SetThrottle( 0 )

			TActivate("cinOil_End")
			TActivate("cinOil_FadeIn")
			TActivate("cinOil_StartFly")

			Fly("OilPath1", CINEMATIC_NO_AIM, nil, 13, 1,0)
			Fly("OilPath2", CINEMATIC_NO_AIM, nil, 4, 0,1)
			StartCinematic()

			PlayCustomMusic("Techno03")

            trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinOil_FadeIn"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			GetPlayerVehicle():SetGamePositionOnGround(CVector(getPos("ZapravkaCar_loc")))
			GetPlayerVehicle():SetRotation(Quaternion(-0.005, -0.666, -0.005, 0.746))
			GetPlayerVehicle():SetExternalPathByName("ZapravkaIn")

			AddCinematicMessage( 3, 0.5 )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="cinOil_StartFly" active="0">
		<event flypath="OilPath2" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			GetPlayerVehicle():SetExternalPathByName("ZapravkaOut")

			trigger:Deactivate()
		</script>
	</trigger>


	<trigger	Name="cinOil_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			StopPlayingCustomMusic()

			GetPlayerVehicle():SetExternalPathByName("ZapravkaOut")
			GetPlayerVehicle():PlaceToEndOfPath("ZapravkaOut")

			SetCameraBehindPlayerVehicle()

			RestoreAllToleranceStatus()

			TActivate("trGoToChangeVeh2")

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Смена Молоковоза с прицепом обратно на авто игрока -->
	<trigger	Name="cinPlCarReturnFirst"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>

			SaveAllToleranceStatus(RS_NEUTRAL)

			TActivate("cinPlCarReturn_End")
			TActivate("cinPlCarReturn_FadeIn")

            TDeactivate("trTrailerDie")

			local veh=getObj("PlayerCarVahat")
			if veh then

				veh:SetExternalPathByName("playerMolokPath")
				veh:SetCruisingSpeed(15)
			end

			Fly("molokovozExit", CINEMATIC_AIM_TO_ID, getObj("PlayerCarVahat"):GetId(), 18, 1,1)
			StartCinematic()

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinPlCarReturn_FadeIn"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			
			local Plf = GetPlayerVehicle()
			if Plf then
				Plf:SetThrottle( 0 )
				Plf:SetCustomLinearVelocity( 0 )
				Plf:SetGamePositionOnGround(CVector(getPos("MolokovozSpawn_loc")))
				Plf:SetRotation(Quaternion(-0.047, -0.883, 0.025, 0.467))
			end
			
			AddCinematicMessage( 11, 0.5 )
			AddCinematicMessage( 8805, 0.5 )
			
			trigger:Deactivate()
		</script>
	</trigger>


	<trigger	Name="cinPlCarReturn_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>

			local veh=getObj("PlayerCarVahat")
			if veh then
			    CapturePlayerVehicle(0, "MolokozPl")

	   		    g_Player:AddChild(veh)

	   		    RestoreWeaponGroups()

				veh:SetCustomControlEnabled(1)
				veh:SetExternalPathByName("playerMolokPath")
				veh:PlaceToEndOfPath("playerMolokPath")
				veh:setGodMode(false)
				veh:SetCustomControlEnabled(0)
			end

			SetCameraBehindPlayerVehicle()

			RestoreAllToleranceStatus()

			CompleteQuest("r4m1_KNO_BringOil")

			AddQuestItem("Lisa_P")
			AddFadingMsgByStrIdFormatted( "fm_player_add_poput", "Lisa_P")

			local town1 = GetEntityByName("TheKef")
			if town1 then town1:SetOpenGateToPlayer( true ) end

			local town2 = GetEntityByName("TheGadad")
			if town2 then town2:SetOpenGateToPlayer( true ) end

			local town3 = GetEntityByName("TheKazif")
			if town3 then town3:SetOpenGateToPlayer( true ) end

			local a = GetEntityByName("StartGonka_loc")
			if a then a:SetProperty("Active",1) end

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Прицеп уничтожен. Тупиковая концовка -->
	<trigger Name="TrailerDieRolikBegin" active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			PlayCustomMusic("IntenseDialogue03")

			Fly("Ending11", CINEMATIC_NO_AIM, 0, 17.5, 1, 1 )
			StartCinematic()

			AddCinematicMessage(42, 1)

			TActivate("TrailerDieRolikFade")
			TActivate("TrailerDieRolikEnd")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="TrailerDieRolikFade" active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetCustomControlEnabled( true )
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:SetThrottle( 0 )
				vehPlayer:SetCustomControlEnabled( false )
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="TrailerDieRolikEnd" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			StopPlayingCustomMusic()

			SpawnMessageBox("8901")

			ShowDeathMenu()

			CheckPlayerVehicle()

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Догнали инженера-нефтегонщика -->
	<trigger	Name="cinEngineerFirst"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			GetPlayerVehicle():SetCustomLinearVelocity( 0 )
			GetPlayerVehicle():SetThrottle( 0 )

			PlayCustomMusic("Passage04")

			ShowHostileVehicles(false)

			TActivate("cinEngineer_FadeIn")
			TActivate("cinEngineer_End")

			SetVar("PlSpeed",GetPlayerVehicle():GetMaxSpeed())
			SetVar("PlCrSpeed",GetPlayerVehicle():GetCruisingSpeed())

			Fly("EngineerCamPath1", CINEMATIC_AIM_TO_ID, GetPlayerVehicleId(), 7.3, 1,0)
			Fly("EngineerCamPath2", CINEMATIC_AIM_TO_ID, GetPlayerVehicleId(), 7, 0, 1)
			StartCinematic()

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinEngineer_FadeIn"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			local Plf = GetPlayerVehicle()
			if Plf then
				Plf:SetGamePositionOnGround(CVector(4396.869, 300, 5880.139))
				Plf:SetRotation(Quaternion(-0.018, -0.664, 0.004, 0.748))
				Plf:SetMaxSpeed(30)
				Plf:SetCruisingSpeed(30)
				Plf:SetForcedMaxTorque(350)
				Plf:SetExternalPathByName("NearEngineerPlayerPath")
			end

			local enveh=CreateVehicleEx("SmlOilRunner","EngCar",CVector(4273.473, 300, 5923.936), 1033)
			if enveh then
				enveh:SetMaxTorque(100)
				enveh:SetMaxSpeed(20)
				enveh:SetCruisingSpeed(20)
				enveh:SetRotation(Quaternion(-0.002, -0.490, -0.011, 0.872))
				enveh:SetExternalPathByName("NearEngineerEngineerPath")
				enveh:setGodMode(1)
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinEngineer_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			local enveh = getObj("EngCar")
			if enveh then 
				enveh:SetExternalPathByName("NearEngineerEngineerPath")
				enveh:PlaceToEndOfPath("NearEngineerEngineerPath")
				enveh:SetGamePositionOnGround(CVector(4114.627, 249.640, 6045.154))
				enveh:SetRotation(Quaternion(-0.008, 0.221, 0.002, 0.975))
				enveh:SetMaxTorque(80)
				enveh:SetMaxSpeed(40)
				enveh:SetCruisingSpeed(40)
			end

			local speed = GetVar("PlSpeed").AsInt
			local crspeed = GetVar("PlCrSpeed").AsInt

			local Plf = GetPlayerVehicle()
			if Plf then
				Plf:SetExternalPathByName("NearEngineerPlayerPath")
				Plf:PlaceToEndOfPath("NearEngineerPlayerPath")
				Plf:SetGamePositionOnGround( CVector(4099.129, 251.143, 6057.058))
				Plf:SetRotation(Quaternion(-0.011, 0.849, -0.000, 0.529))
				Plf:SetMaxSpeed(speed)
				Plf:SetCruisingSpeed(crspeed)
				Plf:ResetForcedMaxTorque()
			end

			StopPlayingCustomMusic()

			ShowHostileVehicles(true)

			SetCameraBehindPlayerVehicle()

			RestoreAllToleranceStatus()

			StartConversation("r4m1_Engineer")

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Инженер-нефтегонщик взрывается об бочки -->
	<trigger	Name="cinEngineerMustDieFirst"	active="0">
		<event	timeout="0"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			ShowHostileVehicles(false)

			TActivate("cinEngineerMustDie_End")
			TActivate("cinEngineerMustDie_cam02")

			local enveh=getObj("EngCar")
			if enveh then
				enveh:setGodMode( false )
				enveh:SetExternalPathByName("engineerWantDiePath")
			end

			Fly("EngineerCamPath3", CINEMATIC_NO_AIM, nil, 12, 0,0)
			Fly("EngineerCamPath4", CINEMATIC_NO_AIM, nil, 7, 0,1)
			StartCinematic()
			
			AddCinematicMessage( 16, 0.5 )

			PlayCustomMusic("Passage05")

			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetCustomControlEnabled( true )
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:SetThrottle( 0 )
				vehPlayer:SetCustomControlEnabled( false )
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="cinEngineerMustDie_cam02" active="0">
		<event flypath="EngineerCamPath4" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>

			AddCinematicMessage( 17, 0.5 )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinEngineerMustDie_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
		    ShowHostileVehicles(true)

			StopPlayingCustomMusic()

			SetCameraBehindPlayerVehicle()

			RestoreAllToleranceStatus()

			local enveh=getObj("EngCar")
			if enveh then 
				enveh:PlaceToEndOfPath("engineerWantDiePath") 
				enveh:AddModifier("hp", "= 0")
			end

			TDeactivate("cinEngineerMustDie_cam02")
			TDeactivate("trEngineerMustDie")

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Начало слежки за танкистом -->

	<trigger Name="trTankistyRolikBegin" active="0">
		<event	timeout="0"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			PlayCustomMusic("Bio02")

			local tank = CreateVehicleEx("Tank01","Tankisty",CVector(0, 2000, 0), 1031)
			local tankID = tank:GetId()
			local Plf = GetPlayerVehicle()
			local PlfID = GetPlayerVehicleId()

			if Plf then
				Plf:SetCustomLinearVelocity(0)
				Plf:SetThrottle(0)
				Plf:SetGamePositionOnGround(CVector(6302.845, 251.241, 5092.278))
				Plf:SetRotation(Quaternion(0.002, 0.926, -0.002, -0.377))
			end

			if tank then
				tank:SetGamePositionOnGround(CVector(6281.624, 251.233, 4977.553))
				tank:SetRotation(Quaternion(0.002, 0.662, -0.004, -0.750))
				tank:SetExternalPathByName("preTankistyPath")
				tank:SetCustomLinearVelocity(15)
			end

			FlyLinked("TankistyRolik_cam1", PlfID, 15, 0, 1, tankID)
			StartCinematic()

			TActivate("trTankistyRolikEnd")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trTankistyRolikEnd" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			StopPlayingCustomMusic()

			local tank = getObj("Tankisty")
			if tank then
				tank:PlaceToEndOfPath("preTankistyPath")
				tank:SetGamePositionOnGround(CVector(6135.232, 251.121, 5081.549))
				tank:SetRotation(Quaternion(0.002, -0.850, 0.005, 0.527))
				tank:SetExternalPathByName("TankistyPath")
				tank:SetCustomLinearVelocity(5)
				SetCameraDirectionToObj(tank:GetId())
			end
			
			TActivate("SPYTANKI")
			TActivate("SPYTANKIEND")

			SetTolerance(1100,1031,RS_NEUTRAL)
			SetTolerance(1031,1023,RS_NEUTRAL)
			SetTolerance(1031,1025,RS_NEUTRAL)
			SetTolerance(1031,1060,RS_NEUTRAL)
			SetTolerance(1031,1002,RS_NEUTRAL)
			SetTolerance(1031,1033,RS_NEUTRAL)
			
			TakeQuest("r4m1_Tankisty")

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Провал слежки за танкистом -->
	<trigger Name="SPYTANKIFAIL" active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>

			local Plf = GetPlayerVehicle()
			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.y = PlfCoor.y + 7
			PlfCoor.z = PlfCoor.z + 25

			Plf:SetCustomControlEnabled( true )
			Plf:SetCustomLinearVelocity( 0 )
			Plf:SetThrottle( 0 )
			Plf:SetCustomControlEnabled( false )

			SaveAllToleranceStatus(RS_NEUTRAL)

			FlyAround(1, 0, 15, 7, PlfCoor, PlfID, 1, 1)
			StartCinematic()

			AddCinematicMessage( 8804, 1 )

			TActivate( "SPYTANKI_cp" )

			TDeactivate("SPYTANKIEND")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="SPYTANKI_cp" active="0">
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			local r1 = GetEntityByName ("Tankisty")
			if r1 then r1:Remove() end

			FailQuestIfTaken("r4m1_Tankisty")
			
			TakeQuest("r4m1_FPR_MeetWithOldMan")

			SetCameraBehindPlayerVehicle()

			trigger:Deactivate() 
		</script>
	</trigger>

	<!-- Убили всех танкистов -->
	<trigger Name="TANKIBATTLECIN" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="Tankisty2" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)
			
			PlayCustomMusic("Sadness1")
			
			local Plf = GetPlayerVehicle()
			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.x = PlfCoor.x - 5
			PlfCoor.y = PlfCoor.y + 6
			PlfCoor.z = PlfCoor.z - 35

			Plf:SetCustomLinearVelocity(0)
			Plf:SetThrottle(0)

			FlyAround(3, 0, 15, 48, PlfCoor, PlfID, 1, 1 )
			StartCinematic()
			
			AddCinematicMessage( 23, 0.5 )
			AddCinematicMessage( 24, 0.5 )
			AddCinematicMessage( 25, 0.5 )
			AddCinematicMessage( 26, 0.5 )
			AddCinematicMessage( 27, 0.5 )
			AddCinematicMessage( 28, 0.5 )
			AddCinematicMessage( 29, 0.5 )
			AddCinematicMessage( 30, 0.5 )
			
			TActivate("TANKIBATTLECINEND")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="TANKIBATTLECINEND" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			StopPlayingCustomMusic()
			
			RestoreAllToleranceStatus()

			SetVar("Tankisty", 1)
			
			TActivate("BUHARAFIRE")
			TActivate("BUHARACIN")
			TActivate("trBuhArmy")
			
			CompleteQuest("KillTankistov")
			
			CompleteQuestIfTaken("r4m1_FRP_HelpKef")
			
			TakeQuest("r4m1_FPR_MeetWithOldMan")

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Альфаран убили Бухарцев на кладбище кораблей -->
	<trigger Name="BUHARACIN" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Buhara_loc" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)
			
			PlayCustomMusic("Bio01")
			
			if QuestStatus("r4m1_KNO_FindSpecialist")==Q_FAILED then
				Fly("BuharaDie", CINEMATIC_NO_AIM, 0, 18, 1, 1 )
				StartCinematic()
				AddCinematicMessage( 31, 1 )
				AddCinematicMessage( 34, 0.1 )
			else
				Fly("BuharaDie", CINEMATIC_NO_AIM, 0, 19, 1, 1 )
				StartCinematic()
				AddCinematicMessage( 31, 1 )
				AddCinematicMessage( 32, 0.1 )
				TActivate("PEREGFIRE")
			end
			
			TActivate("BUHARACINEND")
			TActivate("BUHARACINFADE")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="BUHARACINFADE" active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetCustomControlEnabled( true )
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:SetThrottle( 0 )
				vehPlayer:SetCustomControlEnabled( false )
				vehPlayer:SetGamePositionOnGround( CVector(2026.110, 228.827, 6354.025))
				vehPlayer:SetRotation(Quaternion(0.001, 0.424, 0.003, -0.906))
			end
			
			CreateNewDummyObject( "dweller_player", "humPlayer", -1, -1, CVector(2032.212, 226.761, 6359.618), Quaternion(0.001, 0.437, 0.003, -0.899), 0)
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="BUHARACINEND" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			
			StopPlayingCustomMusic()
			
			RestoreAllToleranceStatus()
			
			FailQuest("r4m1_FPR_MeetWithOldMan")
			
			local play1 = GetEntityByName("humPlayer")
			if play1 then
				play1:Remove()
			end
			
			if QuestStatus("r4m1_KNO_FindSpecialist")==Q_FAILED then
				CompleteQuest("r3m2_FindInfoAboutFather")
				TakeQuest("r4m2_LisaDieBen")
			else
				TakeQuest("PeregDie")
				TActivate("PEREGDIECIN")
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Альфаран убили перегонщика -->
	<trigger Name="PEREGDIECIN" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Pereg_loc" />
		<script>

			SaveAllToleranceStatus(RS_NEUTRAL)
			
			PlayCustomMusic("Bio01")
			
			Fly("PeregDie", CINEMATIC_NO_AIM, 0, 18, 1, 1 )
			StartCinematic()
			
			AddCinematicMessage( 33, 1 )
			AddCinematicMessage( 34, 0.1 )
			
			TActivate("PEREGDIEEND")
			TActivate("PEREGDIEFADE")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="PEREGDIEFADE" active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetCustomControlEnabled( true )
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:SetThrottle( 0 )
				vehPlayer:SetCustomControlEnabled( false )
				vehPlayer:SetGamePositionOnGround( CVector(3651.854, 251.073, 5436.483))
				vehPlayer:SetRotation(Quaternion(-0.000, -0.294, 0.003, 0.956))
			end
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="PEREGDIEEND" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
		
			StopPlayingCustomMusic()
			
			RestoreAllToleranceStatus()
			
			CompleteQuest("PeregDie")
			
			CompleteQuest("r3m2_FindInfoAboutFather")
			
			TakeQuest("r4m2_LisaDieBen")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Альфаран нападает на Бухарцев на кладбище кораблей -->
	<trigger	Name="cinBuhArmyFirst"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>   
			SaveAllToleranceStatus(RS_NEUTRAL)

			GetPlayerVehicle():SetCustomLinearVelocity( 0 )
			GetPlayerVehicle():SetThrottle( 0 )

			TActivate("cinBuhArmy_End")

			Fly("BuharsAttackPath", CINEMATIC_NO_AIM, nil, 8, 1,1)
			StartCinematic()

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinBuhArmy_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			SetCameraBehindPlayerVehicle()

			RestoreAllToleranceStatus()

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Лиса теряет сознание -->
	<trigger Name="LisaBuharDie" active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)
			
			PlayCustomMusic("Sadness1")
			
			local Plf = GetPlayerVehicle()
			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.x = PlfCoor.x - 5
			PlfCoor.y = PlfCoor.y + 6
			PlfCoor.z = PlfCoor.z - 35

			Plf:SetCustomLinearVelocity(0)
			Plf:SetThrottle(0)

			FlyAround(3, 0.1, 15, 52, PlfCoor, PlfID, 1, 1 )
			StartCinematic()
			
			AddCinematicMessage( 40, 1 )
			AddCinematicMessage( 41, 0.1 )
			AddCinematicMessage( 24, 0.1 )
			AddCinematicMessage( 25, 0.1 )
			AddCinematicMessage( 26, 0.1 )
			AddCinematicMessage( 27, 0.1 )
			AddCinematicMessage( 28, 0.1 )
			AddCinematicMessage( 29, 0.1 )
			AddCinematicMessage( 34, 0.1 )
			
			TActivate("LisaBuharDie2")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="LisaBuharDie2" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			StopPlayingCustomMusic()
			
			RestoreAllToleranceStatus()
			
			SetCameraBehindPlayerVehicle()

			local vehBuh = GetEntityByName("Buharers_vehicle_0")
			if vehBuh then vehBuh:Remove() end

			local vehBuh1 = GetEntityByName("Buharers_vehicle_1")
			if vehBuh1 then vehBuh1:Remove() end

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Бухарцы доехали до порта -->
	<trigger	Name="cinBuhPortFirst"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			GetPlayerVehicle():SetCustomLinearVelocity( 0 )
			GetPlayerVehicle():SetThrottle( 0 )

			SaveAllToleranceStatus(RS_NEUTRAL)

			TActivate("cinBuhPort_End")
			TActivate("cinBuhPort_FadeIn")

			PlayCustomMusic("QuietDialogue03")

			Fly("BuharsInPortPath", CINEMATIC_AIM_TO_POINT, CVector(1355.880, 220.086, 3133.145), 39.5, 1,1)
			StartCinematic()

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinBuhPort_FadeIn"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			for i=0,1 do
				local buh = getObj("Buharers_vehicle_"..i)
				if buh then
					buh:SetMaxTorque(0)
					buh:SetMaxSpeed(0)
				end
			end
			   
			setPos("Buharers_vehicle_0", CVector(1355.880, 220.086, 3133.145))
			setRot("Buharers_vehicle_0", Quaternion(-0.008, 0.741, 0.008, 0.671))
			setPos("Buharers_vehicle_1", CVector(1354.502, 220.103, 3113.447))
			setRot("Buharers_vehicle_1", Quaternion(-0.010, 0.374, 0.004, 0.927))

			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetCustomControlEnabled( true )
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:SetThrottle( 0 )
				vehPlayer:SetCustomControlEnabled( false )
				vehPlayer:SetGamePositionOnGround(CVector(1387.320, 220.074, 3117.844))
				vehPlayer:SetRotation(Quaternion(-0.009, -0.001, 0.000, 1.000))
			end

			AddCinematicMessage( 12, 0.5 )
			AddCinematicMessage( 13, 0.5 )
			AddCinematicMessage( 14, 0.5 )
			AddCinematicMessage( 15, 0.5 )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinBuhPort_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			for i=0,1 do
				local buh = getObj("Buharers_vehicle_"..i)
				if buh then
					buh:Remove()
				end
			end

			CompleteQuestIfTaken("r3m2_FindInfoAboutFather")
			CompleteQuestIfTaken("r4m1_FRP_HelpKef")

			StopPlayingCustomMusic()

			SetCameraBehindPlayerVehicle()

			RestoreAllToleranceStatus()

			if IsQuestComplete("r4m1_KNO_FindSpecialist") then
				TakeQuest("PeregReturn")
			else
				TakeQuest("r4m1_GotoAivenGo")
			end

			local a = GetEntityByName("StartGonka_loc")
			if a then a:SetProperty("Active",1) end
			
			AddHistory(  'r4_LisaBecameCrazy'  )
			AddFadingMsgId( 'fm_history_got' )
			
			RemoveQuestItem("Lisa_P")
			AddFadingMsgByStrIdFormatted( "fm_player_fem_poput", "Lisa_P")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Смотрим на человека на горе. Квест Мистера Шляпы. -->
	<trigger	Name="HumanSkala_Rolik"	active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="HumanSkala_loc" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)
			
			PlayCustomMusic("Bio02")

			local humS = CreateHuman( "Human3", 1001, CVector(6420.099, 274.402, 4256.425), "HumanNaSkale", "Human31_Path" )
			humSID = humS:GetId()
			
			Fly("Shlyapa_cam", CINEMATIC_NO_AIM, 0, 9, 1, 0)
			Fly("Shlyapa_cam2", CINEMATIC_AIM_TO_ID, humSID, 19, 0, 1, nil, nil, true )
			StartCinematic()
			
			TActivate("HumanSkala_Fade")
			TActivate("HumanSkala_cam02")
			TActivate("HumanSkala_End")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="HumanSkala_Fade"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetCustomControlEnabled( true )
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:SetThrottle( 0 )
				vehPlayer:SetCustomControlEnabled( false )
				vehPlayer:SetGamePositionOnGround( CVector(6568.987, 261.227, 4440.345))
				vehPlayer:SetRotation(Quaternion(0.001, -0.941, -0.022, 0.337))
			end
			
			CreateNewDummyObject( "dweller_player", "humPlayer", -1, -1, CVector(6567.414, 260.033, 4447.929), Quaternion(0.009, -0.939, -0.033, 0.343), 0)
			
			getObj("humPlayer"):SetNodeAction(AT_STAND1)
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="HumanSkala_cam02" active="0">
		<event flypath="Shlyapa_cam2" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>

			AddCinematicMessage( 39, 3 )
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="HumanSkala_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			SetCameraBehindPlayerVehicle()
			
			StopPlayingCustomMusic()
			
			local hp = GetEntityByName("humPlayer")
			if hp then hp:Remove() end
			
			CompleteQuest("MrShlyapa4_Quest")

			TDeactivate("HumanSkala_Fade")
			TDeactivate("HumanSkala_cam02")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Фальстарт на гонке -->
	<trigger	Name="trFalseStartRace"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			local Plf = GetPlayerVehicle()
			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.y = PlfCoor.y + 10
			PlfCoor.z = PlfCoor.z - 25

			Plf:SetCustomControlEnabled(true)
			Plf:SetCustomLinearVelocity(0)
			Plf:SetThrottle(0)
			Plf:SetCustomControlEnabled(false)

			FlyAround(0.5, 0, 15, 7, PlfCoor, PlfID, 1, 1 )
			StartCinematic()

			SetVar("PlayerPlace",0)

		    AddCinematicMessage( 9, 0.5 )

		    TActivate("trRemoveAllRace")

		    trigger:Deactivate()
		</script>
	</trigger>

	<!-- Игрок разбился на гоночной машине -->
	<trigger	Name="trPlayerFormulaDie"	active="0">	
		<event eventid="GE_VEHICLE_WITHOUT_HEALTH" ObjName="PlayerFormula" />
		<script>

			SaveAllToleranceStatus(RS_NEUTRAL)

			local Plf = getObj("PlayerFormula")
			if Plf then 
				local PlfID = Plf:GetId()
				local PlfCoor = Plf:GetPosition()
				PlfCoor.y = PlfCoor.y + 10
				PlfCoor.z = PlfCoor.z - 25

				Plf:SetCustomControlEnabled(true)
				Plf:SetCustomLinearVelocity(0)
				Plf:SetThrottle(0)
				Plf:SetCustomControlEnabled(false)

				FlyAround(0.5, 0, 15, 7, PlfCoor, PlfID, 1, 1 )
				StartCinematic()

			    AddCinematicMessage( 8, 0.5 )
			end

		    TActivate("trRemoveAllRace")

    		SetVar("PlayerPlace",0)

		    trigger:Deactivate()
		</script>
	</trigger>

	<!-- Игрок приехал на финиш -->
	<trigger	Name="trFinishRace"	active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>
		    local place = GetVar("PlayerPlace").AsInt
		    if place==1 then
    			AddPlayerMoney(40000)
		    elseif place==1 then
    			AddPlayerMoney(20000)
		    elseif place==1 then
    			AddPlayerMoney(10000)
			elseif place>4 then
				place=4
			end

			local healthmax=GetPlayerMaxHealth()
			local healthcur=GetPlayerHealth()
			local cenahp = 5000/healthmax
			local ostcena=healthcur*cenahp

			AddPlayerMoney(ostcena)

			CreateNewDummyObject( "brick_debris1", "CamTochka", -1, -1, CVector(4176.459, 284.317, 2168.970), Quaternion(0, 0, 0, 0), 1)
			local CToch = GetEntityByName("CamTochka")
			local CTochID = CToch:GetId()
			local Plf = GetPlayerVehicle()
			local PlfID = GetPlayerVehicleId()

			SaveAllToleranceStatus(RS_NEUTRAL)

			FlyLinked("PlayerRaceFinish", CTochID, 6, 0, 1, PlfID)
			StartCinematic()

		    AddCinematicMessage( place+3, 0.5 )

		    TActivate("trRemoveAllRace")

		    trigger:Deactivate()
		</script>
	</trigger>

	<!-- Завершение всех трёх вышеобозначенных катсцен -->
	<trigger	Name="trRemoveAllRace"	active="0">
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<script>
			CapturePlayerVehicle(0, "PlayerFormula")

			SetVar("Gonka",0)

			AllowSave( true )

			TDeactivate("trRaceCarDie")
			TDeactivate("trCheckPoints")
			TDeactivate("trFormulaMoving")
			TDeactivate("trPlayerFormulaDie")

			local maxcar = GetVar("CountCar").AsInt
			for i=1,maxcar-1 do
			   local veh=getObj("FormulaCar"..i)
			   if veh then 
			      veh:Remove()
			   end
			end

			local veh=getObj("PlayerFormula")
			if veh then 
			     veh:Remove()
			end

			local plcarname=GetVar("PlayerCarNameRace").AsString
			local pl=g_Player
			local plcar=getObj("PlayerCarGonki")

			if pl and plcar then
				pl:AddChild(plcar)
				RestoreWeaponGroups()
			end

			local Plf = GetPlayerVehicle()
			if Plf then
				Plf:setGodMode(0)
				Plf:SetCustomControlEnabled(0)
				Plf:SetThrottle(0)
				Plf:SetGamePositionOnGround(CVector(4422.050, 280.216, 2025.034))
				Plf:SetRotation(Quaternion(-0.001, -0.703, -0.000, -0.711))
			end

			StopPlayingCustomMusic()

			SetCameraBehindPlayerVehicle()

			RestoreAllToleranceStatus()

		    trigger:Deactivate()
		</script>
	</trigger>

	<!-- Приплытие подлодки -->
	<trigger Name="cinMovePlToR2M2_begin" active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>

			GetPlayerVehicle():SetCustomLinearVelocity( 0 )
			GetPlayerVehicle():SetThrottle( 0 )
			
			SaveAllToleranceStatus(RS_NEUTRAL)
			
			EnableGodMode()
			
			Fly("lodka1", CINEMATIC_NO_AIM, 0, 21, 1, 0 )
			Fly("lodka2", CINEMATIC_NO_AIM, 0, 15, 0, 1 )
			StartCinematic()
			
			PlayCustomMusic("Bio02")
			
			TActivate("cinMovePlToR2M2_Fade")
			TActivate("cinMovePlToR2M2_cam03")
			TActivate("cinMovePlToR2M2_End")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="cinMovePlToR2M2_Fade" active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			
			CreateNewDummyObject( "submarina",	"SubmR4M1", -1, -1, CVector(318.837, 150.000, 3490.127), Quaternion(0.0000, 0.8204, 0.0000, 0.5718), 0 )
			
			local moverId = CreateNewObject { prototypeName	= "cinematicMover", objName  = "" }
			local mover = GetEntityByID( moverId ) 
			local controlledObj = GetEntityByName("SubmR4M1")
			if controlledObj then
				mover:SetObjAndPath( controlledObj:GetId(), "lodka4", 20 )
			end
			
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:SetThrottle( 0 )
				vehPlayer:SetPosition( CVector(1262.583, 214.190, 3151.562))
		   		vehPlayer:SetRotation(Quaternion(-0.005, 0.557, -0.006, -0.830))
		   	end
		   	
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="cinMovePlToR2M2_cam03" active="0">
		<event flypath="lodka2" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			local podlodka = getObj("SubmR4M1")
			if podlodka then
				podlodka:SetNodeAction(AT_STAND2)
			end

			TActivate("subzaezd11")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="subzaezd11" active="0">
		<event	timeout="7"		eventid="GE_TIME_PERIOD" />
		<script>
			
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetExternalPathByName("subzaezd1")
				vehPlayer:LimitMaxSpeed( 15 )
		   	end
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="cinMovePlToR2M2_End" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetExternalPathByName("subzaezd1")
				vehPlayer:PlaceToEndOfPath()
				vehPlayer:SetCustomLinearVelocity(0)
				vehPlayer:UnlimitMaxSpeed()
		   	end
			
			StopPlayingCustomMusic()
			
			DisableGodMode()
			
			TActivate("trSubDelete")
			
			TDeactivate("subzaezd11")
			TDeactivate("cinMovePlToR2M2_cam03")
			
			RestoreAllToleranceStatus()
			
			SetCameraBehindPlayerVehicle()
						
			PassToMap("r2m2", "FromR4M1", -1 , true)
			
			trigger:Deactivate()
		</script>
	</trigger>
</triggers>