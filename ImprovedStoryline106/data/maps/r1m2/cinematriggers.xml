<?xml version="1.0" encoding="windows-1251" standalone="yes" ?>
<triggers>

	<!-- После Бабы Поли, первый раз -->
	<trigger	Name="cinAfterChifir"	active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>
			if GetVar("NoChifir").AsInt == 0 then
				PlayCustomMusic("Bio04")

				SaveAllToleranceStatus(RS_NEUTRAL)

				local Plf = GetPlayerVehicle()
				Plf:SetCustomLinearVelocity( 0 )
				Plf:SetThrottle( 0 )

				Fly("ShlyapaCam0_0", CINEMATIC_NO_AIM, nil, 7, 0, 0)
				Fly("ShlyapaCam0", CINEMATIC_AIM_TO_ID, GetPlayerVehicleId(), 19.5, 0, 1)
				StartCinematic()

				TActivate("cinAfterChifir_cam00")
				TActivate("cinAfterChifir_End")

			elseif GetVar("NoChifir").AsInt == 1 then
				local shl1 = GetEntityByName("MisterShlyapaFM")
				if shl1 then shl1:SetProperty("Active",1) end
			else
				LOG("ERROR! Can not define variable NoChifir")
			end
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="cinAfterChifir_cam00" active="0">
		<event flypath="ShlyapaCam0" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:SetThrottle( 0 )
				vehPlayer:SetGamePositionOnGround(CVector(4236.602, 68.916, 5117.343))
				vehPlayer:SetRotation(Quaternion(0.046, 0.988, -0.007, 0.148))
			end

			AddCinematicMessage( 88056, 1 )

			if IsQuestComplete("FirstTimePlay") then
				AddCinematicMessage( 88061, 0.25 )
			else
				AddCinematicMessage( 88057, 0.25 )
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinAfterChifir_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			SetCameraBehindPlayerVehicle()

			CompleteQuest("Chifir_Quest")
			TakeQuest("FindBen2_Quest")

			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:SetThrottle( 0 )
				vehPlayer:SetGamePositionOnGround(CVector(4236.602, 68.916, 5117.343))
				vehPlayer:SetRotation(Quaternion(0.046, 0.988, -0.007, 0.148))
			end

			local shl1 = GetEntityByName("MisterShlyapaFM")
			if shl1 then shl1:SetProperty("Active",1) end
			
			if not(IsQuestComplete("FirstTimePlay")) then
				StartConversation( "MrShlyapa" )
			end

			TDeactivate("cinAfterChifir_cam00")
			
			trigger:Deactivate()
		</script>
	</trigger>

<!-- Если караван из Мидгарда уничтожен -->
	<trigger Name="cinCaravanDead" active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)
			
			local Plf = GetPlayerVehicle()
			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.y = PlfCoor.y + 5
			PlfCoor.z = PlfCoor.z + 15

			Plf:SetCustomLinearVelocity(0)
			Plf:SetThrottle(0)

			FlyAround(1, 0, 15, 12.5, PlfCoor, PlfID, 1, 1 )
			StartCinematic()
			
			AddCinematicMessage( 5963, 1 )
			
			TActivate("cinCaravanDead2")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="cinCaravanDead2" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()
			
			SetCameraBehindPlayerVehicle()
			
			TakeQuest("CaravDead_Quest")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Игрока выгоняют из Мидгарда -->
	<trigger	Name="RolikBegin_OutOfMidgard"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			PlayCustomMusic("Bio07unloop")

			Fly("MidragdOut1", CINEMATIC_NO_AIM, 0, 8, 0, 0 )
			Fly("MidragdOut3", CINEMATIC_NO_AIM, 0, 8, 0, 1, nil, nil, true )
			StartCinematic()

			AddCinematicMessage( 88055, 1 )
			
			local Plf = GetPlayerVehicle()
			if Plf then
				Plf:SetCustomLinearVelocity(0)
				Plf:SetThrottle(0)
				Plf:SetGamePositionOnGround( CVector(4345.800, 128.327, 855.063))
				Plf:SetRotation(Quaternion(-0.020, -1.000, 0.000, 0.009))
			end
			
			CreateNewDummyObject( "dweller_player", "humPlayer", -1, -1, CVector(4342.388, 127.361, 852.012), Quaternion(-0.008, 0.999, 0.017, -0.026), 0)
			
			TActivate("OutOfMidgard_FadeIn2")
			TActivate("OutOfMidgard_End")

			trigger:Deactivate()
		</script>
	</trigger>
	
	<trigger	Name="OutOfMidgard_FadeIn2"	active="0">
		<event flypath="MidragdOut3" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			
			AddCinematicMessage( 880555, 2 )
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="OutOfMidgard_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			local Plf = GetPlayerVehicle()
			if Plf then
				Plf:SetGamePositionOnGround( CVector(4368.368, 128.350, 876.529))
				Plf:SetRotation(Quaternion(-0.000, -0.524, 0.003, -0.852))
			end
		
			local humP = GetEntityByName("humPlayer")
			if humP then humP:Remove() end

			TDeactivate("OutOfMidgard_FadeIn2")

			SetCameraBehindPlayerVehicle()
			
			StopPlayingCustomMusic()

			SetVar("MidgardCutscene", 0)

			local ploc = GetEntityByName("MidgardProfessor")
			if ploc then ploc:SetProperty("Active", 1) end
			
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Убили всех рейдеров у схрона Сальваторе -->
	<trigger	Name="cinAfterKillRaider"	active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>
			local Plf = GetPlayerVehicle()
			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.y = PlfCoor.y + 5
			PlfCoor.z = PlfCoor.z + 15

			Plf:SetCustomLinearVelocity(0)
			Plf:SetThrottle(0)

			SaveAllToleranceStatus(RS_NEUTRAL)

			FlyAround(1, 0, 15, 11.5, PlfCoor, PlfID, 1, 1 )
			StartCinematic()

			AddCinematicMessage( 88058, 0.25 )

			AddQuestItem("quest_thief_package")
			AddFadingMsgByStrIdFormatted( "fm_player_add_thing", "quest_thief_package")

			TActivate("cinAfterKillRaiderEnd")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="cinAfterKillRaiderEnd" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			SetCameraBehindPlayerVehicle()

			trigger:Deactivate()
		</script>
	</trigger>

<!-- Показываем Караванщика в плену -->
	<trigger Name="RolikPlenlisa" active="0">
		<event timeout=" 0 " eventid="GE_TIME_PERIOD" />
		<script>
			PlayCustomMusic("IntenseDialogue01")

			SaveAllToleranceStatus(RS_NEUTRAL)

			Fly("LisaPlen_cam01", CINEMATIC_NO_AIM, 0, 5, 1, 0 )
			Fly("LisaPlen_cam02", CINEMATIC_NO_AIM, 0, 8, 0, 1 )
			StartCinematic()
			AddCinematicMessage( 20, 1.0 )

			TActivate("RolikEnd_LisaPlen")
			TActivate( "trLisaPlen" )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trLisaPlen" active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			local Plf = GetPlayerVehicle()
			Plf:SetCustomControlEnabled( true )
			Plf:SetCustomLinearVelocity( 0 )
			Plf:SetThrottle( 0 )
			Plf:SetCustomControlEnabled( false )

			CreateNewDummyObject( "dweller_white", "HumanBandit01", -1, -1, CVector(5356.497, 49.494, 4665.973), Quaternion( 0.000, 0.111, 0.000, 0.994 ), 0)
			CreateNewDummyObject( "dweller_white", "HumanBandit02", -1, -1, CVector(5356.165, 49.558, 4668.618), Quaternion( -0.000, -1.000, 0.000, -0.022 ), 0)
			CreateNewDummyObject( "dweller_white", "HumanBandit03", -1, -1, CVector(5292.229, 99.638, 4656.556), Quaternion( -0.032, 0.549, 0.049, 0.834 ), 0)

			CreateVehicleEx("MolokovozMenu","MolokovozMenu",CVector(5320.740, 53.949, 4678.966), 1011)
			local vehLisa = GetEntityByName("MolokovozMenu")
			if vehLisa then
				vehLisa:SetSkin(2)
				vehLisa:SetGamePositionOnGround( CVector(5320.740, 53.949, 4678.966))
				vehLisa:SetRotation(Quaternion(0.121, 0.990, -0.036, -0.056))
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RolikEnd_LisaPlen" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			local vehLisa = GetEntityByName("MolokovozMenu")
			if vehLisa then
				vehLisa:Remove()
			end
			local Bandit1 = GetEntityByName("HumanBandit01")
			if Bandit1 then
				Bandit1:Remove()
			end
			local Bandit2 = GetEntityByName("HumanBandit02")
			if Bandit2 then
				Bandit2:Remove()
			end
			local Bandit3 = GetEntityByName("HumanBandit03")
			if Bandit3 then
				Bandit3:Remove()
			end

			TDeactivate( "trLisaPlen" )

			StopPlayingCustomMusic()

			TeamCreate("LisaInBanditDen",1002,CVector(5476,49,4567),{"molokovozBandos","r1m2_bug04", "r1m1_scout01"})

			TakeQuest("BenRim4_Quest")

			TActivate("PLENLISADIE")

			SetCameraBehindPlayerVehicle()

			trigger:Deactivate()
		</script>
	</trigger>

<!-- Диалог с караванщиком после освобождения -->
	<trigger Name="RolikBegin_LisaPlenDie" active="0">
		<event timeout=" 0 " eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			PlayCustomMusic("QuietDialogue03")

			RuleConsole("cinematic_spring_coeff 1.1")

			local vehLisa = CreateVehicleEx("MolokovozMenu","MolokovozMenu",CVector(5320.740, 53.949, 4678.966), 1011)

			CreateNewDummyObject( "cargo", "camToch01", -1, -1, CVector(5615.775, 68.402, 4058.987), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), 0)
			CreateNewDummyObject( "cargo", "camToch02", -1, -1, CVector(5143.547, 153.030, 3545.455), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), 0)
			

			local camToch01 = GetEntityByName("camToch01")
			local camToch02 = GetEntityByName("camToch02")
			local camToch01ID = camToch01:GetId()
			local camToch02ID = camToch02:GetId()
			local LisaID = vehLisa:GetId()
			local PlfID = GetPlayerVehicleId()

			FlyLinked( "LisaPlenDie_cam01", PlfID, 28, 1, 0, LisaID )
			FlyLinked( "LisaPlenDie_cam02", camToch01ID, 34, 0, 0, LisaID )
			FlyLinked( "LisaPlenDie_cam03", LisaID, 14, 0, 0, PlfID )
			FlyLinked( "LisaPlenDie_cam04", camToch02ID, 28, 0, 0, LisaID )
			FlyLinked( "LisaPlenDie_cam05", PlfID, 23, 0, 0, LisaID )
			FlyLinked( "LisaPlenDie_cam06", LisaID, 12, 0, 1, PlfID )
			StartCinematic()

			TActivate( "RolikEnd_LisaPlenDie")
			TActivate( "trLisaPlenDie_cam01" )
			TActivate( "trLisaPlenDie_cam02" )
			TActivate( "trLisaPlenDie_cam03" )
			TActivate( "trLisaPlenDie_cam04" )
			TActivate( "trLisaPlenDie_cam05" )
			TActivate( "trLisaPlenDie_cam06" )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trLisaPlenDie_cam01" active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetGamePositionOnGround( CVector(5511.771, 53.723, 4543.106))
				vehPlayer:SetRotation(Quaternion(-0.003, 0.954, 0.011, 0.301))
				vehPlayer:LimitMaxSpeed(11)
				vehPlayer:SetCustomControlEnabled( true )       
				vehPlayer:SetExternalPathByName("Player_path01")
				vehPlayer:SetThrottle( 1 )                      
				vehPlayer:SetCustomLinearVelocity( 10 )    
				vehPlayer:SetCustomControlEnabled( false )      
			end

			local vehLisa = GetEntityByName("MolokovozMenu")
			if vehLisa then
				vehLisa:SetSkin(2)
				vehLisa:SetGamePositionOnGround( CVector(5505.372, 54.896, 4528.021))
				vehLisa:SetRotation(Quaternion(-0.002, 0.965, 0.011, 0.263))
				vehLisa:SetCruisingSpeed(11)
				vehLisa:SetExternalPathByName("Lisa_path01")
				vehLisa:SetThrottle( 1 )                      
				vehLisa:SetCustomLinearVelocity( 10 ) 
			end

			AddCinematicMessage( 21, 1 )
			AddCinematicMessage( 22, 0.25 )
			AddCinematicMessage( 23, 0.25 )
			AddCinematicMessage( 24, 0.25 )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trLisaPlenDie_cam02" active="0">
		<event flypath="LisaPlenDie_cam02" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>

			AddCinematicMessage( 25, 0.25  )
			AddCinematicMessage( 26, 0.25  )
			AddCinematicMessage( 27, 0.25  )
			AddCinematicMessage( 28, 0.25  )
			AddCinematicMessage( 29, 0.25  )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trLisaPlenDie_cam03" active="0">
		<event flypath="LisaPlenDie_cam03" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			AddCinematicMessage( 210, 0.25 )
			AddCinematicMessage( 211, 0.25 )
			AddCinematicMessage( 212, 0.25 )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trLisaPlenDie_cam04" active="0">
		<event flypath="LisaPlenDie_cam04" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			AddCinematicMessage( 213,0.25 )
			AddCinematicMessage( 214,0.25 )
			AddCinematicMessage( 215, 0.25  )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trLisaPlenDie_cam05" active="0">
		<event flypath="LisaPlenDie_cam05" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>

			GetPlayerVehicle():LimitMaxSpeed(12)

			AddCinematicMessage( 2150, 0.25  )
			AddCinematicMessage( 217, 0.25  )
			AddCinematicMessage( 218, 0.25  )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trLisaPlenDie_cam06" active="0">
		<event flypath="LisaPlenDie_cam06" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			AddCinematicMessage( 219,0.25 )
			AddCinematicMessage( 220, 0.25  )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RolikEnd_LisaPlenDie" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			local vehLisa = GetEntityByName("MolokovozMenu")
			if vehLisa then vehLisa:Remove() end

			local camToch01 = GetEntityByName("camToch01")
			local camToch02 = GetEntityByName("camToch02")
			if camToch01 then camToch01:Remove() end
			if camToch02 then camToch02:Remove() end

			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:UnlimitMaxSpeed()
				vehPlayer:PlaceToEndOfPath("Player_path01")
			end

			RuleConsole("cinematic_spring_coeff 0.7")
			StopPlayingCustomMusic()

			TDeactivate( "trLisaPlenDie_cam01" )
			TDeactivate( "trLisaPlenDie_cam02" )
			TDeactivate( "trLisaPlenDie_cam03" )
			TDeactivate( "trLisaPlenDie_cam04" )
			TDeactivate( "trLisaPlenDie_cam05" )
			TDeactivate( "trLisaPlenDie_cam06" )

			SetCameraBehindPlayerVehicle()
			
			AddHistory(  'r1_Before_Ben_00'  )
			AddFadingMsgId( 'fm_history_got' )

			trigger:Deactivate()
		</script>
	</trigger>

<!-- Перед домом у Бена -->
	<trigger Name="RolikBegin_BenHause" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			CreateNewDummyObject( "point", "point", -1, -1, CVector(3787.429, 123.643, 1824.044), Quaternion( 0.0000, 0.000, 0.0000, 1.0000 ), 0)

			local point= GetEntityByName("point")
			local pointID = point:GetId()

			local PlVehicle = GetPlayerVehicle()
			local PlfCoor = CVector(3736, 125, 1886)
			PlfCoor.y = PlfCoor.y + 2
			PlfCoor.z = PlfCoor.z + 20

			FlyAround( 0.5, 0.1, 2, 10, PlfCoor, pointID, 1, 1 )
			StartCinematic()

			TActivate("RolikBegin_BenHause_Fade")
			TActivate("RolikEnd_BenHause")

			trigger:Deactivate()    
		</script>
	</trigger>

	<trigger Name="RolikBegin_BenHause_Fade" active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			if IsQuestTaken("BenBadEnd") then
				PlayCustomMusic("PromiseGuitar")
			else
				PlayCustomMusic("QuietDialogue01")
			end

			CreateNewDummyObject( "dweller_ben", "HumanBen", -1, -1, CVector(3787.429, 121.943, 1824.044), Quaternion( 0.0000, -0.1240, 0.0000, 0.9923 ), 0)
			if QuestStatus("BenZima_Quest")==Q_TAKEN or QuestStatus("BenGoodEnd")==Q_TAKEN or QuestStatus("BenNormalEnd")==Q_TAKEN then
				CreateNewDummyObject( "dweller_lisa", "HumanLisa", -1, -1, CVector(3786.886, 121.943, 1823.141), Quaternion( 0.0000, -0.1240, 0.0000, 0.9923 ), 0)
			end

			local PlVehicle = GetPlayerVehicle()
			if PlVehicle then
				PlVehicle:SetCustomControlEnabled( true )
				PlVehicle:SetCustomLinearVelocity( 0 )
				PlVehicle:SetThrottle( 0 )
				PlVehicle:SetGamePositionOnGround( CVector(3748, 120, 1858))
				PlVehicle:SetRotation(Quaternion(0.066, 0.965, -0.018, 0.252))
				PlVehicle:SetCustomControlEnabled( false )
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RolikEnd_BenHause" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			local obj01 = GetEntityByName("HumanBen")
			if obj01 then obj01:Remove() 	end
			local obj02 = GetEntityByName("HumanLisa")
			if obj02 then obj02:Remove() 	end
			local point = GetEntityByName("point")
			if point then point:Remove() end

			TDeactivate("RolikBegin_BenHause_Fade")

			local quests_to_complete = {"d_FindHouseOfBen_Quest", "BenBadEnd", "LisaUBena", "r4m2_LisaDieBen", 
										"TalkBeforeDesert", "BenGoodEnd", "BenNormalEnd"}
			for quest = 1, 7 do
				CompleteQuestIfTaken(quests_to_complete[quest])
			end
		
			if GetVar("FindBen").AsInt==1 then
				local quests_to_fail = {"BenEast_Quest", "BenStaruha_Quest", "FindBen2_Quest", "Pomiritsa_Quest", 
								"Chifir_Quest", "VYar_Quest", "FindBenMZ_Quest", "CaravDead_Quest"}
				for quest = 1, 8 do
					FailQuestIfTaken(quests_to_fail[quest])
				end

				local trigs = {"RaidersDie", "PLENLISA", "PLENLISADIE", "trCaravanToPortoDIE", 
								  "trCaravanToPortoLength", "trCaravanToPortoINPLACE", 
								  "trCaravanToMidgardINPLACE", "trCaravanToMidgardDIE", 
								  "trCaravanToMidgardLength"}
				for trig = 1, 9 do
					TDeactivate(trigs[trig])
				end

				TakeQuest("QuickFindBen")
				CompleteQuest("QuickFindBen")

				SetVar("FindBen",2)

				local carav = GetEntityByName("KARAVANPORTO_vehicle_0")
				if carav then carav:Remove() end
				local carav2 = GetEntityByName("KARAVANMIDGARD_vehicle_0")
				if carav2 then carav2:Remove() end
			end

			if IsQuestComplete("BenNormalEnd") or IsQuestComplete("BenGoodEnd") then
				StartConversation( "Lisa" )
			elseif QuestStatus("BenZima_Quest")==Q_TAKEN then
				CompleteQuestIfTaken("BenZima_Quest")
				StartConversation( "Lisa2" )
			else
				StartConversation( "Ben" )
			end

			SetCameraBehindPlayerVehicle()
			
			TActivate("tr_THEBEN")

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Перебивка "На следующий день" у Бена -->
	<trigger Name="NextDayTr" active="0">
		<event	timeout="0"		eventid="GE_TIME_PERIOD" />
		<script>
			
			SaveAllToleranceStatus(RS_NEUTRAL)

			SetGameTime(9, 0)
			
			Fly("NextDayCam", CINEMATIC_NO_AIM, 0, 7, 0, 1 )
			StartCinematic()
			
			AddCinematicMessage( 88060, 1 )
			
			TActivate("NextTrEnd2")

			if IsQuestComplete("BenNormalEnd") or IsQuestComplete("BenGoodEnd") then
				CreateNewDummyObject("dweller_ben", "humBen", -1, -1, CVector(3780.104, 121.954, 1814.842), Quaternion(0.0000, 0.7056, 0.0000, 0.7086), 0)
				CreateNewDummyObject("dweller_lisa", "humLisa", -1, -1, CVector(3780.797, 121.956, 1813.882), Quaternion(0, 0, 0, 1), 0)
				CreateNewDummyObject("dweller_player", "humPlayer", -1, -1, CVector(3781.449, 121.956, 1814.840), Quaternion(0.0000, -0.7826, 0.0000, 0.6225), 0)

				getObj("humPlayer"):SetNodeAction(AT_RESERVED1)
				getObj("humPlayer"):SetNextForAnimation(AT_RESERVED1, AT_STAND1)

				getObj("humLisa"):SetNodeAction(AT_STAND2)
				getObj("humLisa"):SetNextForAnimation(AT_STAND2, AT_STAND1)

				getObj("humBen"):SetNodeAction(AT_RESERVED1)
				getObj("humBen"):SetNextForAnimation(AT_RESERVED1, AT_STAND1)
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="NextTrEnd2" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			SetCameraBehindPlayerVehicle()

			local humB = GetEntityByName("humBen")
			if humB then humB:Remove() end

			local humL = GetEntityByName("humLisa")
			if humL then humL:Remove() end

			local humP = GetEntityByName("humPlayer")
			if humP then humP:Remove() end
			
			if IsQuestComplete("BenNormalEnd") or IsQuestComplete("BenGoodEnd") then
				StartConversation("Lisa")

				trigger:Deactivate()
			elseif QuestStatus("FindGomer2_Quest")==Q_TAKEN then
				trigger:Deactivate()
			end
			
		</script>
	</trigger>

	<!-- Перебивка "Спустя пару часов" у Бена -->
	<trigger Name="NextHoursTr" active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)
			
			Fly("NextDayCam", CINEMATIC_NO_AIM, 0, 7, 0, 1 )
			StartCinematic()
			
			AddCinematicMessage( 88062, 1 )
			
			TActivate("NextTrEnd")

			if IsQuestComplete("BenNormalEnd") or IsQuestComplete("BenGoodEnd") then
				if GetVar("BenDwelPosition").AsString == "normal" then
					CreateNewDummyObject("dweller_ben", "humBen", -1, -1, CVector(3780.104, 121.954, 1814.842), Quaternion(0.0000, 0.7056, 0.0000, 0.7086), 0)
					CreateNewDummyObject("dweller_lisa", "humLisa", -1, -1, CVector(3780.797, 121.956, 1813.882), Quaternion(0, 0, 0, 1), 0)
					CreateNewDummyObject("dweller_player", "humPlayer", -1, -1, CVector(3781.449, 121.956, 1814.840), Quaternion(0.0000, -0.7826, 0.0000, 0.6225), 0)

					getObj("humPlayer"):SetNodeAction(AT_RESERVED1)
					getObj("humPlayer"):SetNextForAnimation(AT_RESERVED1, AT_STAND1)

					getObj("humLisa"):SetNodeAction(AT_STAND2)
					getObj("humLisa"):SetNextForAnimation(AT_STAND2, AT_STAND1)

					getObj("humBen"):SetNodeAction(AT_RESERVED1)
					getObj("humBen"):SetNextForAnimation(AT_RESERVED1, AT_STAND1)
				elseif GetVar("BenDwelPosition").AsString == "LisaNewCar" then
					CreateNewDummyObject("dweller_ben", "humBen", -1, -1, CVector(3765.977, 116.988, 1806.781), Quaternion(0.0000, -0.5592, 0.0000, 0.8290), 0)
					CreateNewDummyObject("dweller_lisa", "humLisa", -1, -1, CVector(3762.207, 116.903, 1808.512), Quaternion(0.0000, 0.8605, 0.0000, 0.5094), 0)
					CreateNewDummyObject("dweller_player", "humPlayer", -1, -1, CVector(3778.596, 121.960, 1814.233), Quaternion(0.0000, -0.8266, 0.0000, 0.5628), 0)

					local vehLisa = CreateVehicleEx("LisaCar", "CARLISA_1", CVector(3763.702, 117.920, 1805.722), 1042, Quaternion(-0.008, -0.245, -0.030, 0.969))
					if vehLisa then
						vehLisa:SetSkin(2)
					end

					getObj("humBen"):SetNodeAction(AT_RESERVED1)
					getObj("humBen"):SetNextForAnimation(AT_RESERVED1, AT_STAND1)
				end
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="NextTrEnd" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			
			RestoreAllToleranceStatus()

			SetCameraBehindPlayerVehicle()

			local humB = GetEntityByName("humBen")
			if humB then humB:Remove() end

			local humL = GetEntityByName("humLisa")
			if humL then humL:Remove() end

			local humP = GetEntityByName("humPlayer")
			if humP then humP:Remove() end

			local vehLisa = GetEntityByName("CARLISA_1")
			if vehLisa then vehLisa:Remove() end
			
			if IsQuestComplete("BenNormalEnd") then
				StartConversation("Ben")
			elseif good_ending == 1 then
				StartConversation("Ben")
				good_ending = 0
			else
				StartConversation("Lisa")
			end

			SetVar("BenDwelPosition", "normal")

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Едем в Мидгард за сплавом после Бена -->
	<trigger	Name="trToMidgardForComposite"	active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>

			SetWeather(1)

			SaveAllToleranceStatus(RS_NEUTRAL)

			Fly("BefDesert", CINEMATIC_AIM_TO_ID, GetPlayerVehicleId(), 7.5, 0, 1 )
			StartCinematic()

			AddCinematicMessage( 88060, 1 )

			local Plf = GetPlayerVehicle()
			if Plf then
				Plf:SetGamePositionOnGround( CVector(4163.968, 117.857, 916.957))
				Plf:SetRotation(Quaternion(-0.006, 0.745, 0.027, 0.666))
				Plf:SetExternalPathByName("BeforeDesert")
				Plf:SetCustomLinearVelocity( 10 )
				Plf:LimitMaxSpeed(17)
			end

			TActivate("trToMidgardForComposite_End")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trToMidgardForComposite_End" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			SetCameraBehindPlayerVehicle()

			local Plf = GetPlayerVehicle()
			if Plf then
				Plf:SetExternalPathByName("BeforeDesert")
				Plf:PlaceToEndOfPath("BeforeDesert")
				Plf:UnlimitMaxSpeed()
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Плохая концовка -->
	<trigger Name="BadEndingBegin" active="0">
		<event	timeout="0"		eventid="GE_TIME_PERIOD" />
		<script>			
			SaveAllToleranceStatus(RS_NEUTRAL)
			
			PlayCustomMusic("Death01")
			
			SetGameTime( 9, 0 )
			
			SetWeather(0)

			local vehPID = GetPlayerVehicleId()
			
			Fly("BenSamokillCam", CINEMATIC_NO_AIM, 0, 11, 0, 0 )
			Fly("EndingCam1", CINEMATIC_AIM_TO_ID, vehPID, 7, 0, 0 )
			Fly("EndingCam2", CINEMATIC_AIM_TO_ID, vehPID, 10, 0, 0 )
			Fly("EndingCam3", CINEMATIC_AIM_TO_ID, vehPID, 31, 0, 0 )
			Fly("EndingCam4", CINEMATIC_AIM_TO_ID, vehPID, 28, 0, 0 )
			Fly("EndingCam5", CINEMATIC_AIM_TO_ID, vehPID, 13, 0, 0 )
			Fly("EndingCam6", CINEMATIC_AIM_TO_ID, vehPID, 12, 0, 0 )
			Fly("PreSuicCam", CINEMATIC_NO_AIM, 0, 20, 0, 0 )
			Fly("SuicCam", CINEMATIC_NO_AIM, 0, 17.5, 0, 1 )
			StartCinematic()
			
			TActivate("BadEndCam1")
			TActivate("BadEndCam2")
			TActivate("BadEndCam3")
			TActivate("BadEndCam4")
			TActivate("BadEndCam5")
			TActivate("BadEndCam6")
			TActivate("PreSuicCam")
			TActivate("SuicCam")
			TActivate("preTitryCam")
			TActivate("BenExplode")

			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:LimitMaxSpeed(25)
				vehPlayer:SetThrottle( 1 )
				vehPlayer:setImmortalMode(1)
				vehPlayer:setGodMode(1)
				vehPlayer:SetCustomLinearVelocity( 20 )
				vehPlayer:SetGamePositionOnGround( CVector(3706.163, 123.341, 1864.144))
				vehPlayer:SetRotation(Quaternion(-0.007, -0.990, -0.019, 0.139))
				vehPlayer:SetExternalPathByName("BenSuic")
			end

			for name = 2,3 do
				local dot = GetEntityByName("barricade7_GwG95_Child"..name)
				if dot then dot:Remove() end
			end

			local murav = GetEntityByName("barricade8_wwwC97_Child4")
			if murav then murav:Remove() end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="BenExplode" active="0">
		<event	timeout="9"		eventid="GE_TIME_PERIOD" />
		<script>
		
			CreateEffectInsertedInRemove( "ET_PS_VEH_EXP1_MED1", CVector(3777.386, 116, 1814.312), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), true )
			CreateEffectInsertedInRemove( "ET_PS_VEH_EXP1_MED1", CVector(3790.160, 116, 1797.764), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), true )
			
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE01", -1, -1, CVector(3777.386, 116, 1814.312), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE02", -1, -1, CVector(3794.967, 130, 1805.147), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="BadEndCam1" active="0">
		<event flypath="EndingCam1" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
		
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetGamePositionOnGround( CVector(2732.070, 113.068, 1046.900))
				vehPlayer:SetRotation(Quaternion(0.017, -0.621, 0.056, 0.782))
				vehPlayer:SetExternalPathByName("EndingPlWay1")
				vehPlayer:SetThrottle( 1 )
				vehPlayer:SetCustomLinearVelocity( 20 )
			end
			
			AddCinematicMessage( 224, 1 )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="BadEndCam2" active="0">
		<event flypath="EndingCam2" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
		
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetGamePositionOnGround( CVector(2464.559, 74.963, 1638.169))
				vehPlayer:SetRotation(Quaternion(0.056, -0.326, 0.043, 0.943))
				vehPlayer:SetExternalPathByName("EndingPlWay2")
				vehPlayer:SetThrottle( 1 )
				vehPlayer:SetCustomLinearVelocity( 20 )
			end
			
			AddCinematicMessage( 225, 1 )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="BadEndCam3" active="0">
		<event flypath="EndingCam3" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
		
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetGamePositionOnGround( CVector(2236.983, 79.629, 4281.508))
				vehPlayer:SetRotation(Quaternion(-0.004, -0.075, 0.018, 0.997))
				vehPlayer:SetThrottle( 1 )
				vehPlayer:SetCustomLinearVelocity( 20 )
				vehPlayer:SetExternalPathByName("EndingPlWay3")
			end
			
			AddCinematicMessage( 226, 1 )
			AddCinematicMessage( 227, 1 )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="BadEndCam4" active="0">
		<event flypath="EndingCam4" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
		
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetGamePositionOnGround( CVector(2382.853, 76.765, 5852.935))
				vehPlayer:SetRotation(Quaternion(-0.001, -0.171, -0.024, -0.985))
				vehPlayer:SetThrottle( 1 )
				vehPlayer:SetCustomLinearVelocity( 20 )
				vehPlayer:SetExternalPathByName("EndingPlWay4")
			end
			
			AddCinematicMessage( 228, 1 )
			AddCinematicMessage( 229, 1 )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="BadEndCam5" active="0">
		<event flypath="EndingCam5" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
		
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetGamePositionOnGround( CVector(2284.962, 81.149, 6843.955))
				vehPlayer:SetRotation(Quaternion(0.005, 0.182, -0.018, -0.983))
				vehPlayer:SetThrottle( 1 )
				vehPlayer:SetCustomLinearVelocity( 20 )
				vehPlayer:SetExternalPathByName("EndingPlWay5")
			end
			
			AddCinematicMessage( 230, 1 )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="BadEndCam6" active="0">
		<event flypath="EndingCam6" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
		
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetGamePositionOnGround( CVector(2533.149, 78.051, 7071.704))
				vehPlayer:SetRotation(Quaternion(0.034, 0.596, -0.001, 0.803))
				vehPlayer:SetThrottle( 1 )
				vehPlayer:SetCustomLinearVelocity( 20 )
				vehPlayer:SetExternalPathByName("EndingPlWay6")
			end
			
			AddCinematicMessage( 231, 1 )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="PreSuicCam" active="0">
		<event flypath="PreSuicCam" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
		
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetGamePositionOnGround( CVector(3247.561, 42.211, 7247.719))
				vehPlayer:SetRotation(Quaternion(-0.024, -0.534, 0.026, -0.845))
				vehPlayer:SetThrottle( 1 )
				vehPlayer:SetCustomLinearVelocity( 20 )
				vehPlayer:SetExternalPathByName("PlayerPreSuic")
			end
			
			AddCinematicMessage( 232, 1 )
			AddCinematicMessage( 233, 1 )
			AddCinematicMessage( 234, 1 )
			AddCinematicMessage( 235, 1 )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="SuicCam" active="0">
		<event flypath="SuicCam" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
		
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:setImmortalMode(1)
				vehPlayer:SetExternalPathByName("PlayerSuic")
			end
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="preTitryCam" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
		
			PlayCustomMusic("Promise")

			Fly("start_game", CINEMATIC_NO_AIM, 0, 365, 0, 1 )
			StartCinematic()

			AddCinematicMessage( 5968, 0)
			AddCinematicMessage( 5967, 0.1)
			AddCinematicMessage( 59689, 0.1)
			AddCinematicMessage( 5965, 0.1)
			AddCinematicMessage( 5966, 0.1)
			

			TActivate("BadEndEnd")
			TActivate("BadEndSkip")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="BadEndEnd" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<script>
		
			RestoreAllToleranceStatus()	
		
			StopPlayingCustomMusic()
			
			SpawnMessageBox( "5964" )
			
			ShowDeathMenu()

			TDeactivate("BadEndSkip")
			TDeactivate("BadEndCam1")
			TDeactivate("BadEndCam2")
			TDeactivate("BadEndCam3")
			TDeactivate("BadEndCam4")
			TDeactivate("BadEndCam5")
			TDeactivate("BadEndCam6")
			TDeactivate("PreSuicCam")
			TDeactivate("SuicCam")

			CheckPlayerVehicle()
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="BadEndSkip" active="0">
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
		
			StopPlayingCustomMusic()
			
			SpawnMessageBox( "5969" )
			
			ShowDeathMenu()

			TDeactivate("BadEndEnd")
			TDeactivate("BadEndCam1")
			TDeactivate("BadEndCam2")
			TDeactivate("BadEndCam3")
			TDeactivate("BadEndCam4")
			TDeactivate("BadEndCam5")
			TDeactivate("BadEndCam6")
			TDeactivate("PreSuicCam")
			TDeactivate("SuicCam")

			CheckPlayerVehicle()
			
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Нормальная концовка -->
	<trigger Name="NormalEndCin" active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			PlayCustomMusic("QuietDialogue01")

			fly_amount = 1

			SetGameTime( 9, 0 )
			
			SetWeather(0)

			if IsQuestComplete("r4m2_BlokiratorToUFO") then
				boss_skin = 1
			elseif IsQuestComplete("r2m1_DestroyAlienShip") then
				boss_skin = 0
			end

			CreateNewDummyObject("end_screen", "CurPicture", -1, -1, CVector(4953.597, 19.018, 7935.530), Quaternion(0.0000, 0.7284, 0.0000, 0.6852), boss_skin)

			CreateNewDummyObject( "dweller_ben", "HumanBen", -1, -1, CVector(3782.793, 121.943, 1820.308), Quaternion( 0.000, -0.313, 0.000, 0.950 ), 0)

			local vehLisa = CreateVehicleEx("LisaCar", "CARLISA", CVector(3760.050, 118.701, 1779.471), 1042, Quaternion(-0.008, -0.245, -0.030, 0.969))
			local Plf = GetPlayerVehicle()
			if Plf then
				Plf:SetGamePositionOnGround(CVector(3766.743, 118.064, 1787.009))
				Plf:SetRotation(Quaternion(-0.004, -0.230, -0.045, 0.972))
			end

			if vehLisa then vehLisa:SetSkin(2) end

			Fly("NormalEndCam1", CINEMATIC_NO_AIM, nil, 30, 0, 1)
			Fly("start_game", CINEMATIC_NO_AIM, nil, 1, 0, 0)
			Fly("EndingScreenCam1", CINEMATIC_NO_AIM, nil, 10, 0, 0)
			Fly("EndingScreenCam1", CINEMATIC_NO_AIM, nil, 10, 0, 0)
			Fly("EndingScreenCam1", CINEMATIC_NO_AIM, nil, 10, 0, 0)
			Fly("EndingScreenCam1", CINEMATIC_NO_AIM, nil, 10, 0, 0)
			Fly("EndingScreenCam1", CINEMATIC_NO_AIM, nil, 10, 0, 0)
			Fly("EndingScreenCam1", CINEMATIC_NO_AIM, nil, 10, 0, 0)
			Fly("EndingScreenCam1", CINEMATIC_NO_AIM, nil, 10, 0, 0)
			Fly("EndingScreenCam1", CINEMATIC_NO_AIM, nil, 10, 0, 1)
			StartCinematic()

			TActivate("NormalEndFade")
			TActivate("NormalEndBeforeNarrator")
			TActivate("narratorschoose")
			TActivate("preTirtyNormal_cam")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="NormalEndFade" active="0">
		<event	timeout="5"		eventid="GE_TIME_PERIOD" />
		<script>
			
			local vehLisa = GetEntityByName("CARLISA")
			local Plf = GetPlayerVehicle()

			if Plf then
				Plf:SetExternalPathByName("Player_path04")
				Plf:LimitMaxSpeed(20)
			end

			if vehLisa then
				vehLisa:SetExternalPathByName("Lisa_path02")
				vehLisa:SetMaxSpeed(20)
				vehLisa:SetCruisingSpeed(20)
			end
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="NormalEndBeforeNarrator" active="0">
		<event flypath="start_game" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			PlayCustomMusic("IntenseDialogue04")

			AddCinematicMessage( 5968, 0)

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="narratorschoose" active="0">
		<event flypath="EndingScreenCam1" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>

			if fly_amount == 1 then
				RuleConsole("g_postEffect BWFadeIn")

				-- блок Оракул/Ньери
				if IsQuestComplete("r4m2_BlokiratorToUFO") then
					AddCinematicMessage( 77774, 0 )
					AddCinematicMessage( 77775, 0.1 )
					AddCinematicMessage( 77776, 0.1 )
					boss_skin = 1
				elseif IsQuestComplete("r2m1_DestroyAlienShip") then
					AddCinematicMessage( 77771, 0 )
					AddCinematicMessage( 77772, 0.1 )
					AddCinematicMessage( 77773, 0.1 )
					boss_skin = 0
				end

				local pic = GetEntityByName("CurPicture")
				if pic then pic:SetSkin(boss_skin) end

				fly_amount = fly_amount + 1

			elseif fly_amount == 2 then
			
				-- блок Фатерлянд        
				if IsQuestComplete("Zachisti3_Quest") then
					AddCinematicMessage( 77779, 0 )
					if QuestStatus("d_IntrigaOfMerMinin_Quest")==Q_COMPLETED then
						AddCinematicMessage( 77780, 0.1 )
					end
					r1m3_skin = 2
				elseif IsQuestComplete("FightForPesht") then
					AddCinematicMessage( 77778, 0 )
					r1m3_skin = 3
				else
					AddCinematicMessage( 77777, 0 )
					r1m3_skin = 4
				end

				local pic = GetEntityByName("CurPicture")
				if pic then pic:SetSkin(r1m3_skin) end

				fly_amount = fly_amount + 1
			
			elseif fly_amount == 3 then
			
				-- блок Роща Друидов
				if IsQuestComplete("r3m1_RescueUlukCivil_TakeToSet") and IsQuestComplete("r3m1_ClearSanctuary") then
					AddCinematicMessage( 77781, 0 )
					r3m1_skin = 5
				elseif IsQuestComplete("r3m1_ClearSanctuary") and not(IsQuestComplete("r3m1_RescueUlukCivil_TakeToSet")) then
					AddCinematicMessage( 77782, 0 )
					AddCinematicMessage( 77783, 0.1 )
					r3m1_skin = 6
				else 
					AddCinematicMessage( 77784, 0 )
					AddCinematicMessage( 77785, 0.1 )
					r3m1_skin = 7
				end

				local pic = GetEntityByName("CurPicture")
				if pic then pic:SetSkin(r3m1_skin) end

				fly_amount = fly_amount + 1

			elseif fly_amount == 4 then

				-- блок Либриум/Аржан
				if IsQuestComplete("FinalBattle_Quest") then
					AddCinematicMessage( 77786, 0 )
					AddCinematicMessage( 77787, 0.1 )
					r2m1_skin = 8
				elseif IsQuestComplete("d_MoveWithGeneralToGelvetcia_Quest") then
					AddCinematicMessage( 77788, 0 )
					r2m1_skin = 9
				elseif IsQuestComplete("r2m2_KillMrPresidentAndOther") then
					AddCinematicMessage( 77789, 0 )
					AddCinematicMessage( 77790, 0.1 )
					r2m1_skin = 10
				end

				local pic = GetEntityByName("CurPicture")
				if pic then pic:SetSkin(r2m1_skin) end

				fly_amount = fly_amount + 1

			elseif fly_amount == 5 then
			
				-- блок ТСП/Рыбаки
				if QuestStatus("FreeExtremistLeader_Quest5")==Q_COMPLETED then
					AddCinematicMessage( 77794, 0 )
					r1m4_skin = 11
				elseif QuestStatus("WaitTillEnd")==Q_COMPLETED then
					AddCinematicMessage( 77795, 0 )
					r1m4_skin = 12
				end

				local pic = GetEntityByName("CurPicture")
				if pic then pic:SetSkin(r1m4_skin) end

				fly_amount = fly_amount + 1

			elseif fly_amount == 6 then
			
				-- блок ОЛ/АКФ
				if QuestStatus("GoToMudrec_Quest")==Q_COMPLETED then
					AddCinematicMessage( 77796, 0 )
					r1m6_skin = 13
				elseif QuestStatus("GoToMudr_Quest")==Q_COMPLETED then
					AddCinematicMessage( 77797, 0 )
					r1m6_skin = 14
				end

				local pic = GetEntityByName("CurPicture")
				if pic then pic:SetSkin(r1m6_skin) end

				fly_amount = fly_amount + 1

			elseif fly_amount == 7 then

				AddCinematicMessage( 77792, 0 )

				local pic = GetEntityByName("CurPicture")
				if pic then pic:SetSkin(15) end

				fly_amount = fly_amount + 1

			elseif fly_amount == 8 then
			
				AddCinematicMessage( 77793, 0 )

				local pic = GetEntityByName("CurPicture")
				if pic then pic:SetSkin(16) end

				trigger:Deactivate()
			end
		</script>
	</trigger>

	<trigger Name="preTirtyNormal_cam" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RuleConsole("g_postEffect BWFadeOut")

			local pic = GetEntityByName("CurPicture")
			if pic then pic:Remove() end

			local hBen = GetEntityByName("HumanBen")
			if hBen then hBen:Remove() end

			local vehLisa = GetEntityByName("CARLISA")
			if vehLisa then vehLisa:Remove() end

			local Plf = GetPlayerVehicle()
			if Plf then
				Plf:PlaceToEndOfPath("Player_path04")
				Plf:UnlimitMaxSpeed()
			end

			TDeactivate("NormalEndBeforeNarrator")

			PlayCustomMusic("Tiamat")

			Fly("start_game", CINEMATIC_NO_AIM, 0, 327, 0, 1 )
			StartCinematic()

			AddCinematicMessage( 5968, 0)
			AddCinematicMessage( 5973, 0.1)
			AddCinematicMessage( 5974, 0.1)
			AddCinematicMessage( 5971, 0.1)
			AddCinematicMessage( 5972, 0.1)

			fly_amount = nil
			boss_skin = nil
			r1m3_skin = nil
			r3m1_skin = nil
			r2m1_skin = nil
			r1m4_skin = nil
			r1m6_skin = nil

			TActivate("TirtyNormal_End")
			TActivate("TirtyNormal_Skip")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="TirtyNormal_End" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<script>

			RestoreAllToleranceStatus()	
		
			StopPlayingCustomMusic()
			
			SpawnMessageBox( "5970" )
			
			ShowDeathMenu()

			TDeactivate("TirtyNormal_Skip")

			CheckPlayerVehicle()
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="TirtyNormal_Skip" active="0">
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>

			RestoreAllToleranceStatus()	
		
			StopPlayingCustomMusic()
			
			SpawnMessageBox( "5969" )
			
			ShowDeathMenu()

			TDeactivate("TirtyNormal_End")

			CheckPlayerVehicle()
			
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- После Бабы Поли, активация бонусной концовки -->
	<trigger	Name="cinAfterChifir2"	active="0">
		<event	timeout="0"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetCustomControlEnabled( true )
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:SetThrottle( 0 )
				vehPlayer:SetCustomControlEnabled( false )
				vehPlayer:SetGamePositionOnGround(CVector(3518.390, 90.903, 5192.647))
				vehPlayer:SetRotation(Quaternion(-0.010, 0.745, 0.010, -0.667))
			end

			Fly("ShlyapaCam1", CINEMATIC_AIM_TO_ID, GetPlayerVehicleId(), 9, 0, 1 )
			StartCinematic()

			stuff = {"LisaContGoodEnd", "LisaInTroick_vehicle_0", "Human59" ,"Human4", "Human99"}

			for item = 1,5 do
				local st = GetEntityByName(stuff[item])
				if st then st:Remove() end
			end

			TActivate("cinAfterChifir2Fade")
			TActivate("cinAfterChifir2End")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="cinAfterChifir2Fade" active="0">
		<event	timeout="0.5"		eventid="GE_TIME_PERIOD" />
		<script>
			PlayCustomMusic("Bio04")

			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetCustomControlEnabled( true )
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:SetThrottle( 0 )
				vehPlayer:SetCustomControlEnabled( false )
				vehPlayer:SetGamePositionOnGround(CVector(3518.390, 90.903, 5192.647))
				vehPlayer:SetRotation(Quaternion(-0.010, 0.745, 0.010, -0.667))
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="cinAfterChifir2End" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			SetCameraBehindPlayerVehicle()

			StopPlayingCustomMusic()

			PassToMap("r1m8", "FromR1M2", -1, 1)

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Осмотр полей со знаками возле Яра -->
	<trigger Name="THESIGNONFIELD" active="1">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Sign_location" />
		<script>
			if IsQuestTaken("SeeSigns_Quest")  then
				SaveAllToleranceStatus(RS_NEUTRAL)
				
				PlayCustomMusic("Bio02")

				local Plf = GetPlayerVehicle()
				Plf:SetCustomControlEnabled( true )
				Plf:SetCustomLinearVelocity( 0 )
				Plf:SetThrottle( 0 )
				Plf:SetCustomControlEnabled( false )

				Fly("signfly", CINEMATIC_AIM_TO_POINT, CVector(960,70,4004), 15, 1, 1 )
				StartCinematic()

				AddCinematicMessage( 1, 1 )

				TActivate("THESIGNONFIELD_ec")

				CompleteQuestIfTaken( "SeeSigns_Quest" )

				trigger:Deactivate()
			end
		</script>
	</trigger>

	<trigger Name="THESIGNONFIELD_ec" active="0">
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			SetCameraBehindPlayerVehicle()
			
			StopPlayingCustomMusic()

			trigger:Deactivate() 
		</script>
	</trigger>

	<!-- Похитили прораба археологов -->
	<trigger	Name="cinAfterKidnapping"	active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>
			local Plf = GetPlayerVehicle()
			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.y = PlfCoor.y + 5
			PlfCoor.z = PlfCoor.z + 15

			Plf:SetCustomLinearVelocity(0)
			Plf:SetThrottle(0)

			SaveAllToleranceStatus(RS_NEUTRAL)

			FlyAround(1, 0, 15, 9, PlfCoor, PlfID, 1, 1 )
			StartCinematic()

			AddCinematicMessage( 88059, 1 )

			TActivate("cinAfterKidnappingEnd")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="cinAfterKidnappingEnd" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			SetCameraBehindPlayerVehicle()

			local arch = GetEntityByName("CarOfSiencer_vehicle_0")
			if arch then arch:Remove() end

			AddQuestItem("ArchProrab_P")
			AddFadingMsgByStrIdFormatted( "fm_player_add_poput", "ArchProrab_P")

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Первая битва в Колизее -->
	<trigger Name="RolikBegin_Kolizey1" active="0">
		<event timeout=" 0 " eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			RuleConsole("cinematic_spring_coeff 1.7")
			PlayCustomMusic("Passage01unloop")

			CreateNewDummyObject( "cargo", "CamTochka", -1, -1, CVector(7158.604, 167.977, 3378.776), Quaternion(0.003, 0.828, -0.001, -0.561), 0)

			local RGlad2 = CreateVehicleEx("MolokovozKolizey","RolikGlad1",CVector(7108.745, 188.093, 3170.135), 1002)
			if RGlad2 then RGlad2:SetRandomSkin() end

			local RGlad2ID = RGlad2:GetId()
			local PlVehicle = GetPlayerVehicle()
			local PlID = GetPlayerVehicleId()
			local CToch = GetEntityByName("CamTochka")
			local CTochID = CToch:GetId()

			local Ort = CreateNewDummyObject( "dweller_white", "Orator", -1, -1, CVector(7282.624, 227.500, 3264.708), Quaternion( 0.002, 0.468, -0.002, -0.884 ), 3)

			if PlVehicle then
				PlVehicle:SetCustomControlEnabled( true )
				PlVehicle:SetExternalPathByName("Player_path02")
				PlVehicle:SetThrottle( 1 )
				PlVehicle:SetCustomLinearVelocity( 30 )
				PlVehicle:LimitMaxSpeed(20)
				PlVehicle:SetCustomControlEnabled( false )
			end

			FlyLinked( "Kol2_cam01", PlID, 7, 1, 0, PlID )
			Fly("Kol2_cam02", CINEMATIC_NO_AIM, 0, 7, 0, 0 )
			FlyLinked( "Kol2_cam03", CTochID, 10, 0, 1, RGlad2ID )
			StartCinematic()

			TActivate("RolikEnd_Kolizey1")
			TActivate("trKol1_cam02")

			trigger:Deactivate()    
		</script>
	</trigger>

	<trigger Name="trKol1_cam02" active="0">
		<event flypath="Kol2_cam02" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			AddCinematicMessage( 221, 2 )

			local RGlad2 = GetEntityByName("RolikGlad1")
			if RGlad2 then
				RGlad2:SetRotation(Quaternion(-0.142, 0.336, -0.061, -0.929))
				RGlad2:SetExternalPathByName("GladiatorPath01")
				RGlad2:SetThrottle( 1 )
				RGlad2:SetCustomLinearVelocity( 40 )
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RolikEnd_Kolizey1" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			StopPlayingCustomMusic()
			RuleConsole("cinematic_spring_coeff 0.7")

			local PlVehicle = GetPlayerVehicle()
			if PlVehicle then
				PlVehicle:SetCustomControlEnabled( true )
				PlVehicle:PlaceToEndOfPath("Player_path02")
				PlVehicle:SetCustomControlEnabled( false )
				PlVehicle:UnlimitMaxSpeed()
			end

			local obj01 = GetEntityByName("Orator")
			if obj01 then
				obj01:Remove()
			end
			local obj02 = GetEntityByName("RolikGlad1")
			if obj02 then
				skin = obj02:GetSkin()
				obj02:Remove()
			end
			local obj03 = GetEntityByName("CamTochka")
			if obj03 then
				obj03:Remove()
			end

			CreateNewDummyObject( "rotund", "ZABOR", -1, -1, CVector(7084, 155, 3942), Quaternion(0.0037,0.9063,0.0079,0.4226), 0)

			TeamCreate("Gladiator1",1002,CVector(7244.941, 156, 3477.613),{"MolokovozKolizey"},CVector(7117, 156, 3758))
			local RGlad2 = GetEntityByName("Gladiator1")
			if RGlad2 then RGlad2:GetVehicle(0):SetSkin(skin) end

			skin = nil

			CompleteQuest("CombatInKollizey_Quest1")

			TDeactivate("trKol1_cam02")

			TActivate("KOLIZEYFIGHTDIE1")

			SetCameraBehindPlayerVehicle()

			trigger:Deactivate()
		</script>
	</trigger>

<!-- Вторая битва в Колизее -->
	<trigger Name="RolikBegin_Kolizey2" active="0">
		<event timeout=" 0 " eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			RuleConsole("cinematic_spring_coeff 1.7")
			PlayCustomMusic("IntenseDialogue03")

			CreateNewDummyObject( "cargo", "CamTochka", -1, -1, CVector(7158.604, 167.977, 3378.776), Quaternion(0.003, 0.828, -0.001, -0.561), 0)

			local RGlad2 = CreateVehicleEx("Gladiator02","RolikGlad2",CVector(7108.745, 188.093, 3170.135), 1002)
			local PlVehicle = GetPlayerVehicle()
			local CToch = GetEntityByName("CamTochka")
			local PlID = GetPlayerVehicleId()
			local CTochID = CToch:GetId()
			local RGlad2ID = RGlad2:GetId()
			local Ort = CreateNewDummyObject( "dweller_white", "Orator", -1, -1, CVector(7282.624, 227.500, 3264.708), Quaternion( 0.002, 0.468, -0.002, -0.884 ), 3)

			if PlVehicle then
				PlVehicle:SetExternalPathByName("Player_path02")
				PlVehicle:LimitMaxSpeed(20)
				PlVehicle:SetThrottle( 1 )
				PlVehicle:SetCustomLinearVelocity( 30 )
			end

			FlyLinked( "Kol2_cam01", PlID, 6, 1, 0, PlID )
			Fly("Kol2_cam02", CINEMATIC_NO_AIM, 0, 6, 0, 0 )
			FlyLinked( "Kol2_cam21", RGlad2ID, 3, 0, 0, nil, nil, true )
			FlyLinked( "Kol2_cam03", CTochID, 6, 0, 1, RGlad2ID )
			StartCinematic()

			TActivate("RolikEnd_Kolizey2")
			TActivate("trKol2_cam02")
			TActivate("trKol2_cam03")

			trigger:Deactivate()    
		</script>
	</trigger>

	<trigger Name="trKol2_cam02" active="0">
		<event flypath="Kol2_cam02" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			AddCinematicMessage( 222, 1 )

			local RGlad2 = GetEntityByName("RolikGlad2")
			if RGlad2 then
				RGlad2:SetRotation(Quaternion(-0.142, 0.336, -0.061, -0.929))
				RGlad2:SetExternalPathByName("GladiatorPath01")
				RGlad2:SetThrottle( 1 )
				RGlad2:SetCustomLinearVelocity( 10 )
				RGlad2:SetRandomSkin()
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trKol2_cam03" active="0">
		<event flypath="Kol2_cam03" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			local RGlad2 = GetEntityByName("RolikGlad2")
			if RGlad2 then
				RGlad2:SetThrottle( 1 )
				RGlad2:SetCustomLinearVelocity( 30 )
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RolikEnd_Kolizey2" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			local PlVehicle = GetPlayerVehicle()
			if PlVehicle then
				PlVehicle:SetCustomControlEnabled( true )
				PlVehicle:PlaceToEndOfPath("Player_path02")
				PlVehicle:SetCustomControlEnabled( false )
				PlVehicle:UnlimitMaxSpeed()
			end

			local obj01 = GetEntityByName("Orator")
			if obj01 then
				obj01:Remove()
			end
			local obj02 = GetEntityByName("RolikGlad2")
			if obj02 then
				gskin = obj02:GetSkin()
				obj02:Remove()
			end
			local obj03 = GetEntityByName("CamTochka")
			if obj03 then
				obj03:Remove()
			end

			TeamCreate("Gladiator2",1002,CVector(7237.718, 164.624, 3475.819),{"Gladiator02"},CVector(7097.258, 157.158, 3653.507), 0, Quaternion(0.002, 0.248, 0.023, -0.969))
			local gcar = GetEntityByName("Gladiator2")
			if gcar then gcar:GetVehicle(0):SetSkin(gskin) end

			gskin = nil

			CreateNewDummyObject( "rotund", "ZABOR", -1, -1, CVector(7084, 155, 3942), Quaternion(0.0037,0.9063,0.0079,0.4226), 0)

			TDeactivate("trKol2_cam02")
			TDeactivate("trKol2_cam03")
			StopPlayingCustomMusic()
			RuleConsole("cinematic_spring_coeff 0.7")

			CompleteQuest("r1m2_Glagiators_Quest1")

			TActivate("KOLIZEYFIGHTDIE2")

			SetCameraBehindPlayerVehicle()

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Одержали победу на арене Колизея -->
	<trigger Name="ROLIK_KOLIZEYFIGHTDIE" active="0">
		<event timeout="0.01" eventid="GE_TIME_PERIOD" />
		<script>

			SaveAllToleranceStatus(RS_NEUTRAL)

			local Plf = GetPlayerVehicle()
			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()

			if QuestStatus("CombatInKollizey_Quest2")==Q_TAKEN then

				CompleteQuestIfTaken( "CombatInKollizey_Quest2" )

			elseif QuestStatus("r1m2_Glagiators_Quest2")==Q_TAKEN then

				CompleteQuestIfTaken( "r1m2_Glagiators_Quest2" )

			end

			PlfCoor.y = PlfCoor.y + 5
			PlfCoor.z = PlfCoor.z + 50
			rad = 35

			Plf:SetCustomControlEnabled( true )
			Plf:SetCustomLinearVelocity( 0 )
			Plf:SetThrottle( 0 )
			Plf:SetCustomControlEnabled( false )

			FlyAround(0.5, 0.01, rad, 6, PlfCoor, PlfID, 1, 1 )
			StartCinematic()

			AddCinematicMessage( 22224, 1 )

			TActivate( "KOLIZEYFIGHTDIE_ec" )

			local r = GetEntityByName ("ZABOR")
			if r then r:Remove() end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="KOLIZEYFIGHTDIE_ec" active="0">
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			SetCameraBehindPlayerVehicle()

			rad = nil

			trigger:Deactivate() 
		</script>
	</trigger>

</triggers>