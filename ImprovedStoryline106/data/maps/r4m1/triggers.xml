<?xml version="1.0" encoding="windows-1251" standalone="yes" ?>
<triggers>
<!-- Инициализация карты -->
	<trigger	Name="GlobalVar"	active="1">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			SetVar("MaxLap",2)
			SetVar("BuhPoint",0)
			SetVar("CountCar",8)
			SetVar("PlayerCarNameRace",0)
			SetVar("Gonka",0)
			SetVar("Strahovka",0)
			SetVar("KnownMap",0)
			SetVar("Tankisty", 0)
			if GAME_VERSION then SetVar("ISLVersion", GAME_VERSION) end

		    trigger:Deactivate()
		</script>
	</trigger>

	<!-- Раскладка случайного оружия по ящикам -->
	<trigger	Name="trPlaceSecret"	active="1">
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
			local i=1
			local gunlist = {"fagot01","maxim01","vulcan01","kpvt01","rapier01","flag01","rainmetal01","elephant01","odin01","omega01","bumblebee01","hammer01","hunterSideGun","mrakSideGun","big_swingfire01","cyclops01","octopus01","hailSideGun","hurricane01","rocketLauncher","zeusSideGun","marsSideGun"}
			local len = getn(gunlist)

			while getObj("SecretPlace"..i.."_loc")~=nil do
				CreateBoxWithAffixGun(CVector(getPos("SecretPlace"..i.."_loc")), gunlist[exrandom(len)], random(3))
				i = i + 1
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Первый сюжетный приезд игрока -->
	<trigger	Name="trStartMap"	active="1">
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
			if QuestStatus("r4m1_FindNative")==Q_CANBEGIVEN then
			   TakeQuest("r4m1_FindNative")

			   TActivate("cinPriezdFirst")

			   trigger:Deactivate()
			end
		</script>
	</trigger>

	<!-- Удаление подлодки, если она есть -->
	<trigger	Name="trSubDelete"	active="1">
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
			local submar = getObj("SubmR4M1")
			if submar then
				submar:Remove()
			end
			
			TActivate("trMoveR2ToR2M2")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Нейтральное отношение при подъезде к городу -->
	<trigger	Name="trSetTolNeutral"	active="1">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="NearKef_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="NearGadad_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="NearAliham_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="NearZuhel_loc" />
		<script>
		    SetTolerance(1100, 1023,RS_NEUTRAL)
		    SetTolerance(1100, 1025,RS_NEUTRAL)

		    SetTolerance(1042, 1023,RS_NEUTRAL)
		    SetTolerance(1042, 1025,RS_NEUTRAL)

		</script>
	</trigger>

	<!-- Вражеское отношение при отъезде от города -->
	<trigger	Name="trSetTolEnemy"	active="1">
		<event	eventid="GE_OBJECT_LEAVES_LOCATION"	ObjName="NearKef_loc" />
		<event	eventid="GE_OBJECT_LEAVES_LOCATION"	ObjName="NearGadad_loc" />
		<event	eventid="GE_OBJECT_LEAVES_LOCATION"	ObjName="NearAliham_loc" />
		<event	eventid="GE_OBJECT_LEAVES_LOCATION"	ObjName="NearZuhel_loc" />
		<script>
		    SetTolerance(1100, 1023,RS_ENEMY)
		    SetTolerance(1100, 1025,RS_ENEMY)

		    SetTolerance(1100, 1023,RS_ENEMY)
		    SetTolerance(1100, 1025,RS_ENEMY)

		</script>
	</trigger>

	<!--  -->
	<trigger	Name="trBabah"	active="1">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="Babah_loc" />
		<script>

			local bahID = CreateNewObject{
				prototypeName = "superBlastWave",
				objName = "MyWave",
				belong = 1001
			}

			local bah = GetEntityByID(bahID)

			if bah then
				bah:SetPosition(CVector(4535.243, 248.904, 6498.239))
			end
			
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Создание Молоковоза с прицепом -->
	<trigger	Name="trCreateMolokovoz"	active="0">
		<event	timeout="0.01"			eventid="GE_TIME_PERIOD" />
		<script>
			local veh=CreateVehicleEx("Molokovoz01","PlayerMolokovoz",CVector(getPos("MolokovozSpawn_loc")))
			if veh then
				veh:SetRotation(Quaternion(-0.007, -0.769, -0.008, 0.639))
				veh:SetRandomSkin()
				veh:AttachTrailer("MolokovozTrailer")

			   local nametr = veh:GetName().."_Trailer"
			   local trailer = getObj(nametr)

			   if trailer then
					trailer:SetSkin(veh:GetSkin())
				   local tr = getObj("trTrailerDie")
				   if tr then
				      tr:AddEvent("GE_OBJECT_DIE",nametr)
			    	  TActivate("trTrailerDie")
	   			   end
			   end
			end
			
			TActivate("trGoToChangeVeh")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Старт катсцены со сменой машины игрока на Молоковоз с прицепом -->
	<trigger Name="trGoToChangeVeh" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="VehChange_loc" />
		<script>
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:SetThrottle( 0 )
			end

			TActivate("cinMolokovozFirst")

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Доехали на Молоковозе до нефтевышки -->
	<trigger	Name="trOiler"	active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="Oil_loc" />
		<script>
			local amount=trigger:GetTriggeredObjectAmount()
			for i=0,amount - 1 do
				local veh = getObj(trigger:GetTriggeredObjectID(i))
				if veh:GetName()=="PlayerMolokovoz" then
					if QuestStatus("r4m1_KNO_GotoOiler")==Q_TAKEN then
						TActivate("cinOilFirst")
						CompleteQuest("r4m1_KNO_GotoOiler")
					end
					do break end
				end
			end
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Вернулись с нефтью в Кеф -->
	<trigger Name="trGoToChangeVeh2" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="VehChange_loc" />
		<script>
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:SetThrottle( 0 )
			end

			TActivate("cinPlCarReturnFirst")

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Если прицеп Молоковоза уничтожается -->
	<trigger	Name="trTrailerDie"	active="0">
		<script>
			SpawnMessageBox( "8902" )

			ShowDeathMenu()

			CheckPlayerVehicle()
			
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Догнали инженера-нефтегонщика -->
	<trigger	Name="trRunDownEngineer"	active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="NearEngineer_loc" />
		<script>
			TActivate("cinEngineerFirst")

        	trigger:Deactivate()
		</script>
	</trigger>

	<!-- Инженер-нефтегонщик уезжает в убежище -->
	<trigger	Name="trEngineerGoAway"	active="0">
		<event	timeout="1"			eventid="GE_TIME_PERIOD" />
		<script>
			local team=getObj("EngCar")
			if team then 
			   team:SetExternalPathByName("engineerGoAwayPath")
			   team:setImmortalMode(1)
			   TActivate("trEngineerFree")
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trEngineerFree"	active="0">
		<event eventid="GE_TARGET_REACHED" ObjName="EngCar"/>
		<script>
		    local team=getObj("EngCar")
			if team then
				team:Remove()
			end
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Инженер-нефтегонщик убивается об бочки -->
	<trigger	Name="trEngineerGoToBarrel"	active="0">
		<event	timeout="0.1"			eventid="GE_TIME_PERIOD" />
		<script>
			TActivate("trEngineerMustDie")

			TActivate("cinEngineerMustDieFirst")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trEngineerMustDie"	active="0">
		<event eventid="GE_TARGET_REACHED" ObjName="EngCar"/>
		<script>
		    local team=getObj("EngCar")
			if team then
				team:AddModifier("hp","= -1000")
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Старт ролика с танкистом в Кефе после выезда из города -->
	<trigger	Name="trTankistyRolikStart"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>

			TActivate("trTankistyRolikBegin")

			trigger:Deactivate()
		</script>
	</trigger>


	<trigger Name="SPYTANKI" active="0">
		<event timeout="1" eventid="GE_TIME_PERIOD" />
		<script>
			local run = GetEntityByName("Tankisty")
			local pl = GetPlayerVehicle()
			local len

			if run and run:IsAlive()  then
				len = Dist(pl, run)
				if (len > 305) or (15 > len) then

					TActivate("SPYTANKIFAIL")

					trigger:Deactivate()
				end
			else
				
				TActivate("SPYTANKIFAIL")

				trigger:Deactivate()
			end
		</script>
	</trigger>

	<trigger Name="SPYTANKIEND" active="0">
		<event eventid="GE_TARGET_REACHED" ObjName="Tankisty"/>
		<script>
			TDeactivate("SPYTANKI")
			
			CompleteQuestIfTaken("r4m1_Tankisty")
			
			StartConversation("Tankist")

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Битва с танкистами -->
	<trigger Name="TANKIBATTLE" active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>
			TeamCreate("Tankisty2",1031,CVector(4224.924, 247.045, 6177.333),{"Tank01", "Tank01", "Tank01"})

			SetTolerance(1100, 1031, RS_ENEMY)

			local r1 = GetEntityByName ("Tankisty")
			if r1 then r1:Remove() end
			
			TActivate("TANKIBATTLECIN")

			TakeQuest("KillTankistov")

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Создание огня на кладбище кораблей -->
	<trigger Name="BUHARAFIRE" active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>
		
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE01", -1, -1, CVector(1814.698, 228.209, 6631.276), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE02", -1, -1, CVector(1270, 209, 6189), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE03", -1, -1, CVector(1676, 228, 6302), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE04", -1, -1, CVector(1708, 226, 6071), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE05", -1, -1, CVector(2009, 227, 6329), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE06", -1, -1, CVector(2066, 226, 6425), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Создание Альфарана, нападающего на Бухарцев на кладбище кораблей -->
	<trigger	Name="trBuhArmy"	active="0">
		<event	timeout="1"			eventid="GE_TIME_PERIOD" />
		<script>
			local attm = CreateTeam("BuharsAttackers",1025,CVector(getPos("BuharAttack_loc")),{"Fighter01","Fighter01","Ural01","Cruiser01"},CVector(getPos("BAEndPoint_loc")), nil, Quaternion(-0.037, 0.992, 0.016, 0.117))
			if attm then
				AddVehicleGunsWithRandomAffix( attm:GetVehicle(0), "kpvt01", 3, 10)
				attm:GetVehicle(1):AddItemsToRepository("add_stability_and_speed", 1)
				AddVehicleGunsWithRandomAffix( attm:GetVehicle(2), "hunterSideGun",  3, 8+random(2))
				AddVehicleGunsWithRandomAffix( attm:GetVehicle(3), "vulcan01", 3, 10)
			end

			local tank = GetVar("Tankisty").AsInt
			if tank == 0 then
				SetTolerance(1100,1025, RS_ENEMY)

				CompleteQuest("r4m1_FPR_MeetWithOldMan")

				TActivate("trBuharsAttackersDie")
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Создание огня в убежище нефтегонщика -->
	<trigger Name="PEREGFIRE" active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>
		
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE07", -1, -1, CVector(3663, 249, 5519), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE08", -1, -1, CVector(3605, 249, 5480), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Игрок отбил нападение Альфарана -->
	<trigger	Name="trBuharsAttackersDie"	active="0">
		<event	eventid="GE_OBJECT_DIE"		ObjName="BuharsAttackers" />
		<script>
			CompleteQuest("r4m1_RBC_DefendCountry")

			StartConversation("r4m1_BuharsLeader")

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Создание машин Бухарцев. Их следование до порта -->
	<trigger Name="trCreateBuharers" active="0">
		<event timeout="0.1" eventid="GE_TIME_PERIOD" />
		<script>

			local bhteam = CreateTeam("Buharers",1026, CVector(getPos("BuhSpawn_loc")),{"DemoUral1","DemoMolokovoz1"})

            if bhteam then
            	for i=0,1 do
					local FVehicle = bhteam:GetVehicle(i)
					if FVehicle then
						FVehicle:SetExternalPathByName("BuharsEvac_Path"..(i+1).."_1")
						FVehicle:SetCruisingSpeed(100)
					end
				end
			end

			SetVar("BuhCurPoint",1)
			SetVar("BuhPoint1",0)
			SetVar("BuhPoint2",0)
			SetVar("BuhPoint3",0)
			SetVar("BuhPoint4",0)
			SetVar("BuhPoint5",0)

			TActivate("trBuharsDie")
			TActivate("trBuharsEnterToPort")
			TActivate("trBuhReachPoint")
			TakeQuest("r4m1_RBC_Evacuate")

			local a = GetEntityByName("StartGonka_loc")
			if a then a:SetProperty("Active",0) end

			trigger:Deactivate() 
		</script>
	</trigger>

	<trigger	Name="trBuhReachPoint"	active="0">
		<event eventid="GE_TARGET_REACHED" ObjName="Buharers_vehicle_0"/>
		<event eventid="GE_TARGET_REACHED" ObjName="Buharers_vehicle_1"/>
		<script>

			local point = GetVar("BuhCurPoint").AsInt
			local stat = GetVar("BuhPoint"..point).AsInt+1

			SetVar("BuhPoint"..point,stat)
			if stat>=2 then
				point = point+1
				SetVar("BuhCurPoint",point)
	          	for i=0,1 do
					local FVehicle = getObj("Buharers_vehicle_"..i)
					if FVehicle then
						FVehicle:SetExternalPathByName("BuharsEvac_Path"..(i+1).."_"..point)
					end
				end
                if point>=5 then
                	TDeactivate("trActiveBuhReach")
					TDeactivate("trBuharsDie")

					TActivate("cinBuhPortFirst")

					CompleteQuest("r4m1_RBC_Evacuate")

					AddHistory( "r4_AfterAtackToBuhars" )
					AddFadingMsgId( "fm_history_got" )
				else
					TActivate("trActiveBuhReach")
                end
                trigger:Deactivate() 
			end
		</script>
	</trigger>

	<trigger Name="trActiveBuhReach" active="0">
		<event timeout="2" eventid="GE_TIME_PERIOD" />
		<script>
			TActivate("trBuhReachPoint")

			trigger:Deactivate() 
		</script>
	</trigger>

	<!-- Бухарцы убиты во время сопровождения -->
	<trigger	Name="trBuharsDie"	active="0">
		<event	eventid="GE_OBJECT_DIE"		ObjName="Buharers_vehicle_0" />
		<event	eventid="GE_OBJECT_DIE"		ObjName="Buharers_vehicle_1" />
		<script>
			FailQuest("r4m1_RBC_Evacuate")
			FailQuest("r4m1_RescueBuharsCivilian")
			FailQuestIfTaken("r3m2_FindInfoAboutFather")

			TakeQuest("r4m2_LisaDieBen")

			TDeactivate("trBuharsEnterToPort")
			TDeactivate("trBuhReachPoint")

			TActivate("LisaBuharDie")

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Игрок отказался участвовать в гонках -->
	<trigger	Name="trPlaceCar"	active="0">
		<event	timeout="0.001"			eventid="GE_TIME_PERIOD" />
		<script>
			GetPlayerVehicle():SetCustomLinearVelocity( 0 )
			GetPlayerVehicle():SetThrottle( 0 )

			setPos(GetPlayerVehicle(),CVector(4422.050, 280.216, 2025.034))
			setRot(GetPlayerVehicle(),Quaternion(-0.001, -0.703, -0.000, -0.711))

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Игрок согласился участвовать в гонках -->
	<trigger	Name="trA"	active="0">
		<event	timeout="1"		eventid="GE_TIME_PERIOD" />
		<script>

			local Plf = GetPlayerVehicle()
			if Plf then 
				Plf:SetNameFromScript( "PlayerCarGonki" )
				Plf:SetGamePositionOnGround(CVector(4422.050, 280.216, 2025.034))
				Plf:SetRotation(Quaternion(-0.001, -0.703, -0.000, -0.711))

				SaveWeaponGroups()
			end

			CapturePlayerVehicle(0, "PlayerRace")
			AddPlayerMoney(-10000)

			local maxcar = GetVar("CountCar").AsInt
			for i=1,maxcar-1 do
				local veh = CreateVehicleEx("Formula01","FormulaCar"..i,  CVector(getPos("RaceStart"..i.."_loc"))+CVector(0,1,0), 1100)
				if veh then 
				   veh:SetRotation(Quaternion(0.000, -0.999, 0.000, 0.050))
				   local sk=random(8)-1

				   while sk==2 do
				   	  sk=random(8)-1
				   end

				   veh:SetRandomSkin()
				   veh:SetForcedMaxTorque(1500)
				   veh:SetMaxSpeed(2000)
				   veh:SetCruisingSpeed(1500)
				end
			end

			local plcar=CreateVehicleEx("Formula01","PlayerFormula",  CVector(getPos("RaceStart8_loc"))+CVector(0,1,0), 1100)
			local pl=g_Player
			if pl and plcar then 
			   plcar:SetRotation(Quaternion(0.000, -0.999, 0.000, 0.050))
			   plcar:SetSkin(2)	
			   plcar:setImmortalMode(1)
			   pl:AddChild(plcar)
			end

			SetVar("nummsg",5)
			SetVar("PlayerPlace",8)
			SetVar("NextPoint",2)

			for j=0,7 do
				SetVar("LapCount"..j,0)
			end

			SetVar("CarCurSide1","2")
			SetVar("CarCurSide2","1")
			SetVar("CarCurSide3","3")
			SetVar("CarCurSide4","2")
			SetVar("CarCurSide5","3")
			SetVar("CarCurSide6","1")
			SetVar("CarCurSide7","2")
			
			local maxlap = GetVar("MaxLap").AsInt
			for j=1,8 do
				for k=0,maxlap-1 do
					SetVar("PointCarCount"..k.."_"..j,0)
				end
			end

			TActivate("trRaceTimer")
			TActivate("trFalseStar")
			TActivate("trRaceCarDie")
			TActivate("trCheckPoints")
			TActivate("trPlayerFormulaDie")

			AllowSave( false )

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Обратный отсчёт до старта -->
	<trigger	Name="trRaceTimer"	active="0">
		<event	timeout="1"		eventid="GE_TIME_PERIOD" />
		<script>
			local nummsg=GetVar("nummsg").AsInt

			AddFadingMsgByStrIdFormatted( "fm_race_start_1", nummsg)
			AddImportantFadingMsgByStrIdFormatted( "fm_race_start_1", nummsg)

			SetVar("nummsg",nummsg-1)

			if nummsg==1 then 
				TActivate("trStartRace")		   
				trigger:Deactivate()
			end

		</script>
	</trigger>

	<!-- Старт гонки -->
	<trigger	Name="trStartRace"	active="0">
		<event	timeout="1"		eventid="GE_TIME_PERIOD" />
		<script>
		
			AddFadingMsgId( "fm_race_start_0" )
			AddImportantFadingMsgByStrIdFormatted( "fm_race_start_0" )

			TDeactivate("trFalseStar")

			TActivate("trFormulaMoving")

			local maxcar = GetVar("CountCar").AsInt
			for i=1,maxcar-1 do
			    local veh1=getObj("FormulaCar"..i)
			    if veh1 then
					local let = {"L","M","R"}			    	
					local nump = GetVar("CarCurSide"..i).AsInt
				    veh1:SetExternalPathByName("Gonka_StartPath_"..let[nump])
			    end
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Фальстарт -->
	<trigger	Name="trFalseStar" active="0">
		<event	eventid="GE_OBJECT_LEAVES_LOCATION"	ObjName="RaceStart8_loc" />
		<script>
			AddFadingMsgId( "fm_race_start_false" )
			AddImportantFadingMsgByStrIdFormatted( "fm_race_start_false" )

			TDeactivate("trRaceTimer")
			TDeactivate("trStartRace")

			TActivate("trFalseStartRace")

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Движение соперников -->
	<trigger	Name="trFormulaMoving"	active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath01_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath02_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath03_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath04_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath05_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath06_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath07_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath08_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath09_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath10_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath11_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath12_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath13_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath14_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath15_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath16_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath17_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath18_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath19_loc" />
		<script>
			local amount = trigger:GetTriggeredObjectAmount()
			for i=0, amount-1 do
			   local guestID = trigger:GetTriggeredObjectID(i)
			   local guest = getObj(guestID)
			   if guest then
			   	  local name = guest:GetName()

				  if strsub(name,1,10)=="FormulaCar" then
						local locname = trigger:GetCallObjName()
						local locnum = tonumber(strsub(locname,12,13))

						local carnum=tonumber(strsub(name,11,11))
						local canmovearr = {{1,2,2},{1,2,3},{2,2,3}}

						local let = {"L","M","R"}			    	
						local nums = GetVar("CarCurSide"..carnum).AsInt

						local newnums = canmovearr[nums][random(3)]
						SetVar("CarCurSide"..carnum,newnums)

						local nextpath = "Gonka_"..locnum.."-"..(locnum+1).."_"..let[newnums]

						guest:SetExternalPathByName(nextpath)
					end
			   end
			end
		</script>
	</trigger>

	<!-- Отслеживание проезда по чекпоинтам -->
	<trigger	Name="trCheckPoints" active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="CheckPoint1_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="CheckPoint2_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="CheckPoint3_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="CheckPoint4_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="CheckPoint5_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="CheckPoint6_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="CheckPoint7_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="CheckPoint8_loc" />
		<script>

			local amount = trigger:GetTriggeredObjectAmount()
			for i=0, amount-1 do
			   local guestID = trigger:GetTriggeredObjectID(i)
			   local guest = getObj(guestID)
			   if guest then
			   	  local name = guest:GetName()

				  local locname = trigger:GetCallObjName()
				  local carnum=tonumber(strsub(name,11,11))

                  if name=="PlayerFormula" then
                     carnum = 0
                  end
				  local maxcar = GetVar("CountCar").AsInt
				  local lap = GetVar("LapCount"..carnum).AsInt
				  local locnum = tonumber(strsub(locname,11,11))
				  local CurCarCounter=GetVar("PointCarCount"..lap.."_"..locnum).AsInt+1

					if name=="PlayerFormula" then
						local pointnum = GetVar("NextPoint").AsInt
						if locnum==pointnum then

							SetVar("PointCarCount"..lap.."_"..locnum,CurCarCounter)
							SetVar("PlayerPlace",CurCarCounter)


							if 3>=CurCarCounter then
								AddFadingMsgId( "fm_race_finish_"..CurCarCounter)
								AddImportantFadingMsgId( "fm_race_finish_"..CurCarCounter)
							else
								AddFadingMsgByStrIdFormatted( "fm_race_finish_less", CurCarCounter, maxcar)
								AddImportantFadingMsgByStrIdFormatted( "fm_race_finish_less", CurCarCounter, maxcar)
							end

							SetVar("NextPoint",pointnum+1)

							if pointnum==8 then
								SetVar("NextPoint",1)
							elseif pointnum==1 then
								if lap == 0 then

									AddFadingMsgId( "fm_race_finish" )
									AddImportantFadingMsgByStrIdFormatted( "fm_race_finish" )

									guest:SetCustomControlEnabled(1)

									guest:SetExternalPathByName("Gonka_Finish_8")

									TActivate("trFinishRace")
							    end

							    SetVar("LapCount"..carnum,lap+1)
							end
						else
							AddFadingMsgId( "fm_race_chekpoint_notright" )
							AddImportantFadingMsgByStrIdFormatted( "fm_race_chekpoint_notright" )
						end
					elseif strsub(name,1,10)=="FormulaCar" then

						if locnum==1 then
							SetVar("LapCount"..carnum,lap+1)
						end
						if lap>=1 and locnum==1 then
							guest:SetExternalPathByName("Gonka_Finish_"..carnum)
						end
						SetVar("PointCarCount"..lap.."_"..locnum,CurCarCounter)
					end
			   end
			end
		</script>
	</trigger>

	<!-- Если кто-то из соперников разбился -->
	<trigger	Name="trRaceCarDie"	active="0">
		<event	eventid="GE_OBJECT_DIE"		ObjName="FormulaCar1" />
		<event	eventid="GE_OBJECT_DIE"		ObjName="FormulaCar2" />
		<event	eventid="GE_OBJECT_DIE"		ObjName="FormulaCar3" />
		<event	eventid="GE_OBJECT_DIE"		ObjName="FormulaCar4" />
		<event	eventid="GE_OBJECT_DIE"		ObjName="FormulaCar5" />
		<event	eventid="GE_OBJECT_DIE"		ObjName="FormulaCar6" />
		<event	eventid="GE_OBJECT_DIE"		ObjName="FormulaCar7" />
		<script>
			local CarCount=GetVar("CountCar").AsInt

			AddFadingMsgId( "fm_race_somedie" )

			SetVar("CountCar",CarCount-1)

			if CarCount==1 then
			   trigger:Deactivate()
			end

		</script>
	</trigger>

	<!-- Переход в Зармек -->
	<trigger Name="trExitToR4M2" active="1">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="ExitFromMapToR4M2_loc" />
		<script>
			local Plf = GetPlayerVehicle()
			Plf:SetThrottle( 0 )
			Plf:SetCustomLinearVelocity( 0 )

			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.x = PlfCoor.x + 15
			PlfCoor.y = PlfCoor.y + 5
			PlfCoor.z = PlfCoor.z - 5

			if IsQuestTaken("r4m1_FindMilitaryBase") then
				ValidateGameVersion()

				local b = SpawnMessageBox( "8801" )
				if b == 1 then

					PassToMap("r4m2", "FromR4M1", -1 )

					local hs = GetEntityByName ("FIRE01")
					if hs then hs:Remove() end
					local hs = GetEntityByName ("FIRE02")
					if hs then hs:Remove() end
					local hs = GetEntityByName ("FIRE03")
					if hs then hs:Remove() end
					local hs = GetEntityByName ("FIRE04")
					if hs then hs:Remove() end
					local hs = GetEntityByName ("FIRE05")	
					if hs then hs:Remove() end
					local hs = GetEntityByName ("FIRE06")
					if hs then hs:Remove() end
					local hs = GetEntityByName ("FIRE07")
					if hs then hs:Remove() end
					local hs = GetEntityByName ("FIRE08")
					if hs then hs:Remove() end

				else
					SaveAllToleranceStatus(RS_NEUTRAL)

					FlyAround(0.1, 0, 25, 3, PlfCoor, PlfID, 1, 1 )
					StartCinematic()

					TActivate ("trExitToR4M2_Fade")
					TActivate ("trExitToR4M2_End")
				end
			else
				SaveAllToleranceStatus(RS_NEUTRAL)

				FlyAround(0.5, 0, 25, 7, PlfCoor, PlfID, 1, 1 )
				StartCinematic()

				TActivate ("trExitToR4M2_Fade")
				TActivate ("trExitToR4M2_End")

				AddCinematicMessage( 8802, 0.5 )
			end
 		</script>
	</trigger>
	<trigger Name="trExitToR4M2_Fade" active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			
			local Plf = GetPlayerVehicle()
			Plf:SetThrottle( 0 )
			Plf:SetCustomLinearVelocity( 0 )

			trigger:Deactivate()    
		</script>
	</trigger>
	<trigger Name="trExitToR4M2_End" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			local Plf = GetPlayerVehicle()
			if Plf then
				Plf:SetGamePositionOnGround( CVector(7461.118, 274.664, 3696.625))
				Plf:SetRotation(Quaternion(0.016, -0.761, 0.030, 0.648))
			end

			TDeactivate( "trExitToR4M2_Fade" )

			SetCameraBehindPlayerVehicle()

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Переход в Край -->
	<trigger Name="trExitToR1M1" active="1">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="ExitFromMapToR1M1_loc" />
		<script>
			local Plf = GetPlayerVehicle()
			Plf:SetThrottle( 0 )
			Plf:SetCustomLinearVelocity( 0 )

			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.x = PlfCoor.x - 15
			PlfCoor.y = PlfCoor.y + 5
			PlfCoor.z = PlfCoor.z + 15

			if QuestStatus("r4m1_RescueBuharsCivilian")~=Q_TAKEN and QuestStatus("r4m1_KNO_GotoOiler")~=Q_TAKEN and QuestStatus("r4m1_KNO_BringOil")~=Q_TAKEN then
				ValidateGameVersion()

				local b = SpawnMessageBox( "8801" )

				if b == 1 then
					local engin = getObj("EngCar")
					if engin then engin:Remove() end

					TDeactivate("trEngineerFree")

					PassToMap("r1m1", "FromR4M1", -1)
				else
					SaveAllToleranceStatus(RS_NEUTRAL)

					FlyAround(0.1, 0, 25, 3, PlfCoor, PlfID, 1, 1 )
					StartCinematic()

					TActivate ("trExitToR1M1_Fade")
					TActivate ("trExitToR1M1_End")
				end
			else
				SaveAllToleranceStatus(RS_NEUTRAL)

				FlyAround(0.1, 0, 25, 3, PlfCoor, PlfID, 1, 1 )
				StartCinematic()

				TActivate ("trExitToR1M1_Fade")
				TActivate ("trExitToR1M1_End")
			end
 		</script>
	</trigger>
	<trigger Name="trExitToR1M1_Fade" active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			
			local Plf = GetPlayerVehicle()
			Plf:SetThrottle( 0 )
			Plf:SetCustomLinearVelocity( 0 )

			trigger:Deactivate()    
		</script>
	</trigger>
	<trigger Name="trExitToR1M1_End" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			local Plf = GetPlayerVehicle()
			if Plf then
				Plf:SetGamePositionOnGround( CVector(3118.612, 274.787, 7487.544))
				Plf:SetRotation(Quaternion(0.039, 0.922, -0.001, 0.384))
			end

			TDeactivate( "trExitToR1M1_Fade" )

			SetCameraBehindPlayerVehicle()

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Переход в Аржан -->
	<trigger Name="trMoveR2ToR2M2" active="1">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="EnterToSubmarine_loc" />
		<script>
			if IsQuestItemPresent( "quest_key_for_submarine" ) or  IsQuestItemPresent( "quest_key_for_submarine1" ) then
				if QuestStatus("r4m2_TalkWithScientific")==Q_COMPLETED then
					trigger:Deactivate()
				
					local Plf = GetPlayerVehicle()
					local PlfID = GetPlayerVehicleId()
					local PlfCoor = Plf:GetPosition()
					PlfCoor.x = PlfCoor.x + 40
					PlfCoor.y = PlfCoor.y + 10
					PlfCoor.z = PlfCoor.z - 40

					Plf:SetCustomControlEnabled( true )
					Plf:SetCustomLinearVelocity( 0 )
					Plf:SetThrottle( 0 )
					Plf:SetCustomControlEnabled( false )

					ValidateGameVersion()
 
					local b = SpawnMessageBox( "8801" )
					if b == 1 then

						TActivate ("cinMovePlToR2M2_begin")

					else
						SaveAllToleranceStatus(RS_NEUTRAL)

						TActivate ("StartR2M2No")

						FlyAround( 0.1, 0, -40, 3, PlfCoor, PlfID, 1, 1 )
						StartCinematic()
					end
				end
			else
				AddImportantFadingMsgId( "fm_key_lost" )
			end

			trigger:Activate()
 		</script>
	</trigger>

	<trigger	Name="StartR2M2No"	active="0">
		<event	eventid="GE_SKIP_CINEMATIC"	ObjName="Player1" />
		<event	eventid="GE_END_CINEMATIC"	ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:SetThrottle( 0 )
				vehPlayer:SetGamePositionOnGround( CVector(1361.777, 220.570, 3114.695))
		   		vehPlayer:SetRotation(Quaternion(0.000, -0.826, 0.000, -0.564))
		   	end

			SetCameraBehindPlayerVehicle()

			trigger:Deactivate() 
		</script>
	</trigger>
</triggers>
