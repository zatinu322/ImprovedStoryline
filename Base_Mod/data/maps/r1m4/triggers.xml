<?xml version="1.0" encoding="windows-1251" standalone="yes" ?>
<triggers><!-- **************** старт карты, проверка условий квестов-->

	<trigger	Name="GlobalVar"	active="1">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			SetVar("Boloto",0)
			SetVar("SubMarPh",0)
			SetVar("Ryba",0)
			SetVar("KnownMap",0)
			SetVar("MainCarDead",0)
			
			CreateNewDummyObject( "big_crag_5", "kamexp1", -1, -1, CVector(2059.066, 257.000, 3559.212), Quaternion(0.3953, -0.0829, -0.2476, 0.8807), 0)
			CreateNewDummyObject( "big_crag_12", "kamexp2", -1, -1, CVector(2052.101, 263.000, 3567.510), Quaternion(-0.3090, 0.0000, 0.0000, 0.9511), 0)
			CreateNewDummyObject( "big_stone4", "kamexp3", -1, -1, CVector(2057.401, 261.000, 3551.166), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), 0)
			CreateNewDummyObject( "big_stone2", "kamexp4", -1, -1, CVector(2070.257, 260.000, 3555.813), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), 0)
			CreateNewDummyObject( "berth", "motsGomer", -1, -1, CVector(3500.933, 207.000, 3694.143), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), 0)

			local i=1
			local gunlist = {"hornet01","specter01","pkt01","kord01","storm01","vector01","vulcan01","kpvt01","rapier01","flag01","rainmetal01","bumblebee01"}
			local len = getn(gunlist)

			while getObj("SecretPlace"..i.."_loc")~=nil do
--				println(i)
				CreateBoxWithAffixGun(CVector(getPos("SecretPlace"..i.."_loc")), gunlist[exrandom(len)], random(3))
				i = i + 1
			end

		    trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="SpecEndTrStart" active="1">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="SpecEndPlane_loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="SpecEndPlane2_loc" />
		<script>
			if QuestStatus("ToAivenToHel_Quest")==Q_TAKEN then
				TActivate("PlaneRBegin")
				CompleteQuest("ToAivenToHel_Quest")
				trigger:Deactivate()
			end
		</script>
	</trigger>

	<trigger	Name="trStartMap"	active="1">
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
			local submar = getObj("Subm")
			if submar then
				submar:Remove()
			end
			trigger:Deactivate()
	
		</script>
	</trigger>


<!-- ***************************** Пересекание болота. Проверяется, можно или нет проехать -->
	<trigger	Name="trMorassTeleportBefore"	active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="MorassRoad_loc" />
		<script>
			TActivate("RolikBegin_Boloto")
			if QuestStatus("r1m4_OvercomeMirras")==Q_TAKEN then
				CompleteQuestIfTaken("r1m4_OvercomeMirras")
			end
			TDeactivate("trMorassTeleportAfter")
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="BolotoChoice"	active="1">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="MorassRoad_loc" />
		<script>
			local b = SpawnMessageBox( "8828" )
			if b == 1 then
				TActivate("TE14Begin")
			else
				if CanQuestBeGiven("r1m4_OvercomeMirras") then
					TakeQuest("r1m4_OvercomeMirras")
				end
				TActivate("RolikBegin_BolotoOF")
			end
			trigger:Deactivate()
		</script>
	</trigger>

<!-- ***************************** Пересекание болота. Проверяется, можно или нет проехать -->
	<trigger	Name="trMorassTeleportAfter"	active="1">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="MorassRoad2_loc" />
		<script>
			TActivate("RolikBegin_PortOut")
			TDeactivate("trMorassTeleportBefore")
			trigger:Deactivate()
		</script>
	</trigger>
<!-- *********** конец синематики болота -->
	<trigger	Name="trNearMorassEnd"	active="0">
		<event	eventid="GE_SKIP_CINEMATIC"	ObjName="Player1" />
		<event	eventid="GE_END_CINEMATIC"	ObjName="Player1" />
		<script>
--			println("trNearMorassEnd")
--			local plveh=GetPlayerVehicle()
--			if plveh then
--				plveh:SetCustomControlEnabled(0)
--				plveg:SetExternalPathByName("BolotoViezdPort")
--				plveh:SetPosition(CVector(1683.768, 290, 1666.886))
--			end
--			local tr=GetEntityByName("trNearMorass")
--			if tr then
--				tr:Activate()
--			end

		</script>
	</trigger>
<!-- Создаем отряд охраны лидера -->
	<trigger	Name="trFreeExtremistLeader_Take" active="0">
		<event	timeout="1"	eventid="GE_TIME_PERIOD" />
		<script>
--			println("Leader Caravan Guards Created")
			TeamCreate("LeaderGuardTeam",1010,CVector(getPos("LeaderCaravanSpawn_loc")),{"Ural00","TSPFighter","r2m1_Ural01"}, CVector(2359.986, 254.000, 2939.419))
			TeamCreate("LeaderCar",1010,CVector(getPos("LeaderCaravanSpawn_loc")),{"Molokovoz01"}, CVector(2359.986, 254.000, 2939.419))
			local lcar = getObj("LeaderCar_vehicle_0")
			if lcar then
				lcar:AttachTrailer("MolokovozTrailer")
				local nametr = lcar:GetName().."_Trailer"
				local trailer = getObj(nametr)
				if trailer then
					trailer:SetSkin(lcar:GetSkin())
					local tr = getObj("trLeaderCarDie")
					if tr then
						tr:AddEvent("GE_OBJECT_DIE",nametr)
	   				end
	   			end
	   		end

			TActivate("trLeaderCaravanDie")
			TActivate("trLeaderCarDie")
			TActivate("trNearCaravanLeader")
			TActivate("trExtrLeader")
			trigger:Deactivate()
		</script>
	</trigger>

<!-- едем освобождать лидера, они выдвигаются в сторону Ольма-->
	<trigger	Name="trExtrLeader"	active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="LeaderCaravanStart_loc" />
		<script>
			local GuardTeam=GetEntityByName("LeaderGuardTeam")
			if GuardTeam then
				GuardTeam:SetDestination(CVector(2684.543, 249.000, 2287.926))
			end

			local LeaderTeam=GetEntityByName("LeaderCar")
			if LeaderTeam then
				LeaderTeam:SetDestination(CVector(2686.543, 249.000, 2289.926))
			end

			TActivate("trMoveCaravanLoc")
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trMoveCaravanLoc" active="0">
		<event	timeout="0.5"	eventid="GE_TIME_PERIOD" />
		<script>
--			println("trMoveCaravanLoc")
			local pos=CVector(getPos("LeaderCar_vehicle_0"))
--			println("pos = "..pos)
			local myloc=getObj("LeaderCaravanSpawn_loc")
--			println("222222222")
			if myloc and pos then
--			println("33333333")
--			   myloc:SetPosition(CVector(pos))
			   myloc:SetPosition(pos)
			end
		</script>
	</trigger>
<!-- подъехали близко к каравану-->
	<trigger	Name="trNearCaravanLeader"	active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="LeaderCaravanSpawn_loc" />
		<script>
--			SetTolerance(1100, 1010, RS_ENEMY)
			SetTolerance(1100, 1010, RS_NEUTRAL)
			TActivate("RolikBegin_NearCaravanLeader")

			trigger:Deactivate()
		</script>
	</trigger>

<!-- Охрана лидера померла -->
	<trigger Name="trLeaderCaravanDie" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="LeaderGuardTeam" />
		<event eventid="GE_OBJECT_DIE" ObjName="LeaderCar_vehicle_0" />
		<script>
			if getObj("LeaderCar_vehicle_0"):IsAlive() or GetVar("MainCarDead").AsInt==1 then
				CompleteQuest("FreeExtremistLeader_Quest3_1")
				TakeQuest("FreeExtremistLeader_Quest3_2")
			else
				if not(IsQuestTaken("FreeExtremistLeader_Quest3_2")) then
					TakeQuest("FreeExtremistLeader_Quest3_2")
					CompleteQuest("FreeExtremistLeader_Quest3_2")
				else
					CompleteQuestIfTaken("FreeExtremistLeader_Quest3_2")
				end

				SetVar("MainCarDead", 1)
			end

			trigger:IncCount()
			local count = trigger:GetCount()
		    if 2>count then
		    	return
		    end
		    SaveAllToleranceStatus(RS_NEUTRAL)
		    PlayCustomMusic("IntenseDialogue03")
--		    println("trLeaderCaravan DIEEEEEEEEEEEEEEEEEEEE")
			CompleteQuestIfTaken("FreeExtremistLeader_Quest3")
			TakeQuest("FreeExtremistLeader_Quest4")
			TDeactivate("trLeaderCarDie")
			if getObj("LeaderCar") then
				getObj("LeaderCar"):Remove()
			end
			local Plf = GetPlayerVehicle()
			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.y = PlfCoor.y + 5
			PlfCoor.z = PlfCoor.z - 20

			Plf:SetCustomControlEnabled( true )
			Plf:SetCustomLinearVelocity( 0 )
			Plf:SetThrottle( 0 )
			Plf:SetCustomControlEnabled( false )

			FlyAround(2, 0, 35, 25, PlfCoor, PlfID, 1, 1 )
			StartCinematic()

			AddCinematicMessage( 10, 1 )
			AddCinematicMessage( 11, 1 )
			AddCinematicMessage( 12, 1 )
			
			TActivate("trLeaderCaravanDie2")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trLeaderCaravanDie2" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
		
			RestoreAllToleranceStatus()
			StopPlayingCustomMusic()

			if getObj("LeaderCar_vehicle_0") then
				getObj("LeaderCar_vehicle_0"):Remove()
			end

			CompleteQuestIfTaken("FreeExtremistLeader_Quest3_1")
			CompleteQuestIfTaken("FreeExtremistLeader_Quest3_2")

			AddQuestItem("ExtLeader_P")
			AddFadingMsgByStrIdFormatted( "fm_player_add_poput", "ExtLeader_P")
			trigger:Deactivate()
		</script>
	</trigger>


<!-- Машина с лидером померла -->
	<trigger Name="trLeaderCarDie" active="0">
		<!--event eventid="GE_OBJECT_DIE" ObjName="LeaderCar" /-->
		<script>
--		    println("trLeaderCar DIEEEEEEEEEEEEEEEEEEEE")
			FailQuestIfTaken("TRS_Quest3b")
			FailQuestIfTaken("FreeExtremistLeader_Quest3")
			FailQuestIfTaken("FreeExtremistLeader_Quest3_1")
			FailQuestIfTaken("FreeExtremistLeader_Quest3_2")
			FailQuestIfTaken("FreeExtremistLeader_Quest1")
--			TakeQuest("KillExtremist_Quest1")

			SaveAllToleranceStatus(RS_NEUTRAL)

			PlayCustomMusic("IntenseDialogue03")

			local Plf = GetPlayerVehicle()
			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.y = PlfCoor.y + 5
			PlfCoor.z = PlfCoor.z + 20

			Plf:SetCustomControlEnabled( true )
			Plf:SetCustomLinearVelocity( 0 )
			Plf:SetThrottle( 0 )
			Plf:SetCustomControlEnabled( false )

			FlyAround(2, 0, 35, 9, PlfCoor, PlfID, 1, 1 )
			StartCinematic()

			AddCinematicMessage( 13, 1 )
--			AddCinematicMessage( 14, 1 )
			TDeactivate("trLeaderCaravanDie")
			TActivate("TupikEnding")
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="TupikEnding" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			StopPlayingCustomMusic()
			
			SpawnMessageBox("5965")
			
			ShowDeathMenu()

			TActivate("trBenDialogActivate")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trExtrTeamMustDie_Take" active="0">
		<event	timeout="0.01"	eventid="GE_TIME_PERIOD" />
		<script>
			TeamCreate("ExtrGuardTeam",1065,CVector(getPos("StorageVil_deploy")),{"Revolutioner1","Revolutioner2","Bug01","Bug01","Revolutioner2"})			
			SetTolerance(1100, 1065, RS_ENEMY)
			if  RS_NEUTRAL>GetTolerance(1100, 1010) then
				SetTolerance(1100, 1010, RS_NEUTRAL)
			end
			FailQuestIfTaken("TRS_Quest3b")
			FailQuestIfTaken("FreeExtremistLeader_Quest3")
			TActivate("trExtrGuardTeamDie")
			trigger:Deactivate()
		</script>
	</trigger>

<!-- Экстримисты померли -->
	<trigger	Name="trExtrGuardTeamDie"	active="0">
		<event	eventid="GE_OBJECT_DIE"		ObjName="ExtrGuardTeam" />
		<script>
--		    println("Extremist DIEEEEEEEEEEEEEEEEEEEE")
			SaveAllToleranceStatus(RS_NEUTRAL)
		    SetTolerance(1100, 1010, RS_NEUTRAL)
			CompleteQuest("KillExtremist_Quest1")
			CompleteQuest("TRS_Quest3a")

			local Plf = GetPlayerVehicle()
			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.y = PlfCoor.y + 25*0.74
			PlfCoor.z = PlfCoor.z + 25*0.74

			Plf:SetCustomControlEnabled( true )
			Plf:SetCustomLinearVelocity( 0 )
			Plf:SetThrottle( 0 )
			Plf:SetCustomControlEnabled( false )

			FlyAround(6, 0, 25, 25, PlfCoor, PlfID, 1, 1 )
			StartCinematic()

			AddCinematicMessage( 21, 1 )
			AddCinematicMessage( 22, 1 )

			TActivate("trExtrGuardTeamDie_End")

		    trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trExtrGuardTeamDie_End" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()
			trigger:Deactivate()
		</script>
	</trigger>


	<trigger Name="trConv" active="1">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="ExitFromMap" />
		<script>
			local Plf = GetPlayerVehicle()
			if Plf then
				Plf:SetThrottle( 0 )
				Plf:SetCustomLinearVelocity( 0 )
			end

			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.y = PlfCoor.y + 25*0.74
			PlfCoor.z = PlfCoor.z + 25*0.74

			local b = SpawnMessageBox( "8801" )

			if b == 1 then
				TDeactivate("RrybakRoadStart")
				PassToMap("r1m3", "FromR1M4", -1 )
			else
				SaveAllToleranceStatus(RS_NEUTRAL)

				FlyAround(1, 0, 25, 6, PlfCoor, PlfID, 1, 1)
				StartCinematic()

				Plf = GetPlayerVehicle()
				if Plf then
					Plf:SetExternalPathByName("ReturnPath")
				end

				TActivate("trConv_End")
			end
 		</script>
	</trigger>

	<trigger Name="trConv_End" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()
			
			SetCameraBehindPlayerVehicle()
			
			Plf = GetPlayerVehicle()
			if Plf then
				Plf:PlaceToEndOfPath("ReturnPath")
				Plf:SetGamePositionOnGround(CVector(2740.853, 228.788, 489.311))
				Plf:SetRotation(Quaternion(-0.025, -0.193, 0.010, 0.981))
			end
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="triggerExitToMap16" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="ToR1M6" />
		<script>
			local Plf = GetPlayerVehicle()
			Plf:SetThrottle( 0 )
			Plf:SetCustomLinearVelocity( 0 )

			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.y = PlfCoor.y + 25*0.74
			PlfCoor.z = PlfCoor.z + 25*0.74

			local b = SpawnMessageBox( "8801" )
			if b == 1 then
				if QuestStatus("GoToLiden_Quest3")==Q_TAKEN then
					SetGameTime(9,0)
				end
				PassToMap("r1m6", "FromR1M4", -1 )
			else
				local vehPlayer = GetPlayerVehicle()
				if vehPlayer then
					vehPlayer:SetGamePositionOnGround( CVector(2081.994, 259.381, 3520.942))
					vehPlayer:SetRotation(Quaternion(-0.000, 0.969, 0.000, 0.246))
				end
			end
 		</script>
	</trigger>

	<trigger	Name="trGateOpen" active="0">
		<event	timeout="1"	eventid="GE_TIME_PERIOD" />
		<script>
--			println("trGateOpen")

			for i=1,2 do
--			  print("Delete Close Gate "..i)
			  local gt1=getObj("CloseGateStr1"..i)
			  local gt2=getObj("CloseGateStr2"..i)
			  local rc=getObj("RustyCar")
--			  local gt3=getObj("CloseGateStr3"..i)
			  if gt1 then gt1:Remove() end
			  if gt2 then gt2:Remove() end
			  CreateEffectTTLed("ET_PS_BRIDGE_EXP_MAIN", CVector(880.770, 269.000, 1331.851), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), 5000)
			  if rc then rc:Remove() end
--			  if gt3 then gt3:Remove() end
			end

			if not(getObj("OpenGateStr11")) then
				CreateNewDummyObject( "metal_plate1", "OpenGateStr11", -1, -1, CVector(725.796, 271.914, 1489.619), Quaternion(-0.6660, 0.2375, 0.2375, 0.6660), 0)
			end
			if not(getObj("OpenGateStr12")) then
				CreateNewDummyObject( "metal_plate1", "OpenGateStr12", -1, -1, CVector(712.751, 272.106, 1477.371), Quaternion(-0.3455, -0.6169, -0.6169, 0.3455), 0)
			end
			if not(getObj("OpenGateStr21")) then
				CreateNewDummyObject( "metal_plate1", "OpenGateStr21", -1, -1, CVector(745.147, 272.106, 1470.527), Quaternion(-0.3455, -0.6169, -0.6169, 0.3455), 0)
			end
			if not(getObj("OpenGateStr22")) then
				CreateNewDummyObject( "metal_plate1", "OpenGateStr22", -1, -1, CVector(729.657, 272.179, 1458.787), Quaternion(-0.1304, -0.6950, -0.6950, 0.1304), 0)
			end
--			if not(getObj("OpenGateStr31")) then
--				CreateNewDummyObject( "metal_plate1", "OpenGateStr31", -1, -1, CVector(835.827, 270.946, 1174.564), Quaternion(-0.5492, 0.3990, 0.4316, 0.5941), 0)
--			end
--			if not(getObj("OpenGateStr32")) then
--				CreateNewDummyObject( "metal_plate1", "OpenGateStr32", -1, -1, CVector(854.862, 271.013, 1177.156), Quaternion(-0.4699, 0.5700, 0.5201, 0.4287), 0)
--			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trGateClose" active="0">
		<event	timeout="0.1"	eventid="GE_TIME_PERIOD" />
		<script>
--			println("trGateClose1")
			for i=1,2 do
--			  print("Delete Open Gate "..i)
			  local gt1=getObj("OpenGateStr1"..i)
			  local gt2=getObj("OpenGateStr2"..i)
--			  local gt3=getObj("OpenGateStr3"..i)
			  if gt1 then gt1:Remove() end
			  if gt2 then gt2:Remove() end
--			  if gt3 then gt3:Remove() end
			end

			if not(getObj("CloseGateStr11")) then
				CreateNewDummyObject( "metal_plate1", "CloseGateStr11", -1, -1, CVector(737.067, 273.178, 1471.946), Quaternion(-0.6402, -0.3002, -0.3002, 0.6402), 0)
			end
			if not(getObj("CloseGateStr12")) then
				CreateNewDummyObject( "metal_plate1", "CloseGateStr12", -1, -1, CVector(729.467, 273.018, 1465.505), Quaternion(0.2244, -0.6706, -0.6706, -0.2244), 0)
			end
			if not(getObj("CloseGateStr21")) then
				CreateNewDummyObject( "metal_plate1", "CloseGateStr21", -1, -1, CVector(727.205, 274.214, 1481.415), Quaternion(-0.6601, -0.2534, -0.2534, 0.6601), 0)
			end
			if not(getObj("CloseGateStr22")) then
				CreateNewDummyObject( "metal_plate1", "CloseGateStr22", -1, -1, CVector(720.314, 274.181, 1475.242), Quaternion(-0.6335, -0.3141, -0.3141, 0.6335), 0)
			end
--			if not(getObj("CloseGateStr31")) then
--				CreateNewDummyObject( "metal_plate1", "CloseGateStr31", -1, -1, CVector(850.527, 268.376, 1183.299), Quaternion(-0.6788, 0.0000, 0.0000, 0.7343), 0)
--			end                                                                                  
--			if not(getObj("CloseGateStr32")) then
--				CreateNewDummyObject( "metal_plate1", "CloseGateStr32", -1, -1, CVector(839.651, 267.612, 1183.307), Quaternion(-0.6788, 0.0000, 0.0000, 0.7343), 0)
--			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trStandartGate" active="1">
		<event	timeout="1"	eventid="GE_TIME_PERIOD" />
		<script>
--			println("trStandartGate")

			if not(getObj("OpenGateStr11")) then
				CreateNewDummyObject( "metal_plate1", "OpenGateStr11", -1, -1, CVector(725.796, 272.914, 1489.619), Quaternion(-0.6660, 0.2375, 0.2375, 0.6660), 0)
			end
			if not(getObj("OpenGateStr12")) then
				CreateNewDummyObject( "metal_plate1", "OpenGateStr12", -1, -1, CVector(712.751, 273.106, 1477.371), Quaternion(-0.3455, -0.6169, -0.6169, 0.3455), 0)
			end
			if not(getObj("OpenGateStr21")) then
				CreateNewDummyObject( "metal_plate1", "OpenGateStr21", -1, -1, CVector(745.147, 273.106, 1470.527), Quaternion(-0.3455, -0.6169, -0.6169, 0.3455), 0)
			end
			if not(getObj("OpenGateStr22")) then
				CreateNewDummyObject( "metal_plate1", "OpenGateStr22", -1, -1, CVector(729.657, 273.179, 1458.787), Quaternion(-0.1304, -0.6950, -0.6950, 0.1304), 0)
			end

			if not(getObj("RustyCar")) then
				CreateNewDummyObject( "car_cemetery04", "RustyCar", -1, -1, CVector(882.838, 268.263, 1320.603), Quaternion(0.0000, 0.5931, 0.0000, 0.8052), 0)
			end                                                                                  
--			if not(getObj("CloseGateStr32")) then
--				CreateNewDummyObject( "metal_plate1", "CloseGateStr32", -1, -1, CVector(839.651, 267.612, 1183.307), Quaternion(-0.6788, 0.0000, 0.0000, 0.7343), 0)
--			end

			trigger:Deactivate()
		</script>
	</trigger>


	<trigger Name="trMoveToBoss" active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="NearBoss_loc" />
		<script>
			TActivate("RolikBegin_Boss02")
			trigger:Deactivate() 
 		</script>
	</trigger>



	<trigger	Name="trBoss1Die"	active="1">
		<event	eventid="GE_OBJECT_DIE"		ObjName="bigboss1" />
		<script>
--		    println("Boss1 DIEEEEEEEEEEEEEEEEEEEE")
		    TActivate("trGateOpen")
			AddHistory( "r1_After_Boss1" );
			AddFadingMsgId( "fm_history_got" );
			TActivate("trMovePlToR3M1")
			StopPlayingCustomMusic()
		    trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trMovePlToR3M1" active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="EnterToSubmarine_loc" />
		<script>
			CompleteQuestIfTaken("r1m4_FindVrata_GotoToGate")

			if IsQuestItemPresent( "quest_key_for_submarine" ) or  IsQuestItemPresent( "quest_key_for_submarine1" ) then
				local vehPl = GetPlayerVehicle()
				if vehPl then
					vehPl:SetThrottle( 0 )
					vehPl:SetCustomLinearVelocity(0)
				end

				local b = SpawnMessageBox( "8801" )
				if b == 1 then
					PlayCustomMusic("Bio02")
					TActivate("cinMovePlToR3M1_begin")
				end
			else
				AddImportantFadingMsgId( "fm_key_lost" )
			end
 		</script>
	</trigger>

<!-- Охрана лидера померла -->
	<trigger Name="trFT" active="0">
		<event	timeout="1"	eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			PlayCustomMusic("IntenseDialogue03")
			local Plf = GetPlayerVehicle()
			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.y = PlfCoor.y + 5
			PlfCoor.z = PlfCoor.z + 40

			Plf:SetCustomControlEnabled( true )
			Plf:SetCustomLinearVelocity( 0 )
			Plf:SetThrottle( 0 )
			Plf:SetCustomControlEnabled( false )

			FlyAround(1, 0.01, 40, 25, PlfCoor, PlfID, 1, 1 )
			StartCinematic()

			AddCinematicMessage( 10, 0.5 )
			AddCinematicMessage( 11, 0.5 )
			AddCinematicMessage( 12, 0.5 )

			TActivate("trFTend")
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trFTend" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()
			StopPlayingCustomMusic()
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="RybakToOlm"	active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="RybakLoc" />
		<script>
			CompleteQuest("RybakToOlm_Quest")
			RemoveQuestItem("Rybak_P")
			AddFadingMsgByStrIdFormatted( "fm_player_rem_poput", "Rybak_P")
			StartConversation("FVBerko_Bar_Customer2")
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="MisterShlyapaTr"	active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="Mishlen_loc" />
		<script>
			CompleteQuest("MrShlyapa2_Quest")
			GetPlayerVehicle():SetCustomLinearVelocity( 0 )
			GetPlayerVehicle():SetThrottle(0)
			TActivate("MisterShlyapaTr2")
			Fly("mishlen", CINEMATIC_NO_AIM, 0, 15, 1, 1 )
			StartCinematic()
			PlayCustomMusic("Bio07unloop")
			AddCinematicMessage( 8804, 1 )
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="MisterShlyapaTr2" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>

			StopPlayingCustomMusic()

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="CreateHomerRybak" active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>
			CreateNewDummyObject( "dweller3", "humGomer", -1, -1, CVector(3502.483, 208.900, 3717.994), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), 0)
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="DeleteHomerRybak" active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>
			local shit1 = GetEntityByName("humGomer")
			if shit1 then shit1:Remove() end
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="WaitTillSklad" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="KillSkladGuys_loc" />
		<script>
			CompleteQuest("WaitTillEnd1")
			TActivate("KSGRolikBegin")
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RolikOdezhdaBegin" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="SlkadOdezhdaLoc" />
		<script>
			TActivate("RolikOdezhdaStart")
			
			CompleteQuestIfTaken("FreeExtremistLeader_Quest5")
			CompleteQuestIfTaken("WaitTillEnd3")
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="LisaPrivz" active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>
			local newControllerId = CreateNewObject {
				prototypeName	= "someNPCMotionController",
				objName		= "LisaCont"
			}

			local newController = GetEntityByID(newControllerId)
			local FVehicle = GetEntityByName("CARLISA1_vehicle_0")
			if FVehicle then
				newController:setVehicleUnderControl(FVehicle)
			end
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="ExplosRolikBegin" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="KamexpLoc" />
		<script>
			TActivate("ExplosRolikStart")
			CompleteQuest("GoToLiden_Quest2")
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="ExplosRolikPPath" active="0">
		<event	timeout="10"		eventid="GE_TIME_PERIOD" />
		<script>
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetExternalPathByName("ExpGetaway_path")
			end
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="ExplosRolikBoom" active="0">
		<event	timeout="3"		eventid="GE_TIME_PERIOD" />
		<script>
			CreateEffectTTLed("ET_PS_BRIDGE_EXP_MAIN", CVector(2059.066, 257.000, 3559.212), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), 600000)
			CreateEffectTTLed("ET_PS_BRIDGE_EXP_MAIN", CVector(2052.101, 263.000, 3567.510), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), 600000)
			CreateEffectTTLed("ET_PS_BRIDGE_EXP_MAIN", CVector(2057.401, 261.000, 3551.166), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), 600000)
			CreateEffectInsertedInRemove( "ET_PS_VEH_EXP1_MED1", CVector(2070.257, 260.000, 3555.813), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), true )
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="ExplosRolikDel" active="0">
		<event	timeout="3.5"		eventid="GE_TIME_PERIOD" />
		<script>
			local kam1 = GetEntityByName("kamexp1")
			if kam1 then kam1:Remove() end
			local kam2 = GetEntityByName("kamexp2")
			if kam2 then kam2:Remove() end
			local kam3 = GetEntityByName("kamexp3")
			if kam3 then kam3:Remove() end
			local kam4 = GetEntityByName("kamexp4")
			if kam4 then kam4:Remove() end
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="ArmiaRybakovDIE" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="ArmiaRybakov" />
		<script>
			local Plf = GetPlayerVehicle()
			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.y = PlfCoor.y + 25*0.74
			PlfCoor.z = PlfCoor.z + 25*0.74

			Plf:SetCustomLinearVelocity(0)
			Plf:SetThrottle(0)

			FlyAround(6, 0, 25, 10, PlfCoor, PlfID, 1, 1 )
			StartCinematic()
			
			AddCinematicMessage( 8825, 1 )
			
			SetTolerance(1100, 1084, RS_ALLY)
			SetTolerance(1100, 1085, RS_ENEMY)
			
			CompleteQuest("WaitTillEnd2")
			
			AddHistory( "r5_SkladTSP" )
			AddFadingMsgId( "fm_history_got" )
			
			TActivate("RolikOdezhdaBegin")
			
			local tsp1 = GetEntityByName("ArmiaTTSP_vehicle_0")
			if tsp1 then tsp1:Remove() end
			local tsp2 = GetEntityByName("ArmiaTTSP_vehicle_1")
			if tsp2 then tsp2:Remove() end
			local tsp3 = GetEntityByName("ArmiaTTSP_vehicle_2")
			if tsp3 then tsp3:Remove() end
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RrybakRoadStart" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="RrybakRoad_loc" />
		<script>
			TActivate("RRRolikBegin")
			SetVar("Ryba",1)
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RTMRolikStart" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="HomerRyba_loc" />
		<script>
			if QuestStatus("RevealTheMask_Quest")==Q_TAKEN then
				CompleteQuest("RevealTheMask_Quest")
				TActivate("RTMRolikBegin")
				local vehPlayer = GetPlayerVehicle()
				if vehPlayer then
					vehPlayer:SetCustomControlEnabled( true )
					vehPlayer:SetCustomLinearVelocity( 0 )
					vehPlayer:SetThrottle( 0 )
					vehPlayer:SetCustomControlEnabled( false )
				end
				trigger:Deactivate()
			end
		</script>
	</trigger>

	<trigger Name="trPrePeregovorRolikStart" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			TActivate("PeregovorRolikStart")
			trigger:Deactivate()
		</script>
	</trigger>

</triggers>
