<?xml version="1.0" encoding="windows-1251" standalone="yes" ?>
<triggers>

	<trigger	Name="cinExit41ReturnFirst"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			EnableGodMode()
--			TActivate("cinExit42ReturnFirst")
			TActivate("cinExit41Return_FadeIn")
			TActivate("cinExit41Return_End")

			Fly("ExitTo41Return", CINEMATIC_NO_AIM, nil, 4, 1,1)
			StartCinematic()

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinExit41Return_FadeIn"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			GetPlayerVehicle():SetGamePositionOnGround(CVector(588.007, 288.818, 3251.544))
			GetPlayerVehicle():SetRotation(Quaternion(0.007, -0.966, -0.005, -0.258))
			GetPlayerVehicle():SetExternalPathByName("ReturnPathR4M1")
			trigger:Deactivate()
		</script>
	</trigger>


	<trigger	Name="cinExit41Return_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			DisableGodMode()
			GetPlayerVehicle():SetExternalPathByName("ReturnPathR4M1")
			GetPlayerVehicle():PlaceToEndOfPath("ReturnPathR4M1")
			SetCameraBehindPlayerVehicle()
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinExit41OkFirst"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			EnableGodMode()
			TDeactivate("trExitToR4M1")
			TActivate("cinExit41OkFirst")
			TActivate("cinExit41Ok_FadeIn")
			TActivate("cinExit41Ok_End")

			Fly("ExitTo41Ok", CINEMATIC_NO_AIM, nil, 4, 1,1)
			StartCinematic()

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinExit41Ok_FadeIn"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			GetPlayerVehicle():SetGamePositionOnGround(CVector(576.765, 288.802, 3272.843))
			GetPlayerVehicle():SetRotation(Quaternion(0.006, 0.275, 0.005, -0.962))
			GetPlayerVehicle():SetExternalPathByName("ExitTo41Ok")
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinExit41Ok_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			DisableGodMode()
			TActivate("trExitToR4M2")
			PassToMap("r4m1", "FromR4M2", 0 , true)
			trigger:Deactivate()
		</script>
	</trigger>



	<trigger	Name="cinNearBase"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
--			TActivate("cinExit42ReturnFirst")
			SaveAllToleranceStatus(RS_NEUTRAL)
			GetPlayerVehicle():SetCustomLinearVelocity( 0 )

			TActivate("cinNearBase_End")
			
			GetPlayerVehicle():SetThrottle( 0 )
			GetPlayerVehicle():SetCustomLinearVelocity( 0 )

			Fly("NearBase", CINEMATIC_NO_AIM, nil, 6, 1,1)
			StartCinematic()

			AddCinematicMessage( 101, 0.5 )
			PlayCustomMusic("Techno02")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinNearBase_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			StopPlayingCustomMusic()
			RestoreAllToleranceStatus()
			trigger:Deactivate()
		</script>
	</trigger>




	<trigger	Name="cinHelpersFirst"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			EnableGodMode()
			
			SaveAllToleranceStatus(RS_NEUTRAL)

			GetPlayerVehicle():SetCustomLinearVelocity( 0 )
			TActivate("cinHelpers_End")
			TActivate("cinHelpers_FadeIn")
			TActivate("cinHelpers_StartFly2")
			TActivate("cinHelpers_StartFly3")
			TActivate("cinHelpers_StartFly4")
			
			CreateNewDummyObject( "brick_debris1", "CamTochka", -1, -1, CVector(2924.103, 317.313, 1547.942), Quaternion(0, 0, 0, 0), 1)
			CreateNewDummyObject( "brick_debris1", "CamTochka1", -1, -1, CVector(3088.719, 285.508, 1817.517), Quaternion(0, 0, 0, 0), 1)
			
			local CToch = GetEntityByName("CamTochka")
			local CTochID = CToch:GetId()
			
			local CToch1 = GetEntityByName("CamTochka1")
			local CToch1ID = CToch1:GetId()
			
			local vehPlayer = GetPlayerVehicle()
			local vehPID = vehPlayer:GetId()
			
			Fly("SavePlInBase1", CINEMATIC_NO_AIM, nil, 9, 1,0)
			Fly("SavePlInBase2", CINEMATIC_NO_AIM, nil, 22, 0,0)
			FlyLinked( "linkedcam", CTochID, 13, 0, 0, vehPID )
			FlyLinked( "linkedcam1", CToch1ID, 21, 0, 1, vehPID )
			StartCinematic()
			
			CompleteQuest("r4m2_FightWithCrazy")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinHelpers_FadeIn"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			PlayCustomMusic("IntenseDialogue01")
			
			CreateVehicleEx("r1m2_hunter02","Sergo",CVector(2488.479, 299.532, 1212.001), 1100)
			
			local veh = GetEntityByName("Sergo")
			if veh then
				veh:SetRotation(Quaternion(0.035, -0.797, 0.049, 0.601))
			end
			
			AddCinematicMessage( 401, 0.5 )

			local vehPlayer = GetPlayerVehicle()
				if vehPlayer then
					vehPlayer:SetCustomControlEnabled( true )
					vehPlayer:SetCustomLinearVelocity( 0 )
					vehPlayer:SetThrottle( 0 )
					vehPlayer:SetCustomControlEnabled( false )
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="cinHelpers_StartFly2" active="0">
		<event flypath="SavePlInBase2" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			AddCinematicMessage( 402, 1 )

			if QuestStatus("KillTankistov")==Q_COMPLETED then
				AddCinematicMessage( 404, 0.1 )
			else
				AddCinematicMessage( 403, 0.1 )
			end
			
			AddCinematicMessage( 405, 0.1 )
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="cinHelpers_StartFly3" active="0">
		<event flypath="linkedcam" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			PlayCustomMusic("Passage02")
			
			local veh = GetEntityByName("Sergo")
			if veh then
				veh:LimitMaxSpeed(30)
				veh:SetGamePositionOnGround( CVector(2794.308, 315.461, 1418.499))
				veh:SetRotation(Quaternion(-0.045, -0.407, -0.023, -0.912))
				veh:SetExternalPathByName("SergoPath1")
			end
			
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:LimitMaxSpeed(30)
				vehPlayer:SetGamePositionOnGround( CVector(2811.423, 316.035, 1407.262))
				vehPlayer:SetRotation(Quaternion(-0.030, -0.354, -0.006, -0.935))
				vehPlayer:SetExternalPathByName("PlayerPath1")
			end
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="cinHelpers_StartFly4" active="0">
		<event flypath="linkedcam1" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			local veh = GetEntityByName("Sergo")
			if veh then
				veh:SetGamePositionOnGround( CVector(2933.171, 235.667, 1937.929))
				veh:SetRotation(Quaternion(-0.018, -0.685, 0.027, -0.728))
				veh:SetExternalPathByName("SergoPath2")
			end
			
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetGamePositionOnGround( CVector(2946.298, 234.886, 1923.478))
				vehPlayer:SetRotation(Quaternion(-0.002, -0.665, 0.003, -0.747))
				vehPlayer:SetExternalPathByName("PlayerPath2")
			end
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinHelpers_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()
			
			StopPlayingCustomMusic()
			
			SetCameraBehindPlayerVehicle()
			
			DisableGodMode()
			
			local veh = GetEntityByName("Sergo")
			if veh then
				veh:Remove()
			end
			
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetExternalPathByName("PlayerPath2")
				vehPlayer:PlaceToEndOfPath("PlayerPath2")
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:UnlimitMaxSpeed()
			end
			
			local CToch = GetEntityByName("CamTochka")
			if CToch then CToch:Remove() end
			local CToch1 = GetEntityByName("CamTochka1")
			if CToch1 then CToch1:Remove() end
			
			AddHistory( "r4_AfterMilitaryBase" )
			AddFadingMsgId( "fm_history_got" )
			
			StartConversation("ScientiferVillage_Bar_Scientif")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinPlateFirst"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			EnableGodMode()

			SaveAllToleranceStatus(RS_NEUTRAL)
--			TActivate("cinPlateFirst")
			GetPlayerVehicle():SetCustomLinearVelocity( 0 )
			GetPlayerVehicle():LimitMaxSpeed(8)

			TActivate("cinPlate_FadeIn")
			TActivate("cinPlate_End")
			TActivate("cinPlate_FullEnd")
			TActivate("cinPlate_cam03")
			Fly("ToTarelka", CINEMATIC_NO_AIM, nil, 7, 1,1)
			StartCinematic()
			PlayCustomMusic("Death02")
			AddCinematicMessage( 501, 0.25 )
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinPlate_FadeIn"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />`
		<script>
			SetWeather(0)

			GetPlayerVehicle():SetGamePositionOnGround(CVector(getPos("TarelkaPoint_loc")))
			GetPlayerVehicle():SetRotation(Quaternion(-0.007, -0.169, -0.001, 0.986))
			GetPlayerVehicle():SetExternalPathByName("ToTarelka_Path")
--			TActivate("cinPlate_FadeIn2")
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinPlate_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<script>
--			SetGameTime(20, 0)

			GetPlayerVehicle():SetExternalPathByName("ToTarelka_Path")
			GetPlayerVehicle():PlaceToEndOfPath("ToTarelka_Path")
			GetPlayerVehicle():SetRotation(Quaternion(0.063, -0.316, -0.030, 0.946))
			
			CreateHuman( "Human_player_slow", 1100, CVector(2921.602, 226.276, 2359.396), "PlayerHuman", "ToTarelkaHuman_Path2")
			CreateHuman( "Human_player_slow", 1100, CVector(0, 0, 0), "PlayerHuman3")
			TActivate("cinPlate_HumReach2")

--			println("cinPlateFirstAAAAAAA")
			Fly("ToTarelka2", CINEMATIC_NO_AIM, nil, 17, 0,0)
			Fly("ToTarelka3", CINEMATIC_NO_AIM, nil, 11, 0,1)
			StartCinematic()

			AddCinematicMessage( 502, 0.25 )

			AddCinematicMessage( 503, 2 )

			local tr = getObj("cinPlate_FullEnd")
			if tr then
				tr:AddEvent("GE_END_CINEMATIC","Player1")
				TActivate("cinPlate_FullEnd")
			end
			RestoreAllToleranceStatus()
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="cinPlate_HumReach2" active="0">
		<event eventid="GE_TARGET_REACHED" ObjName="PlayerHuman"/>
		<script>
			local hum = getObj("PlayerHuman")
			local rot = hum:GetRotation()
			local pos = hum:GetPosition()
			if hum then
			   hum:Remove()
			end

			local hum2 = getObj("PlayerHuman3")
			if hum2 then
			   hum2:SetRotation(rot)
			   hum2:SetPosition(pos)
			end
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="cinPlate_cam03" active="0">
		<event flypath="ToTarelka3" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			AddCinematicMessage( 504, 0.5 )
			trigger:Deactivate()
		</script>
	</trigger>


	<trigger	Name="cinPlate_FullEnd"	active="0">
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			StopPlayingCustomMusic()
			SpawnMessageBox( "8901" )
			SpawnMessageBox( "8902" )
			ShowDeathMenu()

			TActivate("trBenDialogActivate")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinStopMusik_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
--			PlayCustomMusic("IntenseDialogue01")
			StopPlayingCustomMusic()
			trigger:Deactivate()
		</script>
	</trigger>


	<trigger	Name="cinLookToTarelkaFirst"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			EnableGodMode()
			SaveAllToleranceStatus(RS_NEUTRAL)
			
			PlayCustomMusic("Bio01")

			TActivate( "cinLookToTarelka_FadeIn" )
			TActivate( "cinLookToTarelka_End" )
			TActivate( "cinLookToTarelka_cam2" )

			Fly("NearTarelka1", CINEMATIC_NO_AIM, nil, 7, 1,0)
			Fly("NearTarelka2", CINEMATIC_NO_AIM, nil, 15, 0,1)
			StartCinematic()

			GetPlayerVehicle():SetCustomLinearVelocity( 0 )
			GetPlayerVehicle():SetThrottle(0)


			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinLookToTarelka_FadeIn"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			SetWeather(0)

			AddCinematicMessage( 301, 0.5 )

			trigger:Deactivate()
		</script>
	</trigger>


	<trigger	Name="cinLookToTarelka_cam2"	active="0">
		<event flypath="NearTarelka2" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			AddCinematicMessage( 302, 0.5 )
			AddCinematicMessage( 304, 0.5 )
			AddCinematicMessage( 303, 0.5 )
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinLookToTarelka_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()
			SetCameraBehindPlayerVehicle()
			StopPlayingCustomMusic()
			DisableGodMode()
			AddBelongToEncyclopaedia( 1030 )
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="Blokiratorcin"	active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)
			
			SetWeather(0)
			
			PlayCustomMusic("Bio05")
			
			local Plf = GetPlayerVehicle()
			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.y = PlfCoor.y + 25*0.74
			PlfCoor.z = PlfCoor.z + 25*0.74

			Plf:SetCustomLinearVelocity(0)
			Plf:SetThrottle(0)

			Fly("ending_cam1", CINEMATIC_NO_AIM, 0, 15, 1, 0 )
			Fly("ending_cam2", CINEMATIC_NO_AIM, 0, 11, 0, 1 )
			StartCinematic()
			
			AddCinematicMessage( 317, 8 )
			
			TActivate("BlokiratorFade")
			TActivate("BlokiratorEnd")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="BlokiratorFade"	active="0">
		<event flypath="ending_cam2" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			
			AddCinematicMessage( 319, 1 )
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="BlokiratorEnd"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			
			RestoreAllToleranceStatus()
			
			StopPlayingCustomMusic()
			
			CompleteQuest("r4m2_BlokiratorToUFO")
			
			TakeQuest("BenNormalEnd")

			RemoveQuestItem("quest_blokirator")
			AddFadingMsgByStrIdFormatted( "fm_player_rem_thing", "quest_blokirator")

			TDeactivate("trMoveToPlate")

			local b = SpawnMessageBox("8802")
			if b == 1 then
				PassToMap("r1m2", "FromR1M3", -1, true)
			end
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="SergoAivenTalk1" active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)
			
			PlayCustomMusic("Bio05")
			
			CreateNewDummyObject( "brick_debris1", "CamTochka", -1, -1, CVector(3104.465, 261.865, 2213.319), Quaternion(0, 0, 0, 0), 1)
			
			local CToch = GetEntityByName("CamTochka")
			local CTochID = CToch:GetId()
			local vehP = GetPlayerVehicle()
			local vehPID = vehP:GetId()
			
			FlyLinked( "linkedcam", CTochID, 15, 1, 0, vehPID )
			Fly("PlayerLeave_Cam", CINEMATIC_NO_AIM, 0, 34, 0, 1 )
			StartCinematic()
			
			TActivate("SergoAivenTalk2")
			TActivate("SergoAivenTalk3")
			TActivate("SergoAivenTalk4")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="SergoAivenTalk2" active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetCustomControlEnabled( true )
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:SetThrottle( 0 )
				vehPlayer:SetCustomControlEnabled( false )
				vehPlayer:SetGamePositionOnGround( CVector(3296.038, 253.745, 2044.386))
				vehPlayer:SetRotation(Quaternion(-0.039, 0.399, -0.034, -0.916))
				vehPlayer:SetExternalPathByName("PlayerLeave_Path")
			end
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="SergoAivenTalk3" active="0">
		<event flypath="PlayerLeave_Cam" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			AddCinematicMessage( 514, 1 )
			AddCinematicMessage( 515, 0.1 )
			AddCinematicMessage( 516, 0.1 )
			AddCinematicMessage( 517, 0.1 )
			AddCinematicMessage( 518, 0.1 )
			AddCinematicMessage( 519, 0.1 )
			AddCinematicMessage( 520, 0.1 )
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="SergoAivenTalk4" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()
			
			StopPlayingCustomMusic()
			
			SetCameraBehindPlayerVehicle()
			
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetExternalPathByName("PlayerLeave_Path")
				vehPlayer:PlaceToEndOfPath("PlayerLeave_Path")
				vehPlayer:SetGamePositionOnGround( CVector(2897.862, 238.021, 1924.226))
				vehPlayer:SetRotation(Quaternion(-0.002, 0.783, 0.029, -0.622))
			end
			
			local CToch = GetEntityByName("CamTochka")
			if CToch then CToch:Remove() end
			
			TDeactivate("SergoAivenTalk2")
			TDeactivate("SergoAivenTalk3")
			
			trigger:Deactivate()
		</script>
	</trigger>

</triggers>
