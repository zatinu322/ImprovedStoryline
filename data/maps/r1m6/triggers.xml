<?xml version="1.0" encoding="windows-1251" standalone="yes" ?>
<triggers>
	<!-- Инициализация карты -->
	<trigger Name="GlobalVar" active="1">
		<event timeout="0.1" eventid="GE_TIME_PERIOD" />
		<script>
			SetVar("Serafima", 0)
			SetVar("Starosta", 0)
			if GAME_VERSION then SetVar("ISLVersion", GAME_VERSION) end
			
			CreateNewDummyObject( "agro_gate", "vorota", -1, -1, CVector(458.534, 255.420, 1763.684), Quaternion(0.0000, -0.5948, 0.0000, 0.8039), 0)
			CreateNewDummyObject( "arena_barricade8", "gate1", -1, -1, CVector(2850.631, 256.083, 3023.677), Quaternion(0.0000, -0.8940, 0.0000, 0.4481), 0)
			CreateNewDummyObject( "arena_barricade8", "gate2", -1, -1, CVector(2862.078, 255.770, 3008.722), Quaternion(0.0000, -0.8978, 0.0000, 0.4403), 0)
			CreateNewDummyObject( "arena_barricade8", "gate3", -1, -1, CVector(2874.614, 255.465, 2994.410), Quaternion(0.0000, -0.9214, 0.0000, 0.3887), 0)
			CreateNewDummyObject( "arena_barricade8", "gate4", -1, -1, CVector(2886.106, 255.300, 2981.353), Quaternion(0.0000, -0.8910, 0.0000, 0.4540), 0)
			CreateNewDummyObject( "3_ribask", "lodka2", -1, -1, CVector(427.883, 249.295, 884.046), Quaternion(0.0000, 0.2945, 0.0000, 0.9557), 0)
			CreateNewDummyObject( "1_riback", "lodka1", -1, -1, CVector(453.991, 248.346, 922.372), Quaternion(0.0000, 0.6018, 0.0000, 0.7986), 0)
			CreateNewDummyObject( "boevoy", "korablik", -1, -1, CVector(88.858, 254.141, 774.987), Quaternion(0.0273, 0.9383, -0.0982, 0.3305), 0)
			
			CreateNewBreakableObject( "Human","hum01", 1089, CVector(2335.944, 255.000, 675.530), Quaternion(0.000, 0.000, 0.000, 0.000),0 )
			CreateNewBreakableObject( "Human2","hum02", 1089, CVector(2338.227, 255.000, 675.954), Quaternion(0.000, 0.000, 0.000, 0.000),0 )
			CreateNewBreakableObject( "Human3","hum03", 1089, CVector(2340.722, 255.000, 676.000), Quaternion(0.000, 0.000, 0.000, 0.000),0 )
			
			local tp = GetEntityByName("TheTown")
			tp:SetOpenGateToPlayer( false )
			
			SetConditionalClosingForTown( "TheTown", "r1m6", true )
			
			local tp1 = GetEntityByName("TheOilVillage")
			tp1:SetOpenGateToPlayer( false )
			
			SetConditionalClosingForTown( "TheOilVillage", "r1m6", true )

			local malin = getObj("r5_Malinovka_1")
			if malin then malin:SetRuined(true) end
			
			TActivate("trKateberg_create")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Создание Моски -->
	<trigger Name="trKateberg_create" active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>
			CreateNewBreakableObject( "heavy_dot4_octopus","dot01", 1089, CVector(1625.559, 403.536, 2207.941), Quaternion(0.000, -0.668, 0.000, 0.745),0 )
			CreateNewBreakableObject( "heavy_dot4_octopus","dot02", 1089, CVector(1633.995, 403.170, 2149.526), Quaternion(0.000, 0.991, 0.000, 0.133),0 )
			CreateNewBreakableObject( "heavy_dot4_octopus","dot03", 1089, CVector(1666.762, 408.949, 2154.268), Quaternion(0.000, 0.993, 0.000, 0.115),0 )
			CreateNewBreakableObject( "heavy_dot4_octopus","dot04", 1089, CVector(1726.791, 416.029, 2162.286), Quaternion(0.000, 0.938, 0.000, 0.346),0 )
			CreateNewBreakableObject( "heavy_dot4_octopus","dot05", 1089, CVector(1750.201, 415.697, 2199.539), Quaternion(0.000, 0.781, 0.000, 0.624),0 )
			CreateNewBreakableObject( "heavy_dot4_octopus","dot06", 1089, CVector(1745.949, 405.337, 2244.130), Quaternion(0.000, 0.685, 0.000, 0.728),0 )
			CreateNewBreakableObject( "heavy_dot4_octopus","dot07", 1089, CVector(1724.353, 401.912, 2287.687), Quaternion(0.000, 0.248, 0.000, 0.969),0 )
			CreateNewBreakableObject( "heavy_dot4_octopus","dot08", 1089, CVector(1670.741, 406.471, 2297.174), Quaternion(0.000, -0.139, 0.000, 0.990),0 )
			CreateNewBreakableObject( "heavy_dot4_octopus","dot09", 1089, CVector(1630.407, 410.537, 2280.801), Quaternion(0.000, -0.146, 0.000, 0.989),0 )
			
			CreateNewDummyObject( "house1", "town1", -1, -1, CVector(1722.091, 404.671, 2279.759), Quaternion(0.0000, -0.9517, 0.0000, 0.3069), 0)
			CreateNewDummyObject( "house3", "town2", -1, -1, CVector(1714.477, 404.160, 2284.157), Quaternion(0.0000, 0.9837, 0.0000, -0.1801 ), 0)
			CreateNewDummyObject( "townhall", "town3", -1, -1, CVector(1702.264, 405.457, 2282.027), Quaternion(0.0000, 0.9893, 0.0000, 0.1457), 0)
			CreateNewSgNodeObject( "rr_watertower", "town4", -1, -1, CVector(1689.833, 422.578, 2233.635), Quaternion(0.0000, 0.5807, 0.0000, 0.8141), 0.661)
			CreateNewSgNodeObject( "electro_stolb2", "town5", -1, -1, CVector(1695.135, 414.387, 2254.939), Quaternion(0.0000, 0.5700, 0.0000, 0.8216), 1.501)
			CreateNewDummyObject( "workshop1", "town6", -1, -1, CVector(1680.618, 407.845, 2262.302), Quaternion(0.0129, 0.9886, 0.0020, 0.1500), 0)
			CreateNewDummyObject( "petrolhouse2", "town7", -1, -1, CVector(1648.539, 408.373, 2230.356), Quaternion(-0.0014, 0.8116, 0.0060, -0.5842), 0)
			CreateNewSgNodeObject( "transformator2", "town8", -1, -1, CVector(1664.277, 408.914, 2273.756), Quaternion(0.0000, 0.5931, 0.0000, 0.8052), 1.639)
			CreateNewSgNodeObject( "transformator1", "town9", -1, -1, CVector(1642.308, 410.990, 2256.658), Quaternion(0.0000, -0.2356, 0.0000, -0.9719), 1.061)
			CreateNewDummyObject( "house1", "town10", -1, -1, CVector(1631.169, 404.221, 2214.768), Quaternion(-0.0388, 0.9991, -0.0058, -0.0131), 0)
			CreateNewDummyObject( "petrolhouse1", "town11", -1, -1, CVector(1732.456, 404.845, 2267.637), Quaternion(0.0000, 0.5519, 0.0000, 0.8339), 0)
			CreateNewDummyObject( "petrolhouse3", "town12", -1, -1, CVector(1736.258, 405.014, 2257.642), Quaternion(0.0000, -0.1197, 0.0000, 0.9928), 0)
			CreateNewDummyObject( "petrolhouse1", "town13", -1, -1, CVector(1729.249, 415.017, 2173.106), Quaternion(0.0038, 0.9153, -0.0079, 0.4027), 0)
			CreateNewDummyObject( "petrolhouse2", "town14", -1, -1, CVector(1664.590, 408.075, 2162.590), Quaternion(-0.0030, -0.0479, 0.0632, 0.9968), 0)
			CreateNewDummyObject( "house2", "town15", -1, -1, CVector(1643.608, 404.886, 2160.180), Quaternion(0.0261, -0.0508, 0.0476, 0.9972), 0)

			CreateNewBreakableObject( "lamppost1","lamp01", 1089, CVector(1701.368, 406.412, 2265.806), Quaternion(0.000, 0.653, 0.000, 0.758),0 )
			CreateNewBreakableObject( "lamppost1","lamp02", 1089, CVector(1688.357, 409.171, 2217.482), Quaternion(0.000, 0.990, 0.000, 0.141),0 )
			CreateNewBreakableObject( "lamppost1","lamp03", 1089, CVector(1659.556, 407.358, 2207.118), Quaternion(0.000, -0.990, 0.000, -0.139),0 )
			CreateNewBreakableObject( "lamppost1","lamp04", 1089, CVector(1656.203, 409.868, 2266.350), Quaternion(0.000, 0.989, 0.000, 0.150),0 )

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Разрушение Моски -->
	<trigger Name="trKateberg_destroy" active="0">
		<event	timeout="0"		eventid="GE_TIME_PERIOD" />
		<script>

			RuleConsole("g_postEffect DamageStatic")

			for dot = 1,9 do
				local d = GetEntityByName("dot0"..dot)
				if d then d:Remove() end
			end
			
			for building = 1,15 do
				local town = GetEntityByName("town"..building)
				if town then town:Remove() end
			end
			
			for lamp = 1,4 do
				local l = GetEntityByName("lamp0"..lamp)
				if l then l:Remove() end
			end

			local townM = GetEntityByName("TheTown")
			if townM then 
				townM:SetRuined(true)
				townM:Remove()
			end
			
			CreateNewDummyObject("concrete_ruins1", "d_town1", -1, -1, CVector(1697.665, 405.454, 2285.421), Quaternion(0.0000, 0.5592, 0.0000, 0.8290), 0)
			CreateNewDummyObject("concrete_ruins2", "d_town2", -1, -1, CVector(1710.799, 404.386, 2283.772), Quaternion(0.0000, -0.6852, 0.0000, 0.7284), 0)
			CreateNewDummyObject("concrete_ruins4", "d_town3", -1, -1, CVector(1730.666, 404.721, 2270.705), Quaternion(0.0000, -0.4047, 0.0000, 0.9144), 0)
			CreateNewDummyObject("concrete_ruins2", "d_town4", -1, -1, CVector(1734.938, 405.042, 2259.042), Quaternion(0.0000, -0.2419, 0.0000, 0.9703), 0)
			CreateNewDummyObject("waste3", "d_town5", -1, -1, CVector(1721.765, 404.284, 2276.627), Quaternion(0.0000, -0.8077, 0.0000, 0.5895), 0)
			CreateNewDummyObject("concrete_ruins2", "d_town6", -1, -1, CVector(1633.866, 402.630, 2211.191), Quaternion(0.0785, -0.9702, -0.0185, 0.2285), 0)
			CreateNewDummyObject("concrete_ruins2", "d_town7", -1, -1, CVector(1643.388, 404.226, 2160.168), Quaternion(0.0000, 0.2398, 0.0000, 0.9708), 0)
			CreateNewDummyObject("concrete_ruins1", "d_town8", -1, -1, CVector(1666.777, 408.553, 2160.890), Quaternion(0.0378, -0.7839, 0.0479, 0.6179), 0)
			CreateNewDummyObject("concrete_ruins4", "d_town9", -1, -1, CVector(1728.684, 415.047, 2173.565), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), 0)
			CreateNewDummyObject("waste1", "d_town10", -1, -1, CVector(1719.753, 414.237, 2179.585), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), 0)
			CreateNewDummyObject("waste2", "d_town11", -1, -1, CVector(1652.650, 406.229, 2162.736), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), 0)
			CreateNewDummyObject("waste3", "d_town12", -1, -1, CVector(1706.338, 405.644, 2272.166), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), 0)
			CreateNewDummyObject("waste3", "d_town13", -1, -1, CVector(1738.033, 407.348, 2235.853), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), 0)
			CreateNewDummyObject("waste2", "d_town14", -1, -1, CVector(1649.713, 409.109, 2237.972), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), 0)
			CreateNewDummyObject("waste2", "d_town15", -1, -1, CVector(1668.398, 408.408, 2277.405), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), 0)
			CreateNewDummyObject("waste2", "d_town16", -1, -1, CVector(1637.751, 404.103, 2203.983), Quaternion(0.0000, 0.0000, 0.1240, 0.9923), 0)
			CreateNewDummyObject("concrete_ruins1", "d_town17", -1, -1, CVector(1652.789, 408.556, 2227.297), Quaternion(-0.0095, -0.9808, 0.0493, -0.1884), 0)
			CreateNewDummyObject("concrete_ruins2", "d_town18", -1, -1, CVector(1642.656, 410.157, 2257.661), Quaternion(0.0000, 0.9799, 0.0000, 0.1994), 0)
			CreateNewDummyObject("concrete_ruins4", "d_town19", -1, -1, CVector(1681.432, 407.885, 2260.063), Quaternion(0.0000, -0.1779, 0.0000, 0.9840), 0)
			CreateNewDummyObject("concrete_ruins1", "d_town20", -1, -1, CVector(1664.160, 408.737, 2276.835), Quaternion(0.0000, 0.6756, 0.0000, 0.7373), 0)
			CreateNewDummyObject( "minin", "MoskaMain", -1, -1, CVector(1668.172, 408.638, 2247.250), Quaternion(0.000, 0.152, 0.000, -0.988), 0)

			

			CreateNewDummyObject( "heavy_dot_brocken3", "dot10", -1, -1, CVector(1625.559, 403.536, 2207.941), Quaternion(0.000, -0.668, 0.000, 0.745), 0)
			CreateNewDummyObject( "heavy_dot_brocken3", "dot11", -1, -1, CVector(1633.995, 403.170, 2149.526), Quaternion(0.000, 0.991, 0.000, 0.133), 0)
			CreateNewDummyObject( "heavy_dot_brocken3", "dot12", -1, -1, CVector(1666.762, 408.949, 2154.268), Quaternion(0.000, 0.993, 0.000, 0.115), 0)
			CreateNewDummyObject( "heavy_dot_brocken3", "dot13", -1, -1, CVector(1726.791, 416.029, 2162.286), Quaternion(0.000, 0.938, 0.000, 0.346), 0)
			CreateNewDummyObject( "heavy_dot_brocken3", "dot14", -1, -1, CVector(1750.201, 415.697, 2199.539), Quaternion(0.000, 0.781, 0.000, 0.624), 0)
			CreateNewDummyObject( "heavy_dot_brocken3", "dot15", -1, -1, CVector(1745.949, 405.337, 2244.130), Quaternion(0.000, 0.685, 0.000, 0.728), 0)
			CreateNewDummyObject( "heavy_dot_brocken3", "dot16", -1, -1, CVector(1724.353, 401.912, 2287.687), Quaternion(0.000, 0.248, 0.000, 0.969), 0)
			CreateNewDummyObject( "heavy_dot_brocken3", "dot17", -1, -1, CVector(1670.741, 406.471, 2297.174), Quaternion(0.000, -0.139, 0.000, 0.990), 0)
			CreateNewDummyObject( "heavy_dot_brocken3", "dot18", -1, -1, CVector(1630.407, 410.537, 2280.801), Quaternion(0.000, -0.146, 0.000, 0.989), 0)

			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE1", -1, -1, CVector(1643.879, 404.754, 2159.377), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE2", -1, -1, CVector(1664.432, 408.122, 2163.671), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE3", -1, -1, CVector(1728.077, 415.098, 2176.200), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE4", -1, -1, CVector(1733.585, 405.015, 2261.144), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE5", -1, -1, CVector(1720.325, 404.413, 2275.744), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE6", -1, -1, CVector(1703.580, 405.470, 2277.106), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE7", -1, -1, CVector(1644.654, 410.576, 2255.676), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE8", -1, -1, CVector(1650.411, 408.109, 2227.359), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE9", -1, -1, CVector(1666.995, 408.617, 2274.171), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE10", -1, -1, CVector(1679.155, 408.062, 2258.380), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE11", -1, -1, CVector(1667.748, 408.269, 2218.114), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE12", -1, -1, CVector(1677.755, 408.691, 2221.278), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE13", -1, -1, CVector(1633.830, 403.391, 2205.677), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			
			CreateEffectInsertedInRemove( "ET_PS_VEH_EXP1_MED1", CVector(1643.879, 404.754, 2159.377), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), true )
			CreateEffectInsertedInRemove( "ET_PS_VEH_EXP1_MED1", CVector(1664.432, 408.122, 2163.671), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), true )
			CreateEffectInsertedInRemove( "ET_PS_VEH_EXP1_MED1", CVector(1728.077, 415.098, 2176.200), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), true )
			CreateEffectInsertedInRemove( "ET_PS_VEH_EXP1_MED1", CVector(1733.585, 405.015, 2261.144), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), true )
			CreateEffectInsertedInRemove( "ET_PS_VEH_EXP1_MED1", CVector(1720.325, 404.413, 2275.744), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), true )
			CreateEffectInsertedInRemove( "ET_PS_VEH_EXP1_MED1", CVector(1703.580, 405.470, 2277.106), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), true )
			CreateEffectInsertedInRemove( "ET_PS_VEH_EXP1_MED1", CVector(1644.654, 410.576, 2255.676), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), true )
			CreateEffectInsertedInRemove( "ET_PS_VEH_EXP1_MED1", CVector(1650.411, 408.109, 2227.359), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), true )
			CreateEffectInsertedInRemove( "ET_PS_VEH_EXP1_MED1", CVector(1666.995, 408.617, 2274.171), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), true )
			CreateEffectInsertedInRemove( "ET_PS_VEH_EXP1_MED1", CVector(1679.155, 408.062, 2258.380), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), true )
			CreateEffectInsertedInRemove( "ET_PS_VEH_EXP1_MED1", CVector(1667.748, 408.269, 2218.114), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), true )
			CreateEffectInsertedInRemove( "ET_PS_VEH_EXP1_MED1", CVector(1677.755, 408.691, 2221.278), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), true )
			CreateEffectInsertedInRemove( "ET_PS_VEH_EXP1_MED1", CVector(1633.830, 403.391, 2205.677), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), true )

			RuleConsole("g_postEffect cinematicEnd")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Активация стартового ролика -->
	<trigger Name="StartFirstRolikk" active="1">
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
			if QuestStatus("GoToLiden_Quest3")==Q_TAKEN then

				CompleteQuest("GoToLiden_Quest3")

				TActivate("StartRolik_begin")

				AllowSave(false) -- Чтобы игрок не обнулял белонг Лисы

				trigger:Deactivate()
			end
		</script>
	</trigger>

	<!-- Создание локомотива на станции после поездки в лабиринт -->
	<trigger Name="LocoCreate" active="0">
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
			CreateNewDummyObject( "rr_locovagon", "lococo", -1, -1, CVector(2304.984, 255.750, 2849.864), Quaternion(0.0000, 0.1500, 0.0000, 0.9887), 0)
			
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Лиса доехала до первой развилки -->
	<trigger Name="DirRolikStart" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Dir_loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Dir1_loc" />
		<script>
			TActivate("DirRolikBegin")

			CompleteQuest("DecideWay")

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Лиса доехала до Малиновки -->
	<trigger Name="TrapRolikStart" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Trap_loc" />
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Trap1_loc" />
		<script>
			TActivate("TrapRolikBegin")

			CompleteQuest("GrabItems")

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Добавляем в Северку Урал и Белаз после первого разговора Игрока с Велимиром -->
	<trigger Name="UralBelazSeverkaAdd" active="0">
		<event        timeout="0.01"        eventid="GE_TIME_PERIOD" />
		<script>
			local Workshop = GetEntityByName("TheDreenorVillage_Workshop")
			local Repository = Workshop:GetRepositoryByTypename("Vehicles")
			Repository:AddItems("UralForSale", 1)
			Repository:AddItems("BelazForSale", 1)

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- КАМПАНИЯ ЗА ОЛ -->
	<!-- Приехали на завод спасать Серафиму -->
	<trigger Name="PSSRolikStart" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="SerafimaFight_loc" />
		<script>
			CompleteQuest("SaveSerafimaCome")

			TActivate("PSSRolikBegin")

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Обидчики Серафимы мертвы -->
	<trigger Name="SaveSeraTrig" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="PohititAd" />
		<script>
			CompleteQuest("SaveSerafimaFight")
			
			TActivate("ASSRolikBegin")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Сопровождение Серафимы до станции Мудрецов -->
	<trigger Name="trCaravanToStation3sec" active="0">
		<event timeout="3" eventid="GE_TIME_PERIOD" />
		<script>
			GetEntityByName("Serafima"):SetExternalPathByName("SeraPath")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trCaravanToStationINPLACE" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="LootAtStation_loc" />
		<script>
			TDeactivate( "trCaravanToStationDIE" )
			TDeactivate( "trCaravanToStationLength" )

			TActivate("StationRolikBegin")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trCaravanToStationDIE" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="Serafima" />
		<script>

			FailQuest("SerafimaHome_Quest")	
			TActivate("STRolikBegin")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trCaravanToStationLength" active="0">
		<event timeout="1" eventid="GE_TIME_PERIOD" />
		<script>
			local run = GetEntityByName("Serafima")
			local pl = GetPlayerVehicle()
			local len

			if run and run:IsAlive() then
				len = Dist(pl, run)
				if (len > 75) then
					run:SetCustomLinearVelocity( 0 )
					run:SetThrottle( 0 )
				end
			end
		</script>
	</trigger>

	<!-- Сопровождение Серафимы до её дома -->
	<trigger Name="trCaravanToHome3sec" active="0">
		<event timeout="3" eventid="GE_TIME_PERIOD" />
		<script>
			GetEntityByName("Serafima"):SetExternalPathByName("SeraPath2")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trCaravanToHomeINPLACE" active="0">
		<event eventid="GE_TARGET_REACHED" ObjName="Serafima"/>
		<script>
			TDeactivate( "trCaravanToHomeDIE" )
			TDeactivate( "trCaravanToHomeLength" )

			CompleteQuest("SerafimaHome1")

			TActivate("HomeRolikBegin")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trCaravanToHomeDIE" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="Serafima" />
		<script>

			FailQuest("SerafimaHome_Quest")	
			TActivate("STRolikBegin")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trCaravanToHomeLength" active="0">
		<event timeout="1" eventid="GE_TIME_PERIOD" />
		<script>
			local run = GetEntityByName("Serafima")
			local pl = GetPlayerVehicle()
			local len

			if run and run:IsAlive() then
				len = Dist(pl, run)
				if (len > 75) then
					run:SetCustomLinearVelocity( 0 )
					run:SetThrottle( 0 )
				end
			end
		</script>
	</trigger>

	<!-- Сопровождение Серафимы до Северки -->
	<trigger Name="trCaravanToVillage3sec" active="0">
		<event timeout="3" eventid="GE_TIME_PERIOD" />
		<script>
			GetEntityByName("SeraDoz1"):SetExternalPathByName("SeraPath3")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trCaravanToVillageINPLACE" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="SerVill_loc" />
		<script>
			TDeactivate( "trCaravanToVillageDIE" )
			TDeactivate( "trCaravanToVillageLength" )
			
			local ppz = GetEntityByName("SeraDoz1")
			if ppz then ppz:setGodMode(1) end
			
			SetVar("Serafima",1)

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trCaravanToVillageDIE" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="SeraDoz1" />
		<script>

			FailQuest("SerafimaHome_Quest")
			TActivate("STRolikBegin")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trCaravanToVillageLength" active="0">
		<event timeout="1" eventid="GE_TIME_PERIOD" />
		<script>
			local run = GetEntityByName("SeraDoz1")
			local pl = GetPlayerVehicle()
			local len

			if run and run:IsAlive() then
				len = Dist(pl, run)
				if (len > 75) then
					run:SetCustomLinearVelocity( 0 )
					run:SetThrottle( 0 )
				end
			end
		</script>
	</trigger>

	<!-- Разговор с Серафимой на полпути к Северке -->
	<trigger Name="TalkToSerrafima" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="SerTalk_loc" />
		<script>
		
			StartConversation( "Serrafima" )

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Удаление машины Серафимы у её дома и Северки -->
	<trigger Name="SerafimaVehRemove" active="0">
		<event	timeout="3"		eventid="GE_TIME_PERIOD" />
		<script>
			if QuestStatus("CaptureMoskaBefore")==Q_TAKEN then
				local ser = GetEntityByName("SeraDoz1")
				if ser then ser:Remove() end
			end
			
			if QuestStatus("SerafimaHome2")==Q_TAKEN then
				local ser = GetEntityByName("Serafima")
				if ser then ser:Remove() end
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Перед битвой за Кейтберг -->
	<trigger Name="MBRolikStart" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="MoskaBattle_loc" />
		<script>
			CompleteQuest("CaptureMoskaBefore")
		
			TActivate("MBRolikBegin")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Создание адептов у Рязанского -->
	<trigger Name="trVil1st" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Village1_loc" />
		<script>
			TeamCreate("AdeptArmyVil1",1089,CVector(2461.162, 257.495, 1564.141),{"AKF_Belaz2", "AKF_Cruiser1", "AKF_Belaz1", "AKF_Cruiser2"}, CVector(2745.438, 257.598, 1325.056), 1)

			CompleteQuest("DefendVillagePre1")
			
			TActivate("trVil1stDIE")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Создание адептов у Чугуевки -->
	<trigger Name="trVil2nd" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Village2_loc" />
		<script>
			TeamCreate("AdeptArmyVil2",1089,CVector(1006.921, 275.372, 2434.896),{"AKF_Belaz2", "AKF_Cruiser1", "AKF_Belaz1"},CVector(658.125, 257.602, 2556.624),1)

			CompleteQuest("DefendVillagePre2")
			
			TActivate("trVil2ndDIE")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Отбили Чугуевку. Разговор с Лисой -->
	<trigger Name="trVil2ndDIE" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="AdeptArmyVil2" />
		<script>
			
			SetVar("Serafima",2)
			
			CompleteQuest("DefendVillage2")
			
			SetTolerance(1100,1088,RS_ALLY)
			
			StartConversation( "LisaPlen1" )
			
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Создание и привязка Лисы -->
	<trigger Name="LisaFollow" active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>
			TeamCreate("CARLISAE",1042,CVector(727.827, 255.000, 2515.639),{"LisaCar"})
			
			local vehLisa = GetEntityByName("CARLISAE_vehicle_0")
			if vehLisa then
				vehLisa:SetSkin(2)
				vehLisa:setImmortalMode(1)
			end
			
			local newControllerId = CreateNewObject {
				prototypeName	= "someNPCMotionController",
				objName	= "LisaCont"
			}

			local newController = GetEntityByID(newControllerId)

			local FVehicle = GetEntityByName("CARLISAE_vehicle_0")

			if newController and FVehicle then
				newController:setVehicleUnderControl(FVehicle)
			end
			
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Удаление Лисы после разговора с ней в Кейтберге -->
	<trigger Name="LisaDelete" active="0">
		<event	timeout="1"		eventid="GE_TIME_PERIOD" />
		<script>

			local FVehicle = GetEntityByName("CARLISAE_vehicle_0")
			if FVehicle then FVehicle:Remove() end
			
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Перед битвой за Моску -->
	<trigger Name="PKERolikStart" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="PreKateberg_loc" />
		<script>
			TActivate("PKERolikBegin")

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Адепты разгромлены. ОЛ уплывают. -->
	<trigger Name="FGRolikStart" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Uplyli_loc" />
		<script>
			CompleteQuest("GoToMudrec1")

			TActivate("OpenTheBridge")
			
			TActivate("FGRolikBegin")
			TActivate("triggerExitToMap15")
			TActivate("triggerExitToMap14")

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- КАМПАНИЯ ЗА АДЕПТОВ -->
	<!-- Неудачная засада на ОЛ -->
	<trigger Name="KLRolikStart" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Zasada_loc" />
		<script>
			CompleteQuest("KillStar1_Quest1")

			for zone = 1,16 do
				SwitchInfectionBelong("InfectionZone"..zone, 1088)
			end

			TActivate("KLRolikBegin")

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Опустевшая Северка -->
	<trigger Name="KL2RolikStart" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Zasada2_loc" />
		<script>
			CompleteQuest("KillStar1_Quest2")

			TActivate("KL2RolikBegin")

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- На заводе, где поймали Серафиму -->
	<trigger Name="TSRolikStart" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="SerafimaFight_loc" />
		<script>
			TActivate("TSRolikBegin")

			trigger:Deactivate()

		</script>
	</trigger>

	<!-- Создание трактора Серафимы -->
	<trigger Name="TraktorReady" active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>
			local doz = CreateVehicleEx("Traktor01","Dozz", CVector(1446.528, 255.827, 2801.617), 1088)
			if doz then
				doz:SetRotation(Quaternion(0.001, 0.849, 0.002, -0.529))
			end

			TActivate("TraktorDEAD")

			CompleteQuest("TortSera_Quest3")

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Уничтожили Грейдер Серафимы -->
	<trigger Name="TraktorDEAD" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="Dozz" />
		<script>
			CompleteQuest("KillStar2_Quest1")
			TActivate("BV1RolikStart")
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Перед налётом на Чугуевку -->
	<trigger Name="BV1RolikStart" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="BurnVil1_loc" />
		<script>
			TActivate("BV1RolikBegin")
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Перед налётом на Рязанское -->
	<trigger Name="BV2RolikStart" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="BurnVil2_loc" />
		<script>
			TActivate("BV2RolikBegin")
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Приехали в Северку топить корабль -->
	<trigger Name="FSSRolikStart" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Zasada2_loc" />
		<script>
			TActivate("FSSRolikBegin")

			CompleteQuest("KillStar2_Quest5")

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Открываем мост к Мудрецам -->
	<trigger Name="OpenTheBridge" active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>

			for gate = 1,4 do
				local g = GetEntityByName("gate"..gate)
				if g then g:Remove() end
			end

			for zone = 1,16 do
				SwitchInfectionBelong("InfectionZone"..zone, 1005)
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Едем в Лабиринт -->
	<trigger Name="ETLLRolikStart" active="1">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>
			if QuestStatus("LastIspytanie_Quest2")==Q_TAKEN then

				TActivate("ETLLRolikBegin")

				CompleteQuest("LastIspytanie_Quest2")

				trigger:Deactivate()
			end
		</script>
	</trigger>

	<!-- Переход в Хель -->
	<trigger Name="triggerExitToMap14" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="ToR1M4" />
		<script>
			local Plf = GetPlayerVehicle()
			Plf:SetThrottle( 0 )
			Plf:SetCustomLinearVelocity( 0 )

			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.x = PlfCoor.x + 10
			PlfCoor.y = PlfCoor.y + 5
			PlfCoor.z = PlfCoor.z + 30

			if QuestStatus("SerafimaHome_Quest")~=Q_TAKEN then
				ValidateGameVersion()

				local b = SpawnMessageBox( "8801" )
				if b == 1 then

					PassToMap("r1m4", "FromR1M6", -1 )
					
				else
					SaveAllToleranceStatus(RS_NEUTRAL)

					FlyAround(0.01, 0, 35, 3, PlfCoor, PlfID, 1, 1 )
					StartCinematic()

					TActivate ("RolikExitToMap14")
					TActivate ("RolikENDExitToMap14")
				end
			else
				SaveAllToleranceStatus(RS_NEUTRAL)

				FlyAround(0.01, 0, 35, 3, PlfCoor, PlfID, 1, 1 )
				StartCinematic()

				TActivate ("RolikExitToMap14")
				TActivate ("RolikENDExitToMap14")
			end
 		</script>
	</trigger>
	<trigger Name="RolikExitToMap14" active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			
			local Plf = GetPlayerVehicle()
			Plf:SetThrottle( 0 )
			Plf:SetCustomLinearVelocity( 0 )

			trigger:Deactivate()    
		</script>
	</trigger>
	<trigger Name="RolikENDExitToMap14" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetGamePositionOnGround( CVector(271.465, 256.071, 1736.162))
				vehPlayer:SetRotation(Quaternion(-0.000, 0.526, 0.000, 0.850))
			end

			TDeactivate( "RolikExitToMap14" )

			SetCameraBehindPlayerVehicle()

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Переход в Горы Мудрецов -->
	<trigger Name="triggerExitToMap15" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="ToR1M5" />
		<script>
			local Plf = GetPlayerVehicle()
			Plf:SetThrottle( 0 )
			Plf:SetCustomLinearVelocity( 0 )

			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.x = PlfCoor.x + 15
			PlfCoor.y = PlfCoor.y + 5
			PlfCoor.z = PlfCoor.z + 15

			ValidateGameVersion()

			local b = SpawnMessageBox( "8801" )
			if b == 1 then
			
				for fire = 1,13 do
					local f = GetEntityByName("FIRE"..fire)
					if f then f:Remove() end
				end
				
				PassToMap("r1m5", "FromR1M6", -1 )
				
				if QuestStatus("GoToMudrec2")==Q_TAKEN or QuestStatus("GoToMudr_Quest2")==Q_TAKEN then
					CompleteQuestIfTaken("GoToMudrec2")
					CompleteQuestIfTaken("GoToMudr_Quest2")
				end
			else
				SaveAllToleranceStatus(RS_NEUTRAL)

				FlyAround(0.1, 0, 25, 3, PlfCoor, PlfID, 1, 1 )
				StartCinematic()

				TActivate ("RolikExitToMap15")
				TActivate ("RolikENDExitToMap15")
			end
 		</script>
	</trigger>
	<trigger Name="RolikExitToMap15" active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			
			local Plf = GetPlayerVehicle()
			Plf:SetThrottle( 0 )
			Plf:SetCustomLinearVelocity( 0 )

			trigger:Deactivate()    
		</script>
	</trigger>
	<trigger Name="RolikENDExitToMap15" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetGamePositionOnGround( CVector(3768.328, 259.453, 3779.808))
				vehPlayer:SetRotation(Quaternion(-0.026, 0.920, -0.061, -0.386))
			end

			TDeactivate( "RolikExitToMap15" )

			SetCameraBehindPlayerVehicle()

			trigger:Deactivate()
		</script>
	</trigger>
</triggers>