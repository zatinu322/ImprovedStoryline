<?xml version="1.0" encoding="windows-1251" standalone="yes" ?>
<triggers>
	<!-- Инициализация карты -->
	<trigger	Name="GlobalVar"	active="1">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			SetVar("globalEnterToPesht",1)
			SetVar("ZasadaAR",0)
			SetVar("DeadMer",0)
			SetVar("QuickWay",0)
			SetVar("QuickWayAlt",0)
			SetVar("KnownMap",0)
			SetVar("BeglecPrice",0)
			SetVar("Cemetery", 0)
			SetVar("AutoSaveCount", 0)
			SetVar("StrangerSkin", 0)
			if GAME_VERSION then SetVar("ISLVersion", GAME_VERSION) end

			CreateNewDummyObject("rr_barrier3", "mininBarrier", -1, -1, CVector(6718.542, 230.886, 5747.152), Quaternion(-0.3620, 0.5734, 0.2916, 0.6747), 0)

			local circus = getObj("r1m3_Circus_1")
			if circus then circus:SetRuined(true) end

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Автосохранение -->
	<trigger Name="trAutoSave" active="0">
		<event	timeout="1"		eventid="GE_TIME_PERIOD" />
		<script>
			if GetVar("AutoSaveCount").AsInt == 0 then
				SetVar("AutoSaveCount", 1)
				AutoSave(STR_BOSS_CHOOSE)
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Раскладка случайного оружия по ящикам -->
	<trigger	Name="trVaterlandPlaceSecret"	active="1">
		<event	timeout="0.1"			eventid="GE_TIME_PERIOD" />
		<script>
			local gunlist = {"hornet01","specter01","pkt01","storm01","kord01","vector01","vulcan01"}
			local len = getn(gunlist)

			for i=1,12 do
				CreateBoxWithAffixGun(CVector(getPos("SecretPlace"..i.."_loc")), gunlist[exrandom(len)], random(0, 2))
			end
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Первый заезд на карту -->
	<trigger	Name="trStartMap"	active="1">
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
			
			if IsQuestTaken("d_FindRealFatherRoom_Quest") then
				local tp = GetEntityByName("Pesht")
				if tp then
					tp:SetOpenGateToPlayer( false )
				end
			end

			SetConditionalClosingForTown( "Pesht", "r1m3", true )

			CreateNewDummyObject( "arena_barricade8", "zagr1", -1, -1, CVector(5523.000, 217, 1423.368), Quaternion(0.000, -0.706, 0.000, 0.709), 0)
			CreateNewDummyObject( "arena_barricade8", "zagr2", -1, -1, CVector(5631.000, 217, 1422.771), Quaternion(0.000, -0.706, 0.000, 0.709), 0)

			CreateNewDummyObject( "bridge_military", "BridgeForDestroy", -1, -1, CVector(5576.837, 202.7, 1423.237), Quaternion(0.0000, 0.7086, 0.0000, 0.7056), 0)

			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE01", -1, -1, CVector(4214.315, 231.049, 1020.738), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE02", -1, -1, CVector(4136.448, 252.076, 834.866), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE03", -1, -1, CVector(4183.487, 235.000, 1217.818), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE04", -1, -1, CVector(4043.283, 235.428, 723.935), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE05", -1, -1, CVector(4045.008, 234.819, 1037.936), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE06", -1, -1, CVector(4221.199, 231.304, 1010.331), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))

			TActivate("trStartMap221")

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Сюжетный срез -->
	<trigger Name="trQuickWay" active="1">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="QuickWay_loc" />
		<script>
			SetVar("QuickWay",1)
			
			if QuestStatus("d_GiveMoneyToBase_Quest")==Q_CANBEGIVEN then
				TakeQuest("d_GiveMoneyToBase_Quest")
				FailQuest("d_GiveMoneyToBase_Quest")
			end
			
			TActivate ("tr_OpenTownAndShowButtonInPesht")
			
			FailQuestIfTaken("d_RideAcrossBase_Quest")
			FailQuestIfTaken("d_GiveMoneyToBase_Quest")
			FailQuestIfTaken("d_GetBomb_Quest")
			FailQuestIfTaken("d_DestroyBridge_Quest")

			TDeactivate("preBOOOM")
			TDeactivate("BOOOM")
			TDeactivate("SHAHTSBANDITBOSSDIE")

			CompleteQuestIfTaken("d_MoveToPesht_Quest")

			local a = GetEntityByName("BaseGuardian_loc")
			if a then a:SetProperty("Active",1) end

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Активация катсцены с чехлами -->
	<trigger	Name="trStartMap221"	active="0">
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
			if IsQuestTaken("d_chehol1") then

				TActivate("Chehol_1")
				
				if QuestStatus("FreeExtremistLeader_Quest1")==Q_COMPLETED then
					TDeactivate("triggerExitToMap14")
				end

				trigger:Deactivate()
			end
		</script>
	</trigger>

	<trigger	Name="trArchVisit"	active="0">
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
			if QuestStatus("r3m2_RideToFatherRoomAfterOracul")==Q_TAKEN and QuestStatus("r1m3_ArchVisit")==Q_CANBEGIVEN then

				TakeQuest("r1m3_ArchVisit")

				trigger:Deactivate()
			end
		</script>
	</trigger>

	<!-- Открытие Пешта -->
	<trigger Name="tr_OpenTownAndShowButtonInPesht" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
			local tp = GetEntityByName("Pesht")
			if tp then
				tp:SetOpenGateToPlayer( true )
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Игрок выезжает из Пешта -->
	<trigger Name="tr_PeshtTrue" active="1">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="locPeshtTrue" />
		<event eventid="GE_OBJECT_IN_LOCATION" ObjName="locPeshtTrue" />
		<script>
			SetVar("globalEnterToPesht",1)
		</script>
	</trigger>

	<trigger Name="tr_PeshtFalse" active="1">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="locPeshtFalse" />
		<event eventid="GE_OBJECT_IN_LOCATION" ObjName="locPeshtFalse" />
		<script>
			SetVar("globalEnterToPesht",-1)
		</script>
	</trigger>

	<trigger Name="tr_LeavePesht" active="1">
		<event eventid="GE_TOWN_CONDITIONAL_CLOSING" ObjName="Pesht" />
		<script>
			if IsQuestComplete("d_DestroyBridge_Quest") or IsQuestComplete("FightForPesht") then
				local b = SpawnMessageBox( "8804" )
				if b == 1 then
					local a = (-1)*(GetVar("globalEnterToPesht").AsInt)
					SetVar("globalEnterToPesht",a)

					TActivate ("tr_RolikAndPosLeavePesht")
				else
					TActivate ("tr_RolikAndPosLeavePesht")
				end
			else
				local b = SpawnMessageBox( "8805" )
				if b == 1 then
					if GetPlayerMoney() >= 1500 then
						AddPlayerMoney( -1500 )

						local a = (-1)*(GetVar("globalEnterToPesht").AsInt)
						SetVar("globalEnterToPesht",a)

						TActivate ("tr_RolikAndPosLeavePesht")
					else
						SpawnMessageBox( "6006" )	

						TActivate ("tr_RolikAndPosLeavePesht")			
					end
				else
					TActivate ("tr_RolikAndPosLeavePesht")
				end
			end

			if QuestStatus("FightForPesht1")==Q_TAKEN then
				TDeactivate("cinFightForPesht")
			end
			
		</script>
	</trigger>

	<trigger Name="tr_RolikAndPosLeavePesht" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
			LeaveTown()

			local Plf = GetPlayerVehicle()
			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.y = PlfCoor.y + 75
			PlfCoor.z = PlfCoor.z + 15

			Plf:SetCustomControlEnabled( true )
			Plf:SetCustomLinearVelocity( 0 )
			Plf:SetThrottle( 0 )
			Plf:SetCustomControlEnabled( false )

			FlyAround(6, 0, 10, 5, PlfCoor, PlfID, 0, 1)
			StartCinematic()

			local a = GetVar("globalEnterToPesht").AsInt
			if a == 1 then
				Plf:SetCustomControlEnabled( true ) 
				Plf:SetGamePositionOnGround( CVector(3912.081, 245, 3718.224))
				Plf:SetRotation(Quaternion(-0.059, -0.707, -0.033, 0.704))
				Plf:SetExternalPathByName("pesht_true")
				Plf:SetCustomControlEnabled( false )  

				TActivate( "tr_RolikAndPosLeavePesht_true" )    
			else
				Plf:SetCustomControlEnabled( true ) 
				Plf:SetGamePositionOnGround( CVector(4224.247, 245, 3705.479))
				Plf:SetRotation(Quaternion(0.039, 0.778, -0.046, 0.626))
				Plf:SetExternalPathByName("pesht_false")
				Plf:SetCustomControlEnabled( false ) 

				TActivate( "tr_RolikAndPosLeavePesht_false" )     
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="tr_RolikAndPosLeavePesht_true" active="0">
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<script>
			local Plf = GetPlayerVehicle()
			Plf:SetCustomControlEnabled( true )
			Plf:SetCustomLinearVelocity( 0 )
			Plf:SetThrottle( 0 )
			Plf:SetRotation(Quaternion(-0.059, -0.707, -0.033, 0.704))
			Plf:PlaceToEndOfPath("pesht_true")
			Plf:SetCustomControlEnabled( false )

			SetCameraBehindPlayerVehicle()

			if QuestStatus("FightForPesht1")==Q_TAKEN then
				TActivate("cinFightForPesht")
			end

			trigger:Deactivate() 
		</script>
	</trigger>

	<trigger Name="tr_RolikAndPosLeavePesht_false" active="0">
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<script>
			local Plf = GetPlayerVehicle()
			Plf:SetCustomControlEnabled( true )
			Plf:SetCustomLinearVelocity( 0 )
			Plf:SetThrottle( 0 )
			Plf:SetRotation(Quaternion(0.039, 0.778, -0.046, 0.626))
			Plf:PlaceToEndOfPath("pesht_false")
			Plf:SetCustomControlEnabled( false )

			SetCameraBehindPlayerVehicle()

			if QuestStatus("FightForPesht1")==Q_TAKEN then
				TActivate("cinFightForPesht")
			end

			trigger:Deactivate() 
		</script>
	</trigger>

	<!-- Захват Пешта Бригадой -->
	
	<trigger Name="trPeshtCapture" active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>
			local town = getObj('Pesht')
			if town then town:SetBelong(1012) end

			CreateNewDummyObject("flagshtock", "PeshtFlag1", -1, -1, CVector(4201.842, 254.859, 3690.678), Quaternion(0, 0, 0, 1), 0)
			CreateNewDummyObject("flagshtock", "PeshtFlag2", -1, -1, CVector(3927.617, 252.409, 3701.034), Quaternion(0, 0, 0, 1), 0)

			trigger:Deactivate()
		</script>
	</trigger>


	<!-- Игрок платит и проезжает по мосту -->
	<trigger Name="BASEATTACK" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD"/>
		<script>
			local rrr = GetEntityByName ("zagr1")
			if rrr then rrr:Remove() end
			local rrr = GetEntityByName ("zagr2")
			if rrr then rrr:Remove() end

			local a = GetEntityByName("BaseGuardian_loc")
			if a then a:SetProperty("Active",0) end

			TActivate( "BASEATTACKEND" )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="BASEATTACKEND" active="0">
		<event eventid="GE_OBJECT_LEAVES_LOCATION" ObjName="BaseGuardianLoc_out" />
		<script>
			CreateNewDummyObject( "arena_barricade8", "zagr1", -1, -1, CVector(5523.000, 217, 1423.368), Quaternion(0.0000, -0.7056, 0.0000, 0.7086), 0)
			CreateNewDummyObject( "arena_barricade8", "zagr2", -1, -1, CVector(5631.000, 217, 1422.771), Quaternion(0.0000, -0.7056, 0.0000, 0.7086), 0)

			local a = GetEntityByName("BaseGuardian_loc")
			if a then a:SetProperty("Active",1) end

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Кладбище -->
	<trigger Name="trPlayerEntersCemetery" active="1">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="Cemetery_loc" />
		<script>
			PlayCustomMusic("Cemetery1")

			AllowSave(false)

			local Plf = GetPlayerVehicle()
			if Plf then
				Plf:LimitMaxSpeed(11.11)
			end

			TActivate("trPlayerLeavesCemetery")
			TActivate("trCemeteryEffects")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trCemeteryEffects" active="0">
		<event	timeout="1.8"		eventid="GE_TIME_PERIOD" />
		<script>
			RuleConsole("g_postEffect cinematic04")

			TActivate("trCemeteryHpDecreasing")
			TActivate("CemeteryCutscenesActivation_1")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trCemeteryHpDecreasing" active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			RuleConsole("g_postEffect cinematic04")

			local Plf = GetPlayerVehicle()
			if Plf then
				local PlHP = Plf:GetHealth()
				if PlHP > 667 then
					Plf:AddModifier("hp", "- 3")
				elseif 666 > PlHP then
					Plf:AddModifier("hp", "+ 3")
				elseif PlHP == 666 then
					Plf:AddModifier("hp", "= 666")
				else
					Plf:AddModifier("hp", "= 666")
				end
			end

			print("CURSED ")
			
		</script>
	</trigger>

	<trigger Name="trPlayerLeavesCemetery" active="0">
		<event eventid="GE_OBJECT_LEAVES_LOCATION" ObjName="Cemetery_loc" />
		<script>
			StopPlayingCustomMusic()

			AllowSave(true)

			RuleConsole("g_postEffect cinematicEnd")

			TActivate("trPlayerEntersCemetery")
			TDeactivate("trCemeteryHpDecreasing")
			TDeactivate("trCemeteryEffects")
			TDeactivate("CemeteryCutscenesActivation_1")
			TDeactivate("CemeteryCutscenesActivation_2")
			TDeactivate("CemeteryCutscenesEnd")

			local Plf = GetPlayerVehicle()
			if Plf then
				Plf:UnlimitMaxSpeed()
				local PlfHealth = Plf:GetHealth()
				if PlfHealth > 660 and 670 > PlfHealth then
					Plf:AddModifier("hp", "= 666")
				end
			end

			SetVar("Cemetery", 0)

			trigger:Deactivate()
		</script>
	</trigger>


	<!-- Нападение бандитов на Горные шахты -->
	<trigger Name="SHAHTSBANDIT" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
			TeamCreate("ShahtsBoss",1002,CVector(2202, 285, 6936),{"r1m1_molokovoz02","r1m3_Fighter01","r1m1_CaravanBug02"}, CVector(2041, 287, 7182), 1)

			TakeQuest("d_BombShahtsAtakBandits_Quest")

			TActivate("SHAHTSBANDITBOSSDIE")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="SHAHTSBANDITBOSSDIE" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="ShahtsBoss" />
		<script>
   			CompleteQuest( "d_BombShahtsAtakBandits_Quest" )

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Подрыв моста Бригады -->
	<trigger Name="preBOOOM" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="OhranaBridge" />
		<script>
   			TActivate( "BOOOM" )

			CompleteQuest("d_DestroyBridge_Quest1")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="BOOOM" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="TheDestroyBridgeLoc" />
		<script>
  			if IsQuestTaken("d_DestroyBridge_Quest2") then
				RemoveQuestItem("quest_explosive")

   				CompleteQuest( "d_DestroyBridge_Quest2" )
   
				AddFadingMsgByStrIdFormatted("fm_player_use_thing", "quest_explosive")

				local a = GetEntityByName("BaseGuardian_loc")
				if a then a:SetProperty("Active",0) end

				TActivate( "RolikBegin_BOOOM" )

				trigger:Deactivate()
  			end
		</script>
	</trigger>

	<!-- Приезды в дом Айвена -->
	<trigger Name="FATHERHOUSE" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="HouseLoc" />
		<script>
 			if  IsQuestTaken("d_FatherRoomInMinin_Quest") and not(IsQuestComplete("d_FatherRoomInMinin_Quest")) then
				TActivate( "RolikBegin_FATHERHOUSE" )

   				CompleteQuest( "d_FatherRoomInMinin_Quest" )

				AddHistory( "r1_Father_Room_00" )
				AddFadingMsgId( "fm_history_got" )
				AddQuestItem("quest_key_for_submarine")
				AddFadingMsgByStrIdFormatted( "fm_player_add_thing", "quest_key_for_submarine")
			end
			
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetCustomControlEnabled( true )
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:SetThrottle( 0 )
				vehPlayer:SetCustomControlEnabled( false )
			end
			
			if  IsQuestTaken("r3m2_RideToFatherRoomAfterOracul") and not(IsQuestComplete("r3m2_RideToFatherRoomAfterOracul")) then
				TActivate( "RolikBegin_FATHERHOUSERETURN" )

   				CompleteQuest( "r3m2_RideToFatherRoomAfterOracul" )
			end
		</script>
	</trigger>

<!-- Освободить скважину -->
	<trigger Name="ATTACKOILMINE" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
			TeamCreate("OilMineBoss",1044,CVector(6969,257,7068),{"Sml401","r1m3_Fighter01","r1m1_scout02"}, nil, 1)

			TakeQuest("d_DriveBanditFromOilMine_Quest")

			TActivate("BOSSOILMINEDIE")

			SetTolerance(1100, 1044, RS_ENEMY)

			trigger:Deactivate()
		</script>
	</trigger>

<!-- Догнать бандита -->
	<trigger Name="RUNTORUNER" active="0">
		<event timeout="1" eventid="GE_TIME_PERIOD" />
		<script>
			local run = GetEntityByName("OilMineRuner_vehicle_0")
			local pl = GetPlayerVehicle()
			local len

			if run and run:IsAlive() then
				len = Dist(pl, run)

				if (len > 305) or (15 > len) then
					runer = 18

					TActivate("RUNTORUNER_cp")

					TDeactivate("RUNTORUNERENDRACE")

					trigger:Deactivate()
				end
			else
				runer = 38

				TActivate("RUNTORUNER_cp")

				TDeactivate("RUNTORUNERENDRACE")

				trigger:Deactivate()
			end
		</script>
	</trigger>

	<!-- Бандит приехал на базу. Зачистка. -->
	<trigger Name="RUNTORUNERENDRACE" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="EndRaceLoc" />
		<script>
			SetTolerance( 1100, 1044, RS_ENEMY )
			
			TeamCreate("OilMineBaseBoss",1044,CVector(4483, 265, 7496),{"r1m3_Fighter01","r1m3_Fighter02", "DemoBandit"},CVector(4546, 263, 7479), 1)

			local runner = GetEntityByName("OilMineRuner_vehicle_0")
			local runner_new = GetEntityByName("OilMineBaseBoss"):GetVehicle(2)

			CompleteQuest( "d_FindBanditBaseOfOilMine_Quest1" )

			if runner and runner_new then
				local runner_pos = runner:GetPosition()
				local runner_rot = runner:GetRotation()
				local runner_skin = runner:GetSkin()

				runner:Remove()

				runner_new:SetGamePositionOnGround(runner_pos)
				runner_new:SetRotation(runner_rot)
				runner_new:SetSkin(runner_skin)
			end
			
			SetTolerance( 1100, 1044, RS_ENEMY )

			TActivate("KILLBOSSOILMINEBASE")

			TDeactivate("RUNTORUNER")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="KILLBOSSOILMINEBASE" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="OilMineBaseBoss" />
		<script>
   			CompleteQuest( "d_FindBanditBaseOfOilMine_Quest2" )
   			
   			TActivate("KILLBOSSOILMINEBASE2")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="KILLBOSSOILMINEBASE2" active="0">
		<event	timeout="1"		eventid="GE_TIME_PERIOD" />
		<script>
		
   			StartConversation( "BanditVyshka" )

			trigger:Deactivate()
		</script>
	</trigger>

<!-- Догнать мера -->
	<trigger Name="SPYMER" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			TActivate( "RolikBegin_SPYMER" )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RUNMER" active="0">
		<event timeout="1" eventid="GE_TIME_PERIOD" />
		<script>
			local run = GetEntityByName("MerCar_vehicle_0")
			local pl = GetPlayerVehicle()
			local len

			if run and run:IsAlive()  then
				len = Dist(pl, run)
				if (len > 305) or (15 > len) then

					TActivate( "RUNMER_cp" )

					TDeactivate("RUNMEREND")

					trigger:Deactivate()
				end
			else
				SetVar("DeadMer",1)
				
				TActivate("Ending35")

				TDeactivate("RUNMEREND")

				trigger:Deactivate()
			end
		</script>
	</trigger>

	<trigger Name="RUNMEREND" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="TheSpy" />
		<script>
			TDeactivate("RUNMER")
			
			CompleteQuestIfTaken("d_MoveToMer_Quest")

			TActivate( "RolikBegin_THESPY" )

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Караван из Минина в Хель -->
	<trigger Name="CARAVANTOR1M4" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
			TeamCreate("KARAVAN14",1010,CVector(6081, 260, 5915),{"r2m2_CaravanUral02"}, nil, 1)
			local vehP = GetEntityByName("KARAVAN14_vehicle_0")
			if vehP then
				vehP:SetExternalPathByName("karavan_path")
				vehP:SetSkin(2)
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Создание армии ТСП подле Базы 51 -->
	<trigger Name="ArmiaCreate" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
		
			if IsQuestComplete("d_DestroyBridge_Quest") then

				CreateVehicleEx( "BelazTSP", "ArmyVeh1", CVector(6026.965, 238.828, 1919.051), 1010, Quaternion(0.073, 0.298, 0.026, 0.951) )
				CreateVehicleEx( "TSPFighter", "ArmyVeh2", CVector(6020.172, 237.190, 1926.912), 1010, Quaternion(0.004, 0.276, 0.015, 0.961) )
				CreateVehicleEx( "tspfighter2", "ArmyVeh3", CVector(6012.056, 236.525, 1931.321), 1010, Quaternion(0.041, 0.236, -0.038, 0.970) )

				for car = 1,3 do
					local veh = GetEntityByName("ArmyVeh"..car)
					if veh then
						veh:setGodMode(1)
						veh:setImmortalMode(1)
						veh:SetRandomSkin()
					end
				end

				TActivate( "ArmiaTSPPreparationBegin" )
			end
			
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Создание машины вора -->
	<trigger Name="TRIGGER_THIEFWAR" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
			TeamCreate("ThiefCar",1044,CVector(6844.412, 288.256, 1161.126),{"UralShot"}, CVector(7081.790, 308.722, 1042.585), 0, Quaternion(0.015, 0.818, 0.110, 0.564))

			TakeQuest("r1m3_FightWithThief")

			SetTolerance(1100, 1044, RS_ENEMY)
			SetTolerance(1012, 1044, RS_ALLY)

			TActivate("TRIGGER_THIEFDIE")

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Лиса ворует диск 2 у выезда на Хель -->
	<trigger Name="TRIGGER_LISAAFTERTHIEF" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="SnatchLoc" />
		<script>
			TActivate( "RolikBegin_LISAAFTERTHIEF" )

   			FailQuest( "r1m3_MoveToOraculAfterThief" )
   			TakeQuest( "LisaVPeshte" )

			RemoveQuestItem("quest_disk_1")
			RemoveQuestItem("quest_disk_2")
			RemoveQuestItem("quest_key_for_submarine")
			
			AddFadingMsgByStrIdFormatted( "fm_player_rem_thing", "quest_disk_1")
			AddFadingMsgByStrIdFormatted( "fm_player_rem_thing", "quest_disk_2")
			AddFadingMsgByStrIdFormatted( "fm_player_rem_thing", "quest_key_for_submarine")

			AddFadingMsgId( "fm_history_got" )

			trigger:Deactivate()
		</script>
	</trigger>

<!-- Подъезжаем к тоннелю -->
	<trigger Name="TUNNELLOCATION" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="TunnelLoc" />
		<script>
			CompleteQuestIfTaken("d_FindDoorInTunel_Quest")

			TActivate("RolikBegin_Tunel")

			AddHistory( "r1_See_Tonnel_00" )
			AddFadingMsgId( "fm_history_got" )

			trigger:Deactivate()
		</script>
	</trigger>

<!-- Устроить засаду -->
	<trigger Name="ZASADATUNEL" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="ZasadaLocQ" />
		<script>
   			CompleteQuest( "d_FindZasadaInTunel_Quest" )

			TActivate( "RolikBegin_Zasada" )

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Слежка за незнакомцем из тоннеля -->
	<trigger Name="RUNTOPIONEER" active="0">
		<event timeout="1" eventid="GE_TIME_PERIOD" />
		<script>
			local run = GetEntityByName("Pioneer_vehicle_0")
			local pl = GetPlayerVehicle()
			local len

			if run and run:IsAlive() then
				len = Dist(pl, run)

				if (15 > len) then
					SetTolerance( 1100, 1046, RS_ENEMY )

					local parentrun = GetEntityByName("Pioneer")
					if parentrun then
						parentrun:SetDestination(pl:GetPosition())
					end

					FailQuest( "d_SerchCarTunel_Quest" )
					FailQuest("d_FindKeyInTunel_Quest")
					TakeQuest("d_KillCarTunel_Quest")

					TDeactivate( "PIONEERASGARD" )

					trigger:Deactivate()

				elseif (len > 305) then
					SaveAllToleranceStatus(RS_NEUTRAL)

					local Plf = GetPlayerVehicle()
					local PlfID = GetPlayerVehicleId()
					local PlfCoor = Plf:GetPosition()
					PlfCoor.x = PlfCoor.x + 25
					PlfCoor.y = PlfCoor.y + 5
					PlfCoor.z = PlfCoor.z - 25

					Plf:SetCustomControlEnabled( true )
					Plf:SetCustomLinearVelocity( 0 )
					Plf:SetThrottle( 0 )
					Plf:SetCustomControlEnabled( false )

					FlyAround( 1, 0, 25, 7, PlfCoor, PlfID, 1, 1 )
					StartCinematic()

					AddCinematicMessage( 18, 1 )

					TActivate("PIONEERDEAD_cp")

					TDeactivate( "PIONEERASGARD" )
					TDeactivate("PIONEERDEAD")

					FailQuest("d_SerchCarTunel_Quest")

					trigger:Deactivate()

				elseif 1.499>(GetTolerance(1100, 1046)) then
					FailQuest( "d_SerchCarTunel_Quest" )
					FailQuest("d_FindKeyInTunel_Quest")
					TakeQuest("d_KillCarTunel_Quest")

					TDeactivate( "PIONEERASGARD" )

					trigger:Deactivate()
				end
			end
		</script>
	</trigger>

	<trigger Name="PIONEERASGARD" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="PioneerLoc" />
		<script>
			FailQuest("d_FindKeyInTunel_Quest")
   			CompleteQuest( "d_SerchCarTunel_Quest" )
			
			TDeactivate( "PIONEERDEAD" )
			TDeactivate( "RUNTOPIONEER" )

			TActivate( "RolikBegin_PIONEERASGARD" )

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Открываем тоннель -->
	<trigger Name="TRIGGER_TUNNELOPEN" active="1">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="TunnelLoc" />
		<script>
			if  IsQuestTaken("d_OpenTunel_Quest") then
				local b = GetEntityByName("ToR2M1")
				if b then b:SetProperty("Active",1) end
			end
		</script>
	</trigger>

	<!-- Засада незнакомца из тоннеля, если мы украли у него диск -->
	<trigger Name="trZasadaAR" active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="ZasadaAR_loc" />
		<script>
			local stat = GetVar("ZasadaAR").AsInt
			if stat==1 and IsQuestComplete("d_GetSupportOneOfTheBands1_Quest") then
				local vehPlayer = GetPlayerVehicle()
				if vehPlayer then
					vehPlayer:SetCustomControlEnabled( true )
					vehPlayer:SetCustomLinearVelocity( 0 )
					vehPlayer:SetThrottle( 0 )
					vehPlayer:SetCustomControlEnabled( false )
				end
				
				TActivate("RolikZasadaARStart")
				
				trigger:Deactivate()
			end
		</script>
	</trigger>

	<trigger Name="trZasadaAR_Delete" active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>

			for car = 1,2 do
				local veh = GetEntityByName("ZasadaAR"..car)
				if veh then veh:Remove() end
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trZasadaAR_Create" active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>

			for car = 1,2 do
				local veh = GetEntityByName("ZasadaAR"..car)
				if veh then veh:Remove() end
			end
			
			TeamCreate("ZasadaARTeam",1046,CVector(1798.483, 279.056, 5487.830),{"Cruiser01", "CoolBelaz_2"})
						
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Встреча с Оракулом, который посылает нас в Сель -->
	<trigger Name="TRIGGER_ORACLEABOTPLATE" active="1">
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
			if  QuestStatus("r1m3_TW_OralceAboutAlien")==Q_TAKEN then
   				CompleteQuest( "r1m3_TW_OralceAboutAlien" )
   				TakeQuest("r2m1_TW_SellsCivilian")

				TActivate( "RolikBegin_ORACLEABOTPLATE" )

				trigger:Deactivate()
			end
		</script>
	</trigger>

	<!-- Встреча с Оракулом, где мы выбираем концовку -->
	<trigger Name="TRIGGER_ORACLEAGRESSOR" active="1">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="OraculEndLoc" />
		<script>
			if  IsQuestTaken("r2m1_DeployBloks") and not(IsQuestComplete("r2m1_DeployBloks") or IsQuestFailed("r2m1_DeployBloks")) then

				TActivate("trAutoSave")

				TActivate( "RolikBegin_ORACLEAGRESSOR" )

				trigger:Deactivate()
			end
		</script>
	</trigger>

	<!-- Конни и Блайд -->
	<trigger Name="TriggerBonnyTrap" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
			TeamCreate("BonnyTeam",1005,CVector(2176,293,6461), {"Ural00"},CVector(2315,295,6407), 1)

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Беглец в заброшенном городе -->
	<trigger Name="TriggerLabirintCarCreate2" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
			TeamCreate("OldTownOutsiderCar2",1002,CVector(1387,259,3947), {"r1m3_molokovozInOldCity"},nil, 1)

			local tv = GetEntityByName("OldTownOutsiderCar2")
			if tv then
				tv:StackOpen()
				tv:SetDestination( CVector(1847,259,4119))
				tv:SetDestination( CVector(1781,259,3925))
				tv:SetDestination( CVector(1989,259,3742))
				tv:SetDestination( CVector(2415,259,4126))
				tv:SetDestination( CVector(1688,259,3769))
				tv:StackLoop()
				tv:StackClose()
			end

			TActivate("TriggerLabirintCarDie2")

			TakeQuest("r1m3_OldTownOutsiderCar2_Quest")
			
			ShowCircleOnMinimapByName("OldTownOutsiderCar2_vehicle_0")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="TriggerLabirintCarDie2" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="OldTownOutsiderCar2" />
		<script>
   			CompleteQuest( "r1m3_OldTownOutsiderCar2_Quest" )
   			
   			if GetVar("BeglecPrice").AsInt == 0 then
   				AddPlayerMoney(700)
   			else
   				AddPlayerMoney(500)
   			end

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Приехали в Центр Развлечений -->
	<trigger Name="TriggerFindCircus" active="1">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="TheCircus" />
		<script>
   			CompleteQuest( "r1m3_CrazyManQuest" )

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Переход в Край -->
	<trigger Name="triggerExitToMap11" active="1">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="ToR1M1" />
		<script>
			local Plf = GetPlayerVehicle()
			Plf:SetThrottle( 0 )
			Plf:SetCustomLinearVelocity( 0 )

			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.x = PlfCoor.x + 15
			PlfCoor.y = PlfCoor.y + 5
			PlfCoor.z = PlfCoor.z - 10

			ValidateGameVersion()

			local b = SpawnMessageBox( "8801" )
			if b == 1 then

				PassToMap("r1m1", "FromR1M3", -1 )
			else
				SaveAllToleranceStatus(RS_NEUTRAL)

				FlyAround(0.1, 0, 25, 3, PlfCoor, PlfID, 1, 1 )
				StartCinematic()

				TActivate ("RolikExitToMap11")
				TActivate ("RolikENDExitToMap11")
			end
 		</script>
	</trigger>
	<trigger Name="RolikExitToMap11" active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			
			local Plf = GetPlayerVehicle()
			Plf:SetThrottle( 0 )
			Plf:SetCustomLinearVelocity( 0 )

			trigger:Deactivate()    
		</script>
	</trigger>
	<trigger Name="RolikENDExitToMap11" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			GetPlayerVehicle():SetGamePositionOnGround(CVector(getPos("FromR1M1")))
			RotationPlayerByPoints(CVector(getPos("ToR1M1")), CVector(getPos("FromR1M1")))

			TDeactivate( "RolikExitToMap11" )

			SetCameraBehindPlayerVehicle()

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Переход в Риджин -->
	<trigger Name="triggerExitToMap12" active="1">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="ToR1M2" />
		<script>
			local Plf = GetPlayerVehicle()
			Plf:SetThrottle( 0 )
			Plf:SetCustomLinearVelocity( 0 )

			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.x = PlfCoor.x - 15
			PlfCoor.y = PlfCoor.y + 5
			PlfCoor.z = PlfCoor.z + 5

			ValidateGameVersion()

			local b = SpawnMessageBox( "8801" )
			if b == 1 then

				PassToMap("r1m2", "FromR1M3", -1 )
			else
				SaveAllToleranceStatus(RS_NEUTRAL)

				FlyAround(0.1, 0, 25, 3, PlfCoor, PlfID, 1, 1 )
				StartCinematic()

				TActivate ("RolikExitToMap12")
				TActivate ("RolikENDExitToMap12")
			end
 		</script>
	</trigger>
	<trigger Name="RolikExitToMap12" active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			
			local Plf = GetPlayerVehicle()
			Plf:SetThrottle( 0 )
			Plf:SetCustomLinearVelocity( 0 )

			trigger:Deactivate()    
		</script>
	</trigger>
	<trigger Name="RolikENDExitToMap12" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			GetPlayerVehicle():SetGamePositionOnGround(CVector(getPos("FromR1M2")))
			RotationPlayerByPoints(CVector(getPos("ToR1M2")), CVector(getPos("FromR1M2")))

			TDeactivate( "RolikExitToMap12" )

			SetCameraBehindPlayerVehicle()

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Переход в Хель -->
	<trigger Name="triggerExitToMap14" active="1">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="ToR1M4" />
		<script>
			local Plf = GetPlayerVehicle()
			Plf:SetThrottle( 0 )
			Plf:SetCustomLinearVelocity( 0 )

			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.x = PlfCoor.x + 15
			PlfCoor.y = PlfCoor.y + 5
			PlfCoor.z = PlfCoor.z + 15

			ValidateGameVersion()
			
			local b = SpawnMessageBox( "8801" )
			if b == 1 then
				if IsQuestTaken("d_FindVrata_Quest") then

					PassToMap("r1m4", "FromR1M3", -1 )

					local kar = GetEntityByName("KARAVAN14_vehicle_0")
					if kar then kar:Remove() end

					for fire = 1,6 do
						local hs = GetEntityByName ("FIRE0"..fire)
						if hs then hs:Remove() end
					end

					local pavlo = getObj("CrazyRoadRiders")
					if pavlo then pavlo:SetSpokenCount(1) end

					local pogor = getObj("TheCircus")
					if pogor then pogor:SetProperty("Active", 0) end

					TDeactivate("TriggerFindCircus")
				else
					TActivate ("Ending35")
				end
			else
				SaveAllToleranceStatus(RS_NEUTRAL)

				if IsQuestTaken("d_FindVrata_Quest") then
					FlyAround(0.1, 0, 25, 3, PlfCoor, PlfID, 1, 1)
					StartCinematic()
				else
					FlyAround(0.5, 0, 25, 7, PlfCoor, PlfID, 1, 1 )
					StartCinematic()

					AddCinematicMessage(8802)
				end

				TActivate ("RolikExitToMap14")
				TActivate ("RolikENDExitToMap14")
			end
 		</script>
	</trigger>

	<trigger Name="RolikExitToMap14" active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			
			local Plf = GetPlayerVehicle()
			Plf:SetThrottle( 0 )
			Plf:SetCustomLinearVelocity( 0 )

			trigger:Deactivate()    
		</script>
	</trigger>
	<trigger Name="RolikENDExitToMap14" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			GetPlayerVehicle():SetGamePositionOnGround(CVector(getPos("FromR1M4")))
			RotationPlayerByPoints(CVector(getPos("ToR1M4")), CVector(getPos("FromR1M4")))

			TDeactivate( "RolikExitToMap14" )

			SetCameraBehindPlayerVehicle()

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- Переход в Либриум -->
	<trigger Name="triggerExitToMap21" active="1">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="ToR2M1" />
		<script>
			local Plf = GetPlayerVehicle()
			Plf:SetThrottle( 0 )
			Plf:SetCustomLinearVelocity( 0 )

			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.x = PlfCoor.x + 30
			PlfCoor.y = PlfCoor.y + 5
			PlfCoor.z = PlfCoor.z - 10

			if IsQuestTaken("d_OpenTunel_Quest") then 
				ValidateGameVersion()

				local b = SpawnMessageBox( "8801" )
				if b == 1 then

					PassToMap("r2m1", "FromR1M3", -1 )

					local vehP = GetEntityByName("vehPioneer")
					if vehP then vehP:Remove() end
				else
					SaveAllToleranceStatus(RS_NEUTRAL)

					FlyAround(0.1, 0, -25, 3, PlfCoor, PlfID, 1, 1 )
					StartCinematic()

					TActivate ("RolikExitToMap21")
					TActivate ("RolikENDExitToMap21")
				end
			else
				SaveAllToleranceStatus(RS_NEUTRAL)

				FlyAround(0.5, 0, -25, 9, PlfCoor, PlfID, 1, 1 )
				StartCinematic()

				AddCinematicMessage( 8803, 0.5 )

				TActivate ("RolikExitToMap21")
				TActivate ("RolikENDExitToMap21")
			end
 		</script>
	</trigger>
	<trigger Name="RolikExitToMap21" active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			
			local Plf = GetPlayerVehicle()
			Plf:SetThrottle( 0 )
			Plf:SetCustomLinearVelocity( 0 )

			trigger:Deactivate()    
		</script>
	</trigger>
	<trigger Name="RolikENDExitToMap21" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			GetPlayerVehicle():SetGamePositionOnGround(CVector(getPos("FromR2M1")))
			RotationPlayerByPoints(CVector(getPos("ToR2M1")), CVector(getPos("FromR2M1")))

			TDeactivate( "RolikExitToMap21" )

			SetCameraBehindPlayerVehicle()

			trigger:Deactivate()
		</script>
	</trigger>
</triggers>